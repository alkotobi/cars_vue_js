import{_ as j,u as H,r as _,c as p,b as N,g as c,a as e,w as S,v as R,t as $,o as ae,e as T,F as W,d as q,j as B,p as U,I as ie,q as K,S as Se,m as Q,h as te,f as Z,n as ne,i as De}from"./index.CoJVpPtY.js";const Fe={key:0,class:"modal-overlay"},xe={class:"modal-content"},Ne={class:"modal-body"},Ae={class:"form-group"},Le=["value"],Pe={class:"form-group"},Re={key:0,class:"error-message"},Ie={class:"modal-footer"},Oe=["disabled"],Ue=["disabled"],Ve={__name:"VinEditForm",props:{car:{type:Object,required:!0},show:{type:Boolean,default:!1}},emits:["close","save"],setup(I,{emit:O}){const t=I,b=O,{callApi:r}=H(),i=_(""),g=_(!1),h=_(null),l=async()=>{if(!i.value.trim()){h.value="VIN number is required";return}g.value=!0,h.value=null;try{const D=await r({query:"UPDATE cars_stock SET vin = ? WHERE id = ?",params:[i.value.trim(),t.car.id]});D.success?(b("save",{...t.car,vin:i.value.trim()}),b("close")):h.value=D.error||"Failed to update VIN"}catch(D){h.value=D.message||"An error occurred"}finally{g.value=!1}},a=()=>{h.value=null,i.value="",b("close")};return(D,F)=>I.show?(c(),p("div",Fe,[e("div",xe,[e("div",{class:"modal-header"},[F[1]||(F[1]=e("h3",null,"Edit VIN Number",-1)),e("button",{class:"close-btn",onClick:a},"×")]),e("div",Ne,[e("div",Ae,[F[2]||(F[2]=e("label",{for:"current-vin"},"Current VIN:",-1)),e("input",{type:"text",id:"current-vin",value:I.car.vin||"N/A",disabled:"",class:"input-disabled"},null,8,Le)]),e("div",Pe,[F[3]||(F[3]=e("label",{for:"new-vin"},"New VIN:",-1)),S(e("input",{type:"text",id:"new-vin","onUpdate:modelValue":F[0]||(F[0]=w=>i.value=w),placeholder:"Enter new VIN number",class:"input-field"},null,512),[[R,i.value]])]),h.value?(c(),p("div",Re,$(h.value),1)):N("",!0)]),e("div",Ie,[e("button",{class:"cancel-btn",onClick:a,disabled:g.value}," Cancel ",8,Oe),e("button",{class:"save-btn",onClick:l,disabled:g.value},$(g.value?"Saving...":"Save Changes"),9,Ue)])])])):N("",!0)}},Te=j(Ve,[["__scopeId","data-v-bdbf3b43"]]),Me={key:0,class:"modal-overlay"},Be={class:"modal-content"},We={class:"modal-body"},qe={class:"form-group"},je={class:"file-input-container"},Ye={key:0,class:"current-file"},He={class:"form-group"},Je={class:"file-input-container"},Ke={key:0,class:"current-file"},Ge={class:"form-group"},ze={class:"file-input-container"},Qe={key:0,class:"current-file"},Xe={key:0,class:"error-message"},Ze={key:1,class:"success-message"},el={class:"modal-footer"},ll=["disabled"],sl=["disabled"],tl={__name:"CarFilesUploadForm",props:{car:{type:Object,required:!0},show:{type:Boolean,default:!1}},emits:["close","save"],setup(I,{emit:O}){const t=I,b=O,{callApi:r}=H(),i=_(!1),g=_(null),h=_(null),l=_(null),a=_(null),D=_(null),F=async(v,s)=>{if(!v)return null;const m=new FormData;m.append("file",v),m.append("type",s),m.append("car_id",t.car.id);try{const u=await(await fetch("/api/upload_car_file.php",{method:"POST",body:m})).json();if(!u.success)throw new Error(u.error||`Failed to upload ${s} file`);return u.path}catch(P){throw new Error(`Error uploading ${s}: ${P.message}`)}},w=async()=>{i.value=!0,g.value=null,h.value=null;try{const v={};if(l.value){const s=await F(l.value,"documents");s&&(v.path_documents=s)}if(a.value){const s=await F(a.value,"sell_pi");s&&(v.sell_pi_path=s)}if(D.value){const s=await F(D.value,"buy_pi");s&&(v.buy_pi_path=s)}if(Object.keys(v).length>0){const s=Object.keys(v).map(P=>`${P} = ?`).join(", "),m=await r({query:`UPDATE cars_stock SET ${s} WHERE id = ?`,params:[...Object.values(v),t.car.id]});if(m.success)h.value="Files uploaded successfully",b("save",{...t.car,...v});else throw new Error(m.error||"Failed to update file paths")}else h.value="No files selected for upload"}catch(v){g.value=v.message||"An error occurred during upload"}finally{i.value=!1}},x=()=>{g.value=null,h.value=null,l.value=null,a.value=null,D.value=null,b("close")},L=(v,s)=>{const m=v.target.files[0];if(m&&m.type!=="application/pdf"){alert("Only PDF files are allowed"),v.target.value="";return}s.value=m};return(v,s)=>I.show?(c(),p("div",Me,[e("div",Be,[e("div",{class:"modal-header"},[s[3]||(s[3]=e("h3",null,"Upload Car Files",-1)),e("button",{class:"close-btn",onClick:x},"×")]),e("div",We,[e("div",qe,[s[4]||(s[4]=e("label",{for:"documents"},"Documents:",-1)),e("div",je,[e("input",{type:"file",id:"documents",accept:".pdf",onChange:s[0]||(s[0]=m=>L(m,l.value)),class:"file-input"},null,32),t.car.path_documents?(c(),p("span",Ye," Current: "+$(t.car.path_documents.split("/").pop()),1)):N("",!0)])]),e("div",He,[s[5]||(s[5]=e("label",{for:"sell-pi"},"Sell PI:",-1)),e("div",Je,[e("input",{type:"file",id:"sell-pi",accept:".pdf",onChange:s[1]||(s[1]=m=>L(m,a.value)),class:"file-input"},null,32),t.car.sell_pi_path?(c(),p("span",Ke," Current: "+$(t.car.sell_pi_path.split("/").pop()),1)):N("",!0)])]),e("div",Ge,[s[6]||(s[6]=e("label",{for:"buy-pi"},"Buy PI:",-1)),e("div",ze,[e("input",{type:"file",id:"buy-pi",accept:".pdf",onChange:s[2]||(s[2]=m=>L(m,D.value)),class:"file-input"},null,32),t.car.buy_pi_path?(c(),p("span",Qe," Current: "+$(t.car.buy_pi_path.split("/").pop()),1)):N("",!0)])]),g.value?(c(),p("div",Xe,$(g.value),1)):N("",!0),h.value?(c(),p("div",Ze,$(h.value),1)):N("",!0)]),e("div",el,[e("button",{class:"cancel-btn",onClick:x,disabled:i.value}," Cancel ",8,ll),e("button",{class:"save-btn",onClick:w,disabled:i.value},$(i.value?"Uploading...":"Upload Files"),9,sl)])])])):N("",!0)}},al=j(tl,[["__scopeId","data-v-81e07f38"]]),ol={key:0,class:"modal-overlay"},nl={class:"modal-content"},il={class:"modal-body"},rl={class:"form-group"},dl=["value"],ul={class:"form-group"},cl=["value"],vl={key:0,class:"error-message"},pl={class:"modal-footer"},_l=["disabled"],fl=["disabled"],ml={__name:"CarPortsEditForm",props:{car:{type:Object,required:!0},show:{type:Boolean,default:!1}},emits:["close","save"],setup(I,{emit:O}){const t=I,b=O,{callApi:r}=H(),i=_(!1),g=_(null),h=_([]),l=_([]),a=_(t.car.id_port_loading||""),D=_(t.car.id_port_discharge||""),F=async()=>{try{const L=await r({query:"SELECT id, loading_port FROM loading_ports ORDER BY loading_port",params:[]});L.success&&(h.value=L.data);const v=await r({query:"SELECT id, discharge_port FROM discharge_ports ORDER BY discharge_port",params:[]});v.success&&(l.value=v.data)}catch(L){g.value="Failed to load ports data",console.error("Error fetching ports:",L)}},w=async()=>{if(!a.value&&!D.value){g.value="Please select at least one port to update";return}i.value=!0,g.value=null;try{const L=[],v=[];a.value&&(L.push("id_port_loading = ?"),v.push(a.value)),D.value&&(L.push("id_port_discharge = ?"),v.push(D.value)),v.push(t.car.id);const s=await r({query:`UPDATE cars_stock SET ${L.join(", ")} WHERE id = ?`,params:v});if(s.success){const m={...t.car};if(a.value){const P=h.value.find(u=>u.id===parseInt(a.value));m.loading_port=P==null?void 0:P.loading_port,m.id_port_loading=parseInt(a.value)}if(D.value){const P=l.value.find(u=>u.id===parseInt(D.value));m.discharge_port=P==null?void 0:P.discharge_port,m.id_port_discharge=parseInt(D.value)}b("save",m),b("close")}else throw new Error(s.error||"Failed to update ports")}catch(L){g.value=L.message||"An error occurred"}finally{i.value=!1}},x=()=>{g.value=null,a.value=t.car.id_port_loading||"",D.value=t.car.id_port_discharge||"",b("close")};return ae(F),(L,v)=>I.show?(c(),p("div",ol,[e("div",nl,[e("div",{class:"modal-header"},[v[2]||(v[2]=e("h3",null,"Edit Ports",-1)),e("button",{class:"close-btn",onClick:x},"×")]),e("div",il,[e("div",rl,[v[4]||(v[4]=e("label",{for:"loading-port"},"Loading Port:",-1)),S(e("select",{id:"loading-port","onUpdate:modelValue":v[0]||(v[0]=s=>a.value=s),class:"select-field"},[v[3]||(v[3]=e("option",{value:""},"Select Loading Port",-1)),(c(!0),p(W,null,q(h.value,s=>(c(),p("option",{key:s.id,value:s.id},$(s.loading_port),9,dl))),128))],512),[[T,a.value]])]),e("div",ul,[v[6]||(v[6]=e("label",{for:"discharge-port"},"Discharge Port:",-1)),S(e("select",{id:"discharge-port","onUpdate:modelValue":v[1]||(v[1]=s=>D.value=s),class:"select-field"},[v[5]||(v[5]=e("option",{value:""},"Select Discharge Port",-1)),(c(!0),p(W,null,q(l.value,s=>(c(),p("option",{key:s.id,value:s.id},$(s.discharge_port),9,cl))),128))],512),[[T,D.value]])]),g.value?(c(),p("div",vl,$(g.value),1)):N("",!0)]),e("div",pl,[e("button",{class:"cancel-btn",onClick:x,disabled:i.value}," Cancel ",8,_l),e("button",{class:"save-btn",onClick:w,disabled:i.value},$(i.value?"Saving...":"Save Changes"),9,fl)])])])):N("",!0)}},gl=j(ml,[["__scopeId","data-v-0b8747bd"]]),hl={key:0,class:"modal-overlay"},bl={class:"modal-content"},yl={class:"modal-body"},$l={class:"form-group"},wl={class:"input-group"},kl={class:"form-group"},Cl={class:"input-group"},El={class:"form-group"},Sl={class:"input-group"},Dl={key:0,class:"error-message"},Fl={class:"modal-footer"},xl=["disabled"],Nl=["disabled"],Al={__name:"CarMoneyEditForm",props:{car:{type:Object,required:!0},show:{type:Boolean,default:!1}},emits:["close","save"],setup(I,{emit:O}){const t=I,b=O,{callApi:r}=H(),i=_(!1),g=_(null),h=_(t.car.price_cell||""),l=_(t.car.freight||""),a=_(t.car.rate||""),D=async()=>{if(h.value&&isNaN(parseFloat(h.value))){g.value="Price must be a valid number";return}if(l.value&&isNaN(parseFloat(l.value))){g.value="Freight must be a valid number";return}if(a.value&&isNaN(parseFloat(a.value))){g.value="Rate must be a valid number";return}i.value=!0,g.value=null;try{const w=[],x=[];if(h.value!==""&&(w.push("price_cell = ?"),x.push(parseFloat(h.value))),l.value!==""&&(w.push("freight = ?"),x.push(parseFloat(l.value))),a.value!==""&&(w.push("rate = ?"),x.push(parseFloat(a.value))),w.length===0){g.value="Please fill at least one field to update",i.value=!1;return}x.push(t.car.id);const L=await r({query:`UPDATE cars_stock SET ${w.join(", ")} WHERE id = ?`,params:x});if(L.success){const v={...t.car,price_cell:h.value!==""?parseFloat(h.value):t.car.price_cell,freight:l.value!==""?parseFloat(l.value):t.car.freight,rate:a.value!==""?parseFloat(a.value):t.car.rate};b("save",v),b("close")}else throw new Error(L.error||"Failed to update money fields")}catch(w){g.value=w.message||"An error occurred"}finally{i.value=!1}},F=()=>{g.value=null,h.value=t.car.price_cell||"",l.value=t.car.freight||"",a.value=t.car.rate||"",b("close")};return(w,x)=>I.show?(c(),p("div",hl,[e("div",bl,[e("div",{class:"modal-header"},[x[3]||(x[3]=e("h3",null,"Edit Money Fields",-1)),e("button",{class:"close-btn",onClick:F},"×")]),e("div",yl,[e("div",$l,[x[5]||(x[5]=e("label",{for:"price"},"Price:",-1)),e("div",wl,[x[4]||(x[4]=e("span",{class:"currency-symbol"},"$",-1)),S(e("input",{type:"number",id:"price","onUpdate:modelValue":x[0]||(x[0]=L=>h.value=L),placeholder:"Enter price",step:"0.01",min:"0",class:"input-field"},null,512),[[R,h.value]])])]),e("div",kl,[x[7]||(x[7]=e("label",{for:"freight"},"Freight:",-1)),e("div",Cl,[x[6]||(x[6]=e("span",{class:"currency-symbol"},"$",-1)),S(e("input",{type:"number",id:"freight","onUpdate:modelValue":x[1]||(x[1]=L=>l.value=L),placeholder:"Enter freight",step:"0.01",min:"0",class:"input-field"},null,512),[[R,l.value]])])]),e("div",El,[x[8]||(x[8]=e("label",{for:"rate"},"Rate:",-1)),e("div",Sl,[S(e("input",{type:"number",id:"rate","onUpdate:modelValue":x[2]||(x[2]=L=>a.value=L),placeholder:"Enter rate",step:"0.01",min:"0",class:"input-field"},null,512),[[R,a.value]])])]),g.value?(c(),p("div",Dl,$(g.value),1)):N("",!0)]),e("div",Fl,[e("button",{class:"cancel-btn",onClick:F,disabled:i.value}," Cancel ",8,xl),e("button",{class:"save-btn",onClick:D,disabled:i.value},$(i.value?"Saving...":"Save Changes"),9,Nl)])])])):N("",!0)}},Ll=j(Al,[["__scopeId","data-v-c80ed440"]]),Pl={key:0,class:"modal-overlay"},Rl={class:"modal-content"},Il={class:"modal-body"},Ol={class:"status-section"},Ul={class:"status-info"},Vl={key:0,class:"date-info"},Tl={class:"date-value"},Ml={class:"form-group"},Bl=["disabled"],Wl=["value"],ql=["disabled"],jl={class:"get-car-section"},Yl=["disabled"],Hl={key:0,class:"permission-notice"},Jl={key:0,class:"error-message"},Kl={key:1,class:"success-message"},Gl={class:"modal-footer"},zl=["disabled"],Ql={__name:"CarWarehouseForm",props:{car:{type:Object,required:!0},show:{type:Boolean,default:!1}},emits:["close","save"],setup(I,{emit:O}){const t=I,b=O,{callApi:r}=H(),i=_(!1),g=_(null),h=_(null),l=_([]),a=_(t.car.id_warehouse||""),D=_(JSON.parse(localStorage.getItem("user")||"null")),F=B(()=>{var s;return D.value?D.value.role_id===1?!0:(s=D.value.permissions)==null?void 0:s.some(m=>m.permission_name==="can_receive_car"):!1}),w=async()=>{try{console.log("Fetching warehouses...");const s=await r({query:"SELECT id, warhouse_name as name FROM warehouses ORDER BY warhouse_name",params:[]});if(console.log("API Response:",s),s.success)l.value=s.data,console.log("Warehouses loaded:",l.value);else throw console.error("API Error:",s.error),new Error(s.error||"Failed to fetch warehouses")}catch(s){console.error("Full error details:",{message:s.message,stack:s.stack,response:s.response}),g.value=`Failed to load warehouses data: ${s.message}`}},x=async()=>{if(!F.value){g.value="You do not have permission to receive cars";return}if(!t.car.in_wharhouse_date){i.value=!0,g.value=null,h.value=null;try{const s=new Date().toISOString().split("T")[0],m=await r({query:"UPDATE cars_stock SET in_wharhouse_date = ? WHERE id = ?",params:[s,t.car.id]});if(m.success){h.value="Car received in warehouse";const P={...t.car,in_wharhouse_date:s};Object.assign(t.car,P),b("save",P)}else throw new Error(m.error||"Failed to update warehouse date")}catch(s){g.value=s.message||"An error occurred"}finally{i.value=!1}}},L=async()=>{if(!a.value){g.value="Please select a warehouse";return}i.value=!0,g.value=null,h.value=null;try{const s=await r({query:"UPDATE cars_stock SET id_warehouse = ? WHERE id = ?",params:[a.value,t.car.id]});if(s.success){const m=l.value.find(u=>u.id===parseInt(a.value)),P={...t.car,id_warehouse:parseInt(a.value),warehouse_name:m==null?void 0:m.name};h.value="Warehouse updated successfully",b("save",P)}else throw new Error(s.error||"Failed to update warehouse")}catch(s){g.value=s.message||"An error occurred"}finally{i.value=!1}},v=()=>{g.value=null,h.value=null,a.value=t.car.id_warehouse||"",b("close")};return ae(w),(s,m)=>I.show?(c(),p("div",Pl,[e("div",Rl,[e("div",{class:"modal-header"},[m[1]||(m[1]=e("h3",null,"Warehouse Management",-1)),e("button",{class:"close-btn",onClick:v},"×")]),e("div",Il,[e("div",Ol,[m[4]||(m[4]=e("h4",null,"Warehouse Status",-1)),e("div",Ul,[m[2]||(m[2]=e("span",{class:"status-label"},"Current Status:",-1)),e("span",{class:U(["status-value",t.car.in_wharhouse_date?"in-warehouse":"not-in-warehouse"])},$(t.car.in_wharhouse_date?"In Warehouse":"Not In Warehouse"),3)]),t.car.in_wharhouse_date?(c(),p("div",Vl,[m[3]||(m[3]=e("span",{class:"date-label"},"Received Date:",-1)),e("span",Tl,$(new Date(t.car.in_wharhouse_date).toLocaleDateString()),1)])):N("",!0)]),e("div",Ml,[m[6]||(m[6]=e("label",{for:"warehouse"},"Warehouse:",-1)),S(e("select",{id:"warehouse","onUpdate:modelValue":m[0]||(m[0]=P=>a.value=P),class:"select-field",disabled:i.value},[m[5]||(m[5]=e("option",{value:""},"Select Warehouse",-1)),(c(!0),p(W,null,q(l.value,P=>(c(),p("option",{key:P.id,value:P.id},$(P.name),9,Wl))),128))],8,Bl),[[T,a.value]]),e("button",{class:"update-warehouse-btn",onClick:L,disabled:i.value||!a.value}," Update Warehouse ",8,ql)]),e("div",jl,[e("button",{class:U(["get-car-btn",{disabled:!!t.car.in_wharhouse_date||!F.value}]),onClick:x,disabled:i.value||!!t.car.in_wharhouse_date||!F.value},$(i.value?"Processing...":"We Get Car"),11,Yl),!F.value&&!t.car.in_wharhouse_date?(c(),p("div",Hl," You need permission to receive cars ")):N("",!0)]),g.value?(c(),p("div",Jl,$(g.value),1)):N("",!0),h.value?(c(),p("div",Kl,$(h.value),1)):N("",!0)]),e("div",Gl,[e("button",{class:"close-btn-secondary",onClick:v,disabled:i.value}," Close ",8,zl)])])])):N("",!0)}},Xl=j(Ql,[["__scopeId","data-v-8a3d6986"]]),Zl={key:0,class:"modal-overlay"},es={class:"modal-content"},ls={class:"modal-body"},ss={class:"document-grid"},ts={class:"document-section"},as={class:"status-info"},os={key:0,class:"date-info"},ns={class:"date-value"},is=["disabled"],rs={class:"document-section"},ds={class:"status-info"},us={key:0,class:"date-info"},cs={class:"date-value"},vs=["disabled"],ps={class:"document-section"},_s={class:"status-info"},fs={key:0,class:"date-info"},ms={class:"date-value"},gs=["disabled"],hs={class:"document-section"},bs={class:"status-info"},ys={key:0,class:"date-info"},$s={class:"date-value"},ws=["disabled"],ks={class:"export-license-section"},Cs={class:"form-group"},Es={class:"input-group"},Ss=["disabled"],Ds=["disabled"],Fs={key:0,class:"error-message"},xs={key:1,class:"success-message"},Ns={class:"modal-footer"},As=["disabled"],Ls={__name:"CarDocumentsForm",props:{car:{type:Object,required:!0},show:{type:Boolean,default:!1}},emits:["close","save"],setup(I,{emit:O}){const t=I,b=O,{callApi:r}=H(),i=_(!1),g=_(null),h=_(null),l=_(t.car.export_lisence_ref||""),a=async()=>{if(!t.car.date_get_bl){i.value=!0,g.value=null,h.value=null;try{const v=new Date().toISOString().split("T")[0],s=await r({query:"UPDATE cars_stock SET date_get_bl = ? WHERE id = ?",params:[v,t.car.id]});if(s.success){h.value="BL received date updated";const m={...t.car,date_get_bl:v};Object.assign(t.car,m),b("save",m)}else throw new Error(s.error||"Failed to update BL received date")}catch(v){g.value=v.message||"An error occurred"}finally{i.value=!1}}},D=async()=>{if(!t.car.date_pay_freight){i.value=!0,g.value=null,h.value=null;try{const v=new Date().toISOString().split("T")[0],s=await r({query:"UPDATE cars_stock SET date_pay_freight = ? WHERE id = ?",params:[v,t.car.id]});if(s.success){h.value="Freight payment date updated";const m={...t.car,date_pay_freight:v};Object.assign(t.car,m),b("save",m)}else throw new Error(s.error||"Failed to update freight payment date")}catch(v){g.value=v.message||"An error occurred"}finally{i.value=!1}}},F=async()=>{if(!t.car.date_get_documents_from_supp){i.value=!0,g.value=null,h.value=null;try{const v=new Date().toISOString().split("T")[0],s=await r({query:"UPDATE cars_stock SET date_get_documents_from_supp = ? WHERE id = ?",params:[v,t.car.id]});if(s.success){h.value="Documents from supplier date updated";const m={...t.car,date_get_documents_from_supp:v};Object.assign(t.car,m),b("save",m)}else throw new Error(s.error||"Failed to update documents from supplier date")}catch(v){g.value=v.message||"An error occurred"}finally{i.value=!1}}},w=async()=>{if(!t.car.date_send_documents){i.value=!0,g.value=null,h.value=null;try{const v=new Date().toISOString().split("T")[0],s=await r({query:"UPDATE cars_stock SET date_send_documents = ? WHERE id = ?",params:[v,t.car.id]});if(s.success){h.value="Documents sent to client date updated";const m={...t.car,date_send_documents:v};Object.assign(t.car,m),b("save",m)}else throw new Error(s.error||"Failed to update documents sent date")}catch(v){g.value=v.message||"An error occurred"}finally{i.value=!1}}},x=async()=>{i.value=!0,g.value=null,h.value=null;try{const v=await r({query:"UPDATE cars_stock SET export_lisence_ref = ? WHERE id = ?",params:[l.value,t.car.id]});if(v.success){h.value="Export license reference updated";const s={...t.car,export_lisence_ref:l.value};Object.assign(t.car,s),b("save",s)}else throw new Error(v.error||"Failed to update export license reference")}catch(v){g.value=v.message||"An error occurred"}finally{i.value=!1}},L=()=>{g.value=null,h.value=null,l.value=t.car.export_lisence_ref||"",b("close")};return(v,s)=>I.show?(c(),p("div",Zl,[e("div",es,[e("div",{class:"modal-header"},[s[1]||(s[1]=e("h3",null,"Car Documents Management",-1)),e("button",{class:"close-btn",onClick:L},"×")]),e("div",ls,[e("div",ss,[e("div",ts,[s[4]||(s[4]=e("h4",null,"Bill of Lading (BL)",-1)),e("div",as,[s[2]||(s[2]=e("span",{class:"status-label"},"Status:",-1)),e("span",{class:U(["status-value",t.car.date_get_bl?"received":"pending"])},$(t.car.date_get_bl?"Received":"Pending"),3)]),t.car.date_get_bl?(c(),p("div",os,[s[3]||(s[3]=e("span",{class:"date-label"},"Received Date:",-1)),e("span",ns,$(new Date(t.car.date_get_bl).toLocaleDateString()),1)])):N("",!0),e("button",{class:U(["action-btn get-bl-btn",{disabled:!!t.car.date_get_bl}]),onClick:a,disabled:i.value||!!t.car.date_get_bl},$(i.value?"Processing...":"We Get BL"),11,is)]),e("div",rs,[s[7]||(s[7]=e("h4",null,"Freight Payment",-1)),e("div",ds,[s[5]||(s[5]=e("span",{class:"status-label"},"Status:",-1)),e("span",{class:U(["status-value",t.car.date_pay_freight?"paid":"pending"])},$(t.car.date_pay_freight?"Paid":"Pending"),3)]),t.car.date_pay_freight?(c(),p("div",us,[s[6]||(s[6]=e("span",{class:"date-label"},"Payment Date:",-1)),e("span",cs,$(new Date(t.car.date_pay_freight).toLocaleDateString()),1)])):N("",!0),e("button",{class:U(["action-btn freight-btn",{disabled:!!t.car.date_pay_freight}]),onClick:D,disabled:i.value||!!t.car.date_pay_freight},$(i.value?"Processing...":"Freight Paid"),11,vs)]),e("div",ps,[s[10]||(s[10]=e("h4",null,"Supplier Documents",-1)),e("div",_s,[s[8]||(s[8]=e("span",{class:"status-label"},"Status:",-1)),e("span",{class:U(["status-value",t.car.date_get_documents_from_supp?"received":"pending"])},$(t.car.date_get_documents_from_supp?"Received":"Pending"),3)]),t.car.date_get_documents_from_supp?(c(),p("div",fs,[s[9]||(s[9]=e("span",{class:"date-label"},"Received Date:",-1)),e("span",ms,$(new Date(t.car.date_get_documents_from_supp).toLocaleDateString()),1)])):N("",!0),e("button",{class:U(["action-btn supplier-docs-btn",{disabled:!!t.car.date_get_documents_from_supp}]),onClick:F,disabled:i.value||!!t.car.date_get_documents_from_supp},$(i.value?"Processing...":"We Get Docs from Supplier"),11,gs)]),e("div",hs,[s[13]||(s[13]=e("h4",null,"Client Documents",-1)),e("div",bs,[s[11]||(s[11]=e("span",{class:"status-label"},"Status:",-1)),e("span",{class:U(["status-value",t.car.date_send_documents?"sent":"pending"])},$(t.car.date_send_documents?"Sent":"Pending"),3)]),t.car.date_send_documents?(c(),p("div",ys,[s[12]||(s[12]=e("span",{class:"date-label"},"Sent Date:",-1)),e("span",$s,$(new Date(t.car.date_send_documents).toLocaleDateString()),1)])):N("",!0),e("button",{class:U(["action-btn client-docs-btn",{disabled:!!t.car.date_send_documents}]),onClick:w,disabled:i.value||!!t.car.date_send_documents},$(i.value?"Processing...":"Documents Sent to Client"),11,ws)])]),e("div",ks,[s[15]||(s[15]=e("h4",null,"Export License",-1)),e("div",Cs,[s[14]||(s[14]=e("label",{for:"export-license"},"Reference Number:",-1)),e("div",Es,[S(e("input",{type:"text",id:"export-license","onUpdate:modelValue":s[0]||(s[0]=m=>l.value=m),placeholder:"Enter export license reference",class:"input-field",disabled:i.value},null,8,Ss),[[R,l.value]]),e("button",{class:"update-btn",onClick:x,disabled:i.value}," Update ",8,Ds)])])]),g.value?(c(),p("div",Fs,$(g.value),1)):N("",!0),h.value?(c(),p("div",xs,$(h.value),1)):N("",!0)]),e("div",Ns,[e("button",{class:"close-btn-secondary",onClick:L,disabled:i.value}," Close ",8,As)])])])):N("",!0)}},Ps=j(Ls,[["__scopeId","data-v-52e80646"]]),Rs={key:0,class:"modal-overlay"},Is={class:"modal-content"},Os={class:"modal-header"},Us={class:"modal-body"},Vs={key:0,class:"loading-status"},Ts={class:"status-info"},Ms={key:0,class:"date-info"},Bs={class:"date-value"},Ws=["disabled"],qs={key:1,class:"success-animation"},js={key:2,class:"error-message"},Ys={__name:"CarLoadForm",props:{car:{type:Object,required:!0},show:{type:Boolean,default:!1}},emits:["close","save"],setup(I,{emit:O}){const t=I,b=O,{callApi:r}=H(),i=_(!1),g=_(null),h=_(!1),l=async()=>{if(!t.car.date_loding){i.value=!0,g.value=null;try{const D=new Date().toISOString().split("T")[0],F=await r({query:"UPDATE cars_stock SET date_loding = ? WHERE id = ?",params:[D,t.car.id]});if(F.success){const w={...t.car,date_loding:D};Object.assign(t.car,w),h.value=!0,setTimeout(()=>{b("save",w),b("close")},2e3)}else throw new Error(F.error||"Failed to update loading date")}catch(D){g.value=D.message||"An error occurred"}finally{i.value=!1}}},a=()=>{g.value=null,h.value=!1,b("close")};return(D,F)=>I.show?(c(),p("div",Rs,[e("div",Is,[e("div",Os,[F[0]||(F[0]=e("h3",null,"Car Loading",-1)),h.value?N("",!0):(c(),p("button",{key:0,class:"close-btn",onClick:a},"×"))]),e("div",Us,[h.value?N("",!0):(c(),p("div",Vs,[F[3]||(F[3]=e("h4",null,"Loading Status",-1)),e("div",Ts,[F[1]||(F[1]=e("span",{class:"status-label"},"Current Status:",-1)),e("span",{class:U(["status-value",t.car.date_loding?"loaded":"pending"])},$(t.car.date_loding?"Loaded":"Pending"),3)]),t.car.date_loding?(c(),p("div",Ms,[F[2]||(F[2]=e("span",{class:"date-label"},"Loading Date:",-1)),e("span",Bs,$(new Date(t.car.date_loding).toLocaleDateString()),1)])):N("",!0),e("button",{class:U(["action-btn load-btn",{disabled:!!t.car.date_loding}]),onClick:l,disabled:i.value||!!t.car.date_loding},$(i.value?"Processing...":"Load Car"),11,Ws)])),h.value?(c(),p("div",qs,F[4]||(F[4]=[e("div",{class:"checkmark-circle"},[e("div",{class:"checkmark"})],-1),e("h2",{class:"congratulations"},"Congratulations!",-1),e("p",{class:"success-message"},"Car has been successfully loaded",-1)]))):N("",!0),g.value?(c(),p("div",js,$(g.value),1)):N("",!0)])])])):N("",!0)}},Hs=j(Ys,[["__scopeId","data-v-425cf9c1"]]),Js={key:0,class:"advanced-filter-overlay"},Ks={class:"advanced-filter-modal"},Gs={class:"modal-header"},zs={class:"filter-content"},Qs={class:"filter-grid"},Xs={class:"filter-section"},Zs={class:"filter-group"},et={class:"filter-group"},lt={class:"filter-group"},st={class:"filter-group"},tt={class:"filter-section"},at={class:"filter-group"},ot={class:"filter-group"},nt={class:"filter-section"},it={class:"filter-group"},rt={class:"range-inputs"},dt={class:"filter-group"},ut={class:"range-inputs"},ct={class:"filter-section"},vt={class:"filter-group"},pt={class:"filter-group"},_t={class:"filter-group"},ft={class:"filter-section document-status"},mt={class:"checkbox-grid"},gt={class:"checkbox-label"},ht={class:"checkbox-label"},bt={class:"checkbox-label"},yt={class:"checkbox-label"},$t={class:"checkbox-label"},wt={class:"checkbox-label"},kt={class:"checkbox-label"},Ct={class:"checkbox-label"},Et={class:"filter-section"},St={class:"filter-group"},Dt={class:"date-range"},Ft={__name:"AdvancedFilter",props:{show:Boolean,initialFilters:{type:Object,default:()=>({})}},emits:["update:filters","close"],setup(I,{emit:O}){const t=I,b=O,r=_({id:"",car_name:"",color:"",vin:"",loading_port:"",discharge_port:"",freight_min:"",freight_max:"",price_min:"",price_max:"",loading_date_from:"",loading_date_to:"",status:"",client:"",warehouse:"",has_bl:!1,freight_paid:!1,has_supplier_docs:!1,in_warehouse:!1,has_export_license:!1,documents_sent:!1,is_loaded:!1,has_vin:!1,...t.initialFilters}),i=()=>{b("update:filters",{...r.value})},g=()=>{r.value={id:"",car_name:"",color:"",vin:"",loading_port:"",discharge_port:"",freight_min:"",freight_max:"",price_min:"",price_max:"",loading_date_from:"",loading_date_to:"",status:"",client:"",warehouse:"",has_bl:!1,freight_paid:!1,has_supplier_docs:!1,in_warehouse:!1,has_export_license:!1,documents_sent:!1,is_loaded:!1,has_vin:!1},i()};return ie(()=>t.initialFilters,h=>{r.value={...r.value,...h}},{deep:!0}),(h,l)=>I.show?(c(),p("div",Js,[e("div",Ks,[e("div",Gs,[l[24]||(l[24]=e("h3",null,"Advanced Filters",-1)),e("button",{class:"close-btn",onClick:l[0]||(l[0]=a=>h.$emit("close"))},"×")]),e("div",zs,[e("div",Qs,[e("div",Xs,[l[29]||(l[29]=e("h4",null,"Basic Information",-1)),e("div",Zs,[l[25]||(l[25]=e("label",null,"ID:",-1)),S(e("input",{type:"text","onUpdate:modelValue":l[1]||(l[1]=a=>r.value.id=a),placeholder:"Car ID"},null,512),[[R,r.value.id]])]),e("div",et,[l[26]||(l[26]=e("label",null,"Car Name:",-1)),S(e("input",{type:"text","onUpdate:modelValue":l[2]||(l[2]=a=>r.value.car_name=a),placeholder:"Car name"},null,512),[[R,r.value.car_name]])]),e("div",lt,[l[27]||(l[27]=e("label",null,"Color:",-1)),S(e("input",{type:"text","onUpdate:modelValue":l[3]||(l[3]=a=>r.value.color=a),placeholder:"Color"},null,512),[[R,r.value.color]])]),e("div",st,[l[28]||(l[28]=e("label",null,"VIN:",-1)),S(e("input",{type:"text","onUpdate:modelValue":l[4]||(l[4]=a=>r.value.vin=a),placeholder:"VIN number"},null,512),[[R,r.value.vin]])])]),e("div",tt,[l[32]||(l[32]=e("h4",null,"Ports",-1)),e("div",at,[l[30]||(l[30]=e("label",null,"Loading Port:",-1)),S(e("input",{type:"text","onUpdate:modelValue":l[5]||(l[5]=a=>r.value.loading_port=a),placeholder:"Loading port"},null,512),[[R,r.value.loading_port]])]),e("div",ot,[l[31]||(l[31]=e("label",null,"Discharge Port:",-1)),S(e("input",{type:"text","onUpdate:modelValue":l[6]||(l[6]=a=>r.value.discharge_port=a),placeholder:"Discharge port"},null,512),[[R,r.value.discharge_port]])])]),e("div",nt,[l[37]||(l[37]=e("h4",null,"Financial",-1)),e("div",it,[l[34]||(l[34]=e("label",null,"Freight Range:",-1)),e("div",rt,[S(e("input",{type:"number","onUpdate:modelValue":l[7]||(l[7]=a=>r.value.freight_min=a),placeholder:"Min"},null,512),[[R,r.value.freight_min]]),l[33]||(l[33]=e("span",null,"to",-1)),S(e("input",{type:"number","onUpdate:modelValue":l[8]||(l[8]=a=>r.value.freight_max=a),placeholder:"Max"},null,512),[[R,r.value.freight_max]])])]),e("div",dt,[l[36]||(l[36]=e("label",null,"Price Range:",-1)),e("div",ut,[S(e("input",{type:"number","onUpdate:modelValue":l[9]||(l[9]=a=>r.value.price_min=a),placeholder:"Min"},null,512),[[R,r.value.price_min]]),l[35]||(l[35]=e("span",null,"to",-1)),S(e("input",{type:"number","onUpdate:modelValue":l[10]||(l[10]=a=>r.value.price_max=a),placeholder:"Max"},null,512),[[R,r.value.price_max]])])])]),e("div",ct,[l[42]||(l[42]=e("h4",null,"Status",-1)),e("div",vt,[l[39]||(l[39]=e("label",null,"Status:",-1)),S(e("select",{"onUpdate:modelValue":l[11]||(l[11]=a=>r.value.status=a)},l[38]||(l[38]=[e("option",{value:""},"All",-1),e("option",{value:"available"},"Available",-1),e("option",{value:"sold"},"Sold",-1)]),512),[[T,r.value.status]])]),e("div",pt,[l[40]||(l[40]=e("label",null,"Client:",-1)),S(e("input",{type:"text","onUpdate:modelValue":l[12]||(l[12]=a=>r.value.client=a),placeholder:"Client name"},null,512),[[R,r.value.client]])]),e("div",_t,[l[41]||(l[41]=e("label",null,"Warehouse:",-1)),S(e("input",{type:"text","onUpdate:modelValue":l[13]||(l[13]=a=>r.value.warehouse=a),placeholder:"Warehouse"},null,512),[[R,r.value.warehouse]])])]),e("div",ft,[l[51]||(l[51]=e("h4",null,"Document Status",-1)),e("div",mt,[e("label",gt,[S(e("input",{type:"checkbox","onUpdate:modelValue":l[14]||(l[14]=a=>r.value.has_bl=a)},null,512),[[K,r.value.has_bl]]),l[43]||(l[43]=e("span",null,"We Got BL",-1))]),e("label",ht,[S(e("input",{type:"checkbox","onUpdate:modelValue":l[15]||(l[15]=a=>r.value.freight_paid=a)},null,512),[[K,r.value.freight_paid]]),l[44]||(l[44]=e("span",null,"Freight Paid",-1))]),e("label",bt,[S(e("input",{type:"checkbox","onUpdate:modelValue":l[16]||(l[16]=a=>r.value.has_supplier_docs=a)},null,512),[[K,r.value.has_supplier_docs]]),l[45]||(l[45]=e("span",null,"Got Supplier Docs",-1))]),e("label",yt,[S(e("input",{type:"checkbox","onUpdate:modelValue":l[17]||(l[17]=a=>r.value.in_warehouse=a)},null,512),[[K,r.value.in_warehouse]]),l[46]||(l[46]=e("span",null,"In Warehouse",-1))]),e("label",$t,[S(e("input",{type:"checkbox","onUpdate:modelValue":l[18]||(l[18]=a=>r.value.has_export_license=a)},null,512),[[K,r.value.has_export_license]]),l[47]||(l[47]=e("span",null,"Has Export License",-1))]),e("label",wt,[S(e("input",{type:"checkbox","onUpdate:modelValue":l[19]||(l[19]=a=>r.value.documents_sent=a)},null,512),[[K,r.value.documents_sent]]),l[48]||(l[48]=e("span",null,"Documents Sent",-1))]),e("label",kt,[S(e("input",{type:"checkbox","onUpdate:modelValue":l[20]||(l[20]=a=>r.value.is_loaded=a)},null,512),[[K,r.value.is_loaded]]),l[49]||(l[49]=e("span",null,"Car Loaded",-1))]),e("label",Ct,[S(e("input",{type:"checkbox","onUpdate:modelValue":l[21]||(l[21]=a=>r.value.has_vin=a)},null,512),[[K,r.value.has_vin]]),l[50]||(l[50]=e("span",null,"Has VIN",-1))])])]),e("div",Et,[l[54]||(l[54]=e("h4",null,"Date Range",-1)),e("div",St,[l[53]||(l[53]=e("label",null,"Loading Date:",-1)),e("div",Dt,[S(e("input",{type:"date","onUpdate:modelValue":l[22]||(l[22]=a=>r.value.loading_date_from=a),placeholder:"From"},null,512),[[R,r.value.loading_date_from]]),l[52]||(l[52]=e("span",null,"to",-1)),S(e("input",{type:"date","onUpdate:modelValue":l[23]||(l[23]=a=>r.value.loading_date_to=a),placeholder:"To"},null,512),[[R,r.value.loading_date_to]])])])])]),e("div",{class:"filter-actions"},[e("button",{class:"reset-btn",onClick:g},"Reset"),e("button",{class:"apply-btn",onClick:i},"Apply Filters")])])])])):N("",!0)}},xt=j(Ft,[["__scopeId","data-v-0f125a47"]]),Nt={class:"cars-stock-table"},At={class:"table-actions"},Lt={key:7,class:"loading"},Pt={key:8,class:"error"},Rt={key:9,class:"empty-state"},It={key:10,class:"table-container"},Ot={class:"cars-table"},Ut={class:"documents-cell"},Vt={class:"document-links"},Tt=["href"],Mt=["href"],Bt=["href"],Wt=["disabled","onClick"],qt={class:"dropdown"},jt=["onClick"],Yt={key:0,class:"dropdown-menu"},Ht=["onClick","disabled"],Jt=["onClick","disabled"],Kt=["onClick","disabled"],Gt=["onClick","disabled"],zt=["onClick","disabled"],Qt=["onClick","disabled"],Xt=["onClick","disabled"],Zt={__name:"CarStockTable",props:{cars:Array,onEdit:{type:Function,default:()=>{}},filters:{type:Object,default:()=>({basic:"",advanced:{id:"",car_name:"",color:"",vin:"",loading_port:"",discharge_port:"",freight_min:"",freight_max:"",price_min:"",price_max:"",loading_date_from:"",loading_date_to:"",status:"",client:"",warehouse:"",has_bl:!1,freight_paid:!1,has_supplier_docs:!1,in_warehouse:!1,has_export_license:!1,documents_sent:!1,is_loaded:!1,has_vin:!1}})}},emits:["refresh"],setup(I,{expose:O,emit:t}){const b=_({}),r=I;ie(()=>r.filters,o=>{M()},{deep:!0});const i=_(null),g=B(()=>{var o;return i.value?i.value.role_id===1?!0:(o=i.value.permissions)==null?void 0:o.some(d=>d.permission_name==="can_edit_cars_prop"):!1}),{callApi:h,getFileUrl:l}=H(),a=_([]),D=_(!0),F=_(null),w=_(!1),x=_(null),L=B(()=>{var o;return i.value?i.value.role_id===1?!0:(o=i.value.permissions)==null?void 0:o.some(d=>d.permission_name==="can_edit_vin"):!1}),v=_(!1),s=B(()=>{var o;return i.value?i.value.role_id===1?!0:(o=i.value.permissions)==null?void 0:o.some(d=>d.permission_name==="can_upload_car_files"):!1}),m=_(!1),P=B(()=>{var o;return i.value?i.value.role_id===1?!0:(o=i.value.permissions)==null?void 0:o.some(d=>d.permission_name==="can_edit_cars_ports"):!1}),u=_(!1),k=B(()=>{var o;return i.value?i.value.role_id===1?!0:(o=i.value.permissions)==null?void 0:o.some(d=>d.permission_name==="can_edit_car_money"):!1}),Y=_(!1),J=B(()=>{var o;return i.value?i.value.role_id===1?!0:(o=i.value.permissions)==null?void 0:o.some(d=>d.permission_name==="can_edit_warehouse"):!1}),f=_(!1),G=_(null),z=B(()=>{var o;return i.value?i.value.role_id===1?!0:(o=i.value.permissions)==null?void 0:o.some(d=>d.permission_name==="can_edit_car_documents"):!1}),X=_(!1),ee=_(null),A=B(()=>{var o;return i.value?i.value.role_id===1?!0:(o=i.value.permissions)==null?void 0:o.some(d=>d.permission_name==="can_load_car"):!1}),n=_(!1),E=_({}),M=async()=>{D.value=!0,F.value=null;try{let o=`
      SELECT 
        cs.id,
        cs.vin,
        cs.price_cell,
        cs.date_loding,
        cs.date_sell,
        cs.notes,
        cs.freight,
        cs.path_documents,
        cs.sell_pi_path,
        cs.buy_pi_path,
        cs.id_client,
        cs.id_port_loading,
        cs.id_port_discharge,
        cs.id_buy_details,
        cs.date_send_documents,
        cs.id_sell_pi,
        cs.id_sell,
        cs.export_lisence_ref,
        cs.id_warehouse,
        cs.in_wharhouse_date,
        cs.date_get_documents_from_supp,
        cs.date_get_keys_from_supp,
        cs.rate,
        cs.date_get_bl,
        cs.date_pay_freight,
        c.name as client_name,
        cn.car_name,
        clr.color,
        lp.loading_port,
        dp.discharge_port,
        bd.price_sell as buy_price,
        w.warhouse_name as warehouse_name
      FROM cars_stock cs
      LEFT JOIN clients c ON cs.id_client = c.id
      LEFT JOIN buy_details bd ON cs.id_buy_details = bd.id
      LEFT JOIN cars_names cn ON bd.id_car_name = cn.id
      LEFT JOIN colors clr ON bd.id_color = clr.id
      LEFT JOIN loading_ports lp ON cs.id_port_loading = lp.id
      LEFT JOIN discharge_ports dp ON cs.id_port_discharge = dp.id
      LEFT JOIN warehouses w ON cs.id_warehouse = w.id
      WHERE cs.hidden = 0
    `;const d=[];if(r.filters){if(r.filters.basic&&r.filters.basic.trim()!==""){const y=`%${r.filters.basic.trim()}%`;o+=`
          AND (
            cs.id LIKE ? OR
            cn.car_name LIKE ? OR
            clr.color LIKE ? OR
            cs.vin LIKE ? OR
            lp.loading_port LIKE ? OR
            dp.discharge_port LIKE ? OR
            c.name LIKE ? OR
            w.warhouse_name LIKE ?
          )
        `;for(let de=0;de<8;de++)d.push(y)}if(r.filters.advanced){const y=r.filters.advanced;y.id&&y.id.trim()!==""&&(o+=" AND cs.id = ?",d.push(y.id.trim())),y.car_name&&y.car_name.trim()!==""&&(o+=" AND cn.car_name = ?",d.push(y.car_name.trim())),y.color&&y.color.trim()!==""&&(o+=" AND clr.color = ?",d.push(y.color.trim())),y.vin&&y.vin.trim()!==""&&(o+=" AND cs.vin LIKE ?",d.push(`%${y.vin.trim()}%`)),y.loading_port&&y.loading_port.trim()!==""&&(o+=" AND lp.loading_port = ?",d.push(y.loading_port.trim())),y.discharge_port&&y.discharge_port.trim()!==""&&(o+=" AND dp.discharge_port = ?",d.push(y.discharge_port.trim())),y.freight_min&&y.freight_min.trim()!==""&&(o+=" AND cs.freight >= ?",d.push(parseFloat(y.freight_min.trim()))),y.freight_max&&y.freight_max.trim()!==""&&(o+=" AND cs.freight <= ?",d.push(parseFloat(y.freight_max.trim()))),y.price_min&&y.price_min.trim()!==""&&(o+=" AND cs.price_cell >= ?",d.push(parseFloat(y.price_min.trim()))),y.price_max&&y.price_max.trim()!==""&&(o+=" AND cs.price_cell <= ?",d.push(parseFloat(y.price_max.trim()))),y.loading_date_from&&y.loading_date_from.trim()!==""&&(o+=" AND cs.date_loding >= ?",d.push(y.loading_date_from.trim())),y.loading_date_to&&y.loading_date_to.trim()!==""&&(o+=" AND cs.date_loding <= ?",d.push(y.loading_date_to.trim())),y.status&&y.status.trim()!==""&&(y.status==="available"?o+=" AND (cs.date_sell IS NULL AND cs.id_client IS NULL)":y.status==="sold"&&(o+=" AND (cs.date_sell IS NOT NULL OR cs.id_client IS NOT NULL)")),y.client&&y.client.trim()!==""&&(o+=" AND c.name = ?",d.push(y.client.trim())),y.warehouse&&y.warehouse.trim()!==""&&(o+=" AND w.name = ?",d.push(y.warehouse.trim())),y.has_bl&&(o+=" AND cs.date_get_bl IS NOT NULL"),y.freight_paid&&(o+=" AND cs.date_pay_freight IS NOT NULL"),y.has_supplier_docs&&(o+=" AND cs.date_get_documents_from_supp IS NOT NULL"),y.in_warehouse&&(o+=" AND cs.in_wharhouse_date IS NOT NULL"),y.has_export_license&&(o+=" AND cs.export_lisence_ref IS NOT NULL AND cs.export_lisence_ref != ''"),y.documents_sent&&(o+=" AND cs.date_send_documents IS NOT NULL"),y.is_loaded&&(o+=" AND cs.date_loding IS NOT NULL"),y.has_vin&&(o+=" AND cs.vin IS NOT NULL AND cs.vin != ''")}}o+=" ORDER BY cs.id DESC";const C=await h({query:o,params:d});C.success?a.value=C.data:F.value=C.error||"Failed to fetch cars stock"}catch(o){F.value=o.message||"An error occurred"}finally{D.value=!1}},V=o=>{r.onEdit(o)},le=(o,d)=>{d.stopPropagation();const C={};C[o]=!b.value[o],b.value=C},oe=o=>{if(!L.value){alert("You do not have permission to edit VIN numbers");return}x.value=o,w.value=!0,b.value[o.id]=!1},se=o=>{const d=a.value.findIndex(C=>C.id===o.id);d!==-1&&(a.value[d]={...a.value[d],...o})},ue=o=>{if(!s.value){alert("You do not have permission to upload car files");return}x.value=o,v.value=!0,b.value[o.id]=!1},ce=o=>{const d=a.value.findIndex(C=>C.id===o.id);d!==-1&&(a.value[d]={...a.value[d],...o})},ve=o=>{if(!P.value){alert("You do not have permission to edit car ports");return}x.value=o,m.value=!0,b.value[o.id]=!1},pe=o=>{const d=a.value.findIndex(C=>C.id===o.id);d!==-1&&(a.value[d]={...a.value[d],...o})},_e=o=>{if(!k.value){alert("You do not have permission to edit car money fields");return}x.value=o,u.value=!0,b.value[o.id]=!1},fe=o=>{const d=a.value.findIndex(C=>C.id===o.id);d!==-1&&(a.value[d]={...a.value[d],...o})},me=o=>{if(!J.value){alert("You do not have permission to manage warehouse");return}x.value=o,Y.value=!0,b.value[o.id]=!1},ge=o=>{const d=a.value.findIndex(C=>C.id===o.id);d!==-1&&(a.value[d]={...a.value[d],...o})},he=async o=>{if(!z.value){alert("You do not have permission to manage car documents");return}try{const d=await h({query:`
        SELECT 
          cs.id,
          cs.date_get_bl,
          cs.date_pay_freight,
          cs.date_get_documents_from_supp,
          cs.date_send_documents,
          cs.export_lisence_ref
        FROM cars_stock cs
        WHERE cs.id = ?
      `,params:[o.id]});if(d.success&&d.data.length>0)G.value={...o,...d.data[0]},f.value=!0;else throw new Error("Failed to fetch car document data")}catch(d){alert(d.message||"An error occurred while fetching car document data")}},be=()=>{f.value=!1,G.value=null},ye=o=>{const d=a.value.findIndex(C=>C.id===o.id);d!==-1&&(a.value[d]={...a.value[d],...o})},$e=o=>{ee.value=o,X.value=!0},we=()=>{X.value=!1,ee.value=null},ke=o=>{const d=a.value.findIndex(C=>C.id===o.id);d!==-1&&(a.value[d]={...a.value[d],...o})},Ce=()=>{b.value={}},re=o=>{const d=document.querySelectorAll(".dropdown");let C=!0;d.forEach(y=>{y.contains(o.target)&&(C=!1)}),C&&Ce()},Ee=o=>{E.value=o,n.value=!1,r.filters.advanced=o};return ae(()=>{const o=localStorage.getItem("user");o&&(i.value=JSON.parse(o),M()),document.addEventListener("click",re)}),Se(()=>{document.removeEventListener("click",re)}),O({fetchCarsStock:M}),(o,d)=>(c(),p("div",Nt,[w.value?(c(),Q(Te,{key:0,car:x.value,show:w.value,onClose:d[0]||(d[0]=C=>w.value=!1),onSave:se},null,8,["car","show"])):N("",!0),v.value?(c(),Q(al,{key:1,car:x.value,show:v.value,onClose:d[1]||(d[1]=C=>v.value=!1),onSave:ce},null,8,["car","show"])):N("",!0),m.value?(c(),Q(gl,{key:2,car:x.value,show:m.value,onClose:d[2]||(d[2]=C=>m.value=!1),onSave:pe},null,8,["car","show"])):N("",!0),u.value?(c(),Q(Ll,{key:3,car:x.value,show:u.value,onClose:d[3]||(d[3]=C=>u.value=!1),onSave:fe},null,8,["car","show"])):N("",!0),Y.value?(c(),Q(Xl,{key:4,car:x.value,show:Y.value,onClose:d[4]||(d[4]=C=>Y.value=!1),onSave:ge},null,8,["car","show"])):N("",!0),f.value?(c(),Q(Ps,{key:5,car:G.value,show:f.value,onClose:be,onSave:ye},null,8,["car","show"])):N("",!0),X.value?(c(),Q(Hs,{key:6,car:ee.value,show:X.value,onClose:we,onSave:ke},null,8,["car","show"])):N("",!0),e("div",At,[e("button",{class:"advanced-filter-btn",onClick:d[5]||(d[5]=C=>n.value=!0)}," Advanced Filters ")]),te(xt,{show:n.value,"initial-filters":E.value,"onUpdate:filters":Ee,onClose:d[6]||(d[6]=C=>n.value=!1)},null,8,["show","initial-filters"]),D.value?(c(),p("div",Lt,"Loading...")):F.value?(c(),p("div",Pt,$(F.value),1)):a.value.length===0?(c(),p("div",Rt,"No cars in stock")):(c(),p("div",It,[e("table",Ot,[d[10]||(d[10]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Car"),e("th",null,"Color"),e("th",null,"VIN"),e("th",null,"Loading Port"),e("th",null,"Discharge Port"),e("th",null,"Freight"),e("th",null,"Price Cell"),e("th",null,"Loading Date"),e("th",null,"Status"),e("th",null,"Client"),e("th",null,"Documents"),e("th",null,"Actions")])],-1)),e("tbody",null,[(c(!0),p(W,null,q(a.value,C=>(c(),p("tr",{key:C.id},[e("td",null,$(C.id),1),e("td",null,$(C.car_name||"N/A"),1),e("td",null,$(C.color||"N/A"),1),e("td",null,$(C.vin||"N/A"),1),e("td",null,$(C.loading_port||"N/A"),1),e("td",null,$(C.discharge_port||"N/A"),1),e("td",null,$(C.freight?"$"+C.freight:"N/A"),1),e("td",null,$(C.price_cell?"$"+C.price_cell:"N/A"),1),e("td",null,$(C.date_loding?new Date(C.date_loding).toLocaleDateString():"N/A"),1),e("td",{class:U(C.date_sell||C.client_name?"status-sold":"status-available")},$(C.date_sell||C.client_name?"Sold":"Available"),3),e("td",null,$(C.client_name||"N/A"),1),e("td",Ut,[e("div",Vt,[C.path_documents?(c(),p("a",{key:0,href:Z(l)(C.path_documents),target:"_blank",class:"document-link",title:"View Documents"},d[7]||(d[7]=[e("i",{class:"fas fa-file-pdf"},null,-1),ne(" Documents ")]),8,Tt)):N("",!0),C.sell_pi_path?(c(),p("a",{key:1,href:Z(l)(C.sell_pi_path),target:"_blank",class:"document-link",title:"View Sell PI"},d[8]||(d[8]=[e("i",{class:"fas fa-file-invoice-dollar"},null,-1),ne(" Sell PI ")]),8,Mt)):N("",!0),C.buy_pi_path?(c(),p("a",{key:2,href:Z(l)(C.buy_pi_path),target:"_blank",class:"document-link",title:"View Buy PI"},d[9]||(d[9]=[e("i",{class:"fas fa-file-invoice"},null,-1),ne(" Buy PI ")]),8,Bt)):N("",!0)])]),e("td",null,[e("button",{disabled:!g.value,onClick:y=>V(C),class:"edit-btn"},"Edit",8,Wt),e("div",qt,[e("button",{onClick:y=>le(C.id,y),class:"dropdown-toggle"},"Actions",8,jt),b.value[C.id]?(c(),p("ul",Yt,[e("li",null,[e("button",{onClick:y=>oe(C),disabled:!L.value,class:U({disabled:!L.value})}," VIN ",10,Ht)]),e("li",null,[e("button",{onClick:y=>ue(C),disabled:!s.value,class:U({disabled:!s.value})}," Files ",10,Jt)]),e("li",null,[e("button",{onClick:y=>ve(C),disabled:!P.value,class:U({disabled:!P.value})}," Ports ",10,Kt)]),e("li",null,[e("button",{onClick:y=>_e(C),disabled:!k.value,class:U({disabled:!k.value})}," Money ",10,Gt)]),e("li",null,[e("button",{onClick:y=>me(C),disabled:!J.value,class:U({disabled:!J.value})}," Warehouse ",10,zt)]),e("li",null,[e("button",{onClick:y=>he(C),disabled:!z.value,class:U({disabled:!z.value})}," Car Documents ",10,Qt)]),e("li",null,[e("button",{onClick:y=>$e(C),disabled:!A.value,class:U({disabled:!A.value})}," Load ",10,Xt)])])):N("",!0)])])]))),128))])])]))]))}},ea=j(Zt,[["__scopeId","data-v-a7c7833a"]]),la={class:"car-stock-form"},sa={class:"form-grid"},ta={class:"form-section"},aa={class:"form-group"},oa=["disabled"],na={class:"form-group"},ia=["value"],ra={class:"form-group"},da={class:"form-section"},ua={class:"form-group"},ca=["disabled"],va={class:"form-group"},pa={class:"form-group"},_a=["disabled"],fa={class:"form-group"},ma=["disabled"],ga=["value"],ha={class:"form-group"},ba={class:"form-section"},ya={class:"form-group"},$a=["value"],wa={class:"form-group"},ka=["disabled"],Ca=["value"],Ea={class:"form-group"},Sa={class:"form-group"},Da={class:"form-group"},Fa={class:"file-upload-container"},xa=["href"],Na={class:"form-group"},Aa={class:"file-upload-container"},La=["href"],Pa={class:"form-group"},Ra={class:"file-upload-container"},Ia=["href"],Oa={class:"form-actions"},Ua=["disabled"],Va={key:0,class:"error-message"},Ta={__name:"CarStockForm",props:{carData:{type:Object,required:!0}},emits:["save","cancel"],setup(I,{emit:O}){const t=I,b=_(null),r=B(()=>{var A;return b.value?b.value.role_id===1?!0:(A=b.value.permissions)==null?void 0:A.some(n=>n.permission_name==="can_edit_vin"):!1}),i=B(()=>{var A;return b.value?b.value.role_id===1?!0:(A=b.value.permissions)==null?void 0:A.some(n=>n.permission_name==="can_edit_car_client_name"):!1}),g=B(()=>{var A;return b.value?b.value.role_id===1?!0:(A=b.value.permissions)==null?void 0:A.some(n=>n.permission_name==="can_edit_cars_sell_price"):!1}),h=B(()=>{var A;return b.value?b.value.role_id===1?!0:(A=b.value.permissions)==null?void 0:A.some(n=>n.permission_name==="can_edit_cars_sell_rate"):!1}),l=B(()=>{var A;return b.value?b.value.role_id===1?!0:(A=b.value.permissions)==null?void 0:A.some(n=>n.permission_name==="can_edit_cars_discharge_port"):!1}),a=O,{callApi:D,uploadFile:F,getFileUrl:w}=H(),x=_(!1),L=_(null),v=_(null),s=_(null),m=_(null),P=_([]),u=_([]),k=_([]),Y=_([]),J=_([]),f=_({id:null,notes:"",id_buy_details:null,date_sell:null,id_client:null,price_cell:null,freight:null,id_port_loading:null,id_port_discharge:null,vin:"",path_documents:"",date_loding:null,date_send_documents:null,id_sell_pi:"",sell_pi_path:"",buy_pi_path:"",id_sell:null,export_lisence_ref:"",id_warehouse:null,in_wharhouse_date:null,date_get_documents_from_supp:null,date_get_keys_from_supp:null,rate:null}),G=(A,n)=>{const E=A.target.files[0];if(E)switch(n){case"documents":v.value=E;break;case"sellPi":s.value=E;break;case"buyPi":m.value=E;break}},z=async(A,n,E="")=>{if(!A)return null;try{const M=A.name.split(".").pop().toLowerCase();let V="";switch(f.value.vin?V=`${f.value.vin}`:f.value.id?V=`car_${f.value.id}`:V=`new_car_${Date.now()}`,n){case"documents":V=`docs_${V}`;break;case"sell_pi":V=`sell_pi_${V}`;break;case"buy_pi":V=`buy_pi_${V}`;break}const le=new Date,oe=`${le.getFullYear()}${String(le.getMonth()+1).padStart(2,"0")}${String(le.getDate()).padStart(2,"0")}`;V=`${V}_${oe}.${M}`;const se=await F(A,n,V);if(se.success)return se.relativePath;throw new Error(se.message||"Upload failed")}catch(M){throw console.error(`Error uploading file to ${n}:`,M),M}};ie(()=>t.carData,A=>{A&&(f.value={...A,rate:A.rate?Number(A.rate):null},["date_sell","date_loding","date_send_documents","in_wharhouse_date","date_get_documents_from_supp","date_get_keys_from_supp"].forEach(E=>{if(f.value[E]){const M=new Date(f.value[E]);isNaN(M)||(f.value[E]=M.toISOString().split("T")[0])}}))},{immediate:!0});const X=async()=>{try{const A=await D({query:"SELECT id, name FROM clients ORDER BY name ASC",params:[]});A.success&&(P.value=A.data);const n=await D({query:"SELECT id, loading_port FROM loading_ports ORDER BY loading_port ASC",params:[]});n.success&&(u.value=n.data);const E=await D({query:"SELECT id, discharge_port FROM discharge_ports ORDER BY discharge_port ASC",params:[]});E.success&&(k.value=E.data);const M=await D({query:`
        SELECT bd.id, cn.car_name, clr.color 
        FROM buy_details bd
        LEFT JOIN cars_names cn ON bd.id_car_name = cn.id
        LEFT JOIN colors clr ON bd.id_color = clr.id
        ORDER BY bd.id DESC
      `,params:[]});M.success&&(Y.value=M.data);const V=await D({query:"SELECT id, warhouse_name as name FROM warehouses ORDER BY warhouse_name ASC",params:[]});V.success&&(J.value=V.data)}catch(A){L.value=A.message||"Failed to fetch reference data"}},ee=async()=>{x.value=!0,L.value=null;try{v.value&&(f.value.path_documents=await z(v.value,"documents")),s.value&&(f.value.sell_pi_path=await z(s.value,"sell_pi")),m.value&&(f.value.buy_pi_path=await z(m.value,"buy_pi"));const A=await D({query:`
        UPDATE cars_stock
        SET 
          notes = ?,
          id_buy_details = ?,
          date_sell = ?,
          id_client = ?,
          price_cell = ?,
          freight = ?,
          id_port_loading = ?,
          id_port_discharge = ?,
          vin = ?,
          path_documents = ?,
          date_loding = ?,
          date_send_documents = ?,
          id_sell_pi = ?,
          sell_pi_path = ?,
          buy_pi_path = ?,
          id_sell = ?,
          export_lisence_ref = ?,
          id_warehouse = ?,
          in_wharhouse_date = ?,
          date_get_documents_from_supp = ?,
          date_get_keys_from_supp = ?,
          rate = ?
        WHERE id = ?
      `,params:[f.value.notes||null,f.value.id_buy_details||null,f.value.date_sell||null,f.value.id_client||null,f.value.price_cell||null,f.value.freight||null,f.value.id_port_loading||null,f.value.id_port_discharge||null,f.value.vin||null,f.value.path_documents||null,f.value.date_loding||null,f.value.date_send_documents||null,f.value.id_sell_pi||null,f.value.sell_pi_path||null,f.value.buy_pi_path||null,f.value.id_sell||null,f.value.export_lisence_ref||null,f.value.id_warehouse||null,f.value.in_wharhouse_date||null,f.value.date_get_documents_from_supp||null,f.value.date_get_keys_from_supp||null,f.value.rate||null,f.value.id]});if(A.success)a("save");else throw new Error(A.error||"Failed to save car")}catch(A){L.value=A.message,console.error("Error saving car:",A)}finally{x.value=!1}};return ae(()=>{const A=localStorage.getItem("user");A&&(b.value=JSON.parse(A)),X()}),(A,n)=>(c(),p("div",la,[e("h3",null,$(f.value.id?"Edit":"Add")+" Car Stock",1),e("div",sa,[e("div",ta,[n[20]||(n[20]=e("h4",null,"Basic Information",-1)),e("div",aa,[n[16]||(n[16]=e("label",{for:"vin"},"VIN:",-1)),S(e("input",{disabled:!r.value,type:"text",id:"vin","onUpdate:modelValue":n[0]||(n[0]=E=>f.value.vin=E)},null,8,oa),[[R,f.value.vin]])]),e("div",na,[n[18]||(n[18]=e("label",{for:"id_buy_details"},"Buy Details:",-1)),S(e("select",{id:"id_buy_details","onUpdate:modelValue":n[1]||(n[1]=E=>f.value.id_buy_details=E)},[n[17]||(n[17]=e("option",{value:""},"Select Buy Details",-1)),(c(!0),p(W,null,q(Y.value,E=>(c(),p("option",{key:E.id,value:E.id},$(E.car_name)+" - "+$(E.color)+" (ID: "+$(E.id)+") ",9,ia))),128))],512),[[T,f.value.id_buy_details]])]),e("div",ra,[n[19]||(n[19]=e("label",{for:"notes"},"Notes:",-1)),S(e("textarea",{id:"notes","onUpdate:modelValue":n[2]||(n[2]=E=>f.value.notes=E)},null,512),[[R,f.value.notes]])])]),e("div",da,[n[27]||(n[27]=e("h4",null,"Pricing and Client",-1)),e("div",ua,[n[21]||(n[21]=e("label",{for:"price_cell"},"Price Cell:",-1)),S(e("input",{disabled:!g.value,type:"number",id:"price_cell","onUpdate:modelValue":n[3]||(n[3]=E=>f.value.price_cell=E),step:"0.01"},null,8,ca),[[R,f.value.price_cell]])]),e("div",va,[n[22]||(n[22]=e("label",{for:"freight"},"Freight:",-1)),S(e("input",{type:"number",id:"freight","onUpdate:modelValue":n[4]||(n[4]=E=>f.value.freight=E),step:"0.01"},null,512),[[R,f.value.freight]])]),e("div",pa,[n[23]||(n[23]=e("label",{for:"rate"},"Rate:",-1)),S(e("input",{disabled:!h.value,type:"number",id:"rate","onUpdate:modelValue":n[5]||(n[5]=E=>f.value.rate=E),step:"0.01"},null,8,_a),[[R,f.value.rate]])]),e("div",fa,[n[25]||(n[25]=e("label",{for:"id_client"},"Client:",-1)),S(e("select",{disabled:!i.value,id:"id_client","onUpdate:modelValue":n[6]||(n[6]=E=>f.value.id_client=E)},[n[24]||(n[24]=e("option",{value:""},"Select Client",-1)),(c(!0),p(W,null,q(P.value,E=>(c(),p("option",{key:E.id,value:E.id},$(E.name),9,ga))),128))],8,ma),[[T,f.value.id_client]])]),e("div",ha,[n[26]||(n[26]=e("label",{for:"date_sell"},"Sell Date:",-1)),S(e("input",{type:"date",id:"date_sell","onUpdate:modelValue":n[7]||(n[7]=E=>f.value.date_sell=E)},null,512),[[R,f.value.date_sell]])])]),e("div",ba,[n[34]||(n[34]=e("h4",null,"Ports and Shipping",-1)),e("div",ya,[n[29]||(n[29]=e("label",{for:"id_port_loading"},"Loading Port:",-1)),S(e("select",{id:"id_port_loading","onUpdate:modelValue":n[8]||(n[8]=E=>f.value.id_port_loading=E)},[n[28]||(n[28]=e("option",{value:""},"Select Loading Port",-1)),(c(!0),p(W,null,q(u.value,E=>(c(),p("option",{key:E.id,value:E.id},$(E.loading_port),9,$a))),128))],512),[[T,f.value.id_port_loading]])]),e("div",wa,[n[31]||(n[31]=e("label",{for:"id_port_discharge"},"Discharge Port:",-1)),S(e("select",{disabled:!l.value,id:"id_port_discharge","onUpdate:modelValue":n[9]||(n[9]=E=>f.value.id_port_discharge=E)},[n[30]||(n[30]=e("option",{value:""},"Select Discharge Port",-1)),(c(!0),p(W,null,q(k.value,E=>(c(),p("option",{key:E.id,value:E.id},$(E.discharge_port),9,Ca))),128))],8,ka),[[T,f.value.id_port_discharge]])]),e("div",Ea,[n[32]||(n[32]=e("label",{for:"date_loding"},"Loading Date:",-1)),S(e("input",{type:"date",id:"date_loding","onUpdate:modelValue":n[10]||(n[10]=E=>f.value.date_loding=E)},null,512),[[R,f.value.date_loding]])]),e("div",Sa,[n[33]||(n[33]=e("label",{for:"export_lisence_ref"},"Export License Ref:",-1)),S(e("input",{type:"text",id:"export_lisence_ref","onUpdate:modelValue":n[11]||(n[11]=E=>f.value.export_lisence_ref=E)},null,512),[[R,f.value.export_lisence_ref]])])]),e("div",Da,[n[35]||(n[35]=e("label",null,"Documents:",-1)),e("div",Fa,[e("input",{type:"file",onChange:n[12]||(n[12]=E=>G(E,"documents")),accept:".pdf",class:"file-input"},null,32),f.value.path_documents?(c(),p("a",{key:0,href:Z(w)(f.value.path_documents),target:"_blank",class:"current-file-link"}," View Current Document ",8,xa)):N("",!0)])]),e("div",Na,[n[36]||(n[36]=e("label",null,"Sell PI:",-1)),e("div",Aa,[e("input",{type:"file",onChange:n[13]||(n[13]=E=>G(E,"sellPi")),accept:".pdf",class:"file-input"},null,32),f.value.sell_pi_path?(c(),p("a",{key:0,href:Z(w)(f.value.sell_pi_path),target:"_blank",class:"current-file-link"}," View Sell PI ",8,La)):N("",!0)])]),e("div",Pa,[n[37]||(n[37]=e("label",null,"Buy PI:",-1)),e("div",Ra,[e("input",{type:"file",onChange:n[14]||(n[14]=E=>G(E,"buyPi")),accept:".pdf",class:"file-input"},null,32),f.value.buy_pi_path?(c(),p("a",{key:0,href:Z(w)(f.value.buy_pi_path),target:"_blank",class:"current-file-link"}," View Buy PI ",8,Ia)):N("",!0)])])]),e("div",Oa,[e("button",{onClick:ee,disabled:x.value,class:"btn save-btn"},$(x.value?"Saving...":"Save"),9,Ua),e("button",{onClick:n[15]||(n[15]=E=>A.$emit("cancel")),class:"btn cancel-btn"},"Cancel")]),L.value?(c(),p("div",Va,$(L.value),1)):N("",!0)]))}},Ma=j(Ta,[["__scopeId","data-v-06e69ffe"]]),Ba={class:"car-stock-filter"},Wa={class:"basic-filter"},qa={class:"filter-row"},ja={class:"filter-input"},Ya={class:"filter-actions"},Ha={key:0,class:"advanced-filters"},Ja={class:"filter-grid"},Ka={class:"filter-field"},Ga={class:"filter-field"},za=["value"],Qa={class:"filter-field"},Xa=["value"],Za={class:"filter-field"},eo={class:"filter-field"},lo=["value"],so={class:"filter-field"},to=["value"],ao={class:"filter-field range-field"},oo={class:"range-inputs"},no={class:"filter-field range-field"},io={class:"range-inputs"},ro={class:"filter-field range-field"},uo={class:"range-inputs"},co={class:"filter-field"},vo={class:"filter-field"},po=["value"],_o={class:"filter-field"},fo=["value"],mo={__name:"CarStockFilter",emits:["filter"],setup(I,{emit:O}){const t=O,{callApi:b}=H(),r=_([]),i=_([]),g=_([]),h=_([]),l=_([]),a=_([]),D=_(""),F=_(!1),w=_({id:"",car_name:"",color:"",vin:"",loading_port:"",discharge_port:"",freight_min:"",freight_max:"",price_min:"",price_max:"",loading_date_from:"",loading_date_to:"",status:"",client:"",warehouse:""}),x=async()=>{try{const P=await b({query:"SELECT id, car_name FROM cars_names ORDER BY car_name",params:[]});P.success&&(r.value=P.data);const u=await b({query:"SELECT id, color FROM colors ORDER BY color",params:[]});u.success&&(i.value=u.data);const k=await b({query:"SELECT id, loading_port FROM loading_ports ORDER BY loading_port",params:[]});k.success&&(g.value=k.data);const Y=await b({query:"SELECT id, discharge_port FROM discharge_ports ORDER BY discharge_port",params:[]});Y.success&&(h.value=Y.data);const J=await b({query:"SELECT id, name FROM clients ORDER BY name",params:[]});J.success&&(l.value=J.data);const f=await b({query:"SELECT id, name FROM warehouses ORDER BY name",params:[]});f.success&&(a.value=f.data)}catch(P){console.error("Error fetching reference data:",P)}},L=()=>{if(!D.value.trim()){s();return}t("filter",{basic:D.value,advanced:null})},v=()=>{t("filter",{basic:null,advanced:w.value})},s=()=>{D.value="",Object.keys(w.value).forEach(P=>{w.value[P]=""}),t("filter",{basic:"",advanced:null})},m=()=>{F.value=!F.value};return x(),(P,u)=>(c(),p("div",Ba,[e("div",Wa,[e("div",qa,[e("div",ja,[S(e("input",{type:"text","onUpdate:modelValue":u[0]||(u[0]=k=>D.value=k),placeholder:"Search by ID, Car, Color, VIN, Ports, Client...",onInput:L},null,544),[[R,D.value]])]),e("div",Ya,[e("button",{onClick:m,class:"toggle-btn"},$(F.value?"Hide Advanced":"Show Advanced"),1),e("button",{onClick:s,class:"reset-btn"},"Reset")])])]),F.value?(c(),p("div",Ha,[e("div",Ja,[e("div",Ka,[u[16]||(u[16]=e("label",{for:"id-filter"},"ID",-1)),S(e("input",{id:"id-filter",type:"text","onUpdate:modelValue":u[1]||(u[1]=k=>w.value.id=k),placeholder:"Car ID"},null,512),[[R,w.value.id]])]),e("div",Ga,[u[18]||(u[18]=e("label",{for:"car-name-filter"},"Car",-1)),S(e("select",{id:"car-name-filter","onUpdate:modelValue":u[2]||(u[2]=k=>w.value.car_name=k)},[u[17]||(u[17]=e("option",{value:""},"All Cars",-1)),(c(!0),p(W,null,q(r.value,k=>(c(),p("option",{key:k.id,value:k.car_name},$(k.car_name),9,za))),128))],512),[[T,w.value.car_name]])]),e("div",Qa,[u[20]||(u[20]=e("label",{for:"color-filter"},"Color",-1)),S(e("select",{id:"color-filter","onUpdate:modelValue":u[3]||(u[3]=k=>w.value.color=k)},[u[19]||(u[19]=e("option",{value:""},"All Colors",-1)),(c(!0),p(W,null,q(i.value,k=>(c(),p("option",{key:k.id,value:k.color},$(k.color),9,Xa))),128))],512),[[T,w.value.color]])]),e("div",Za,[u[21]||(u[21]=e("label",{for:"vin-filter"},"VIN",-1)),S(e("input",{id:"vin-filter",type:"text","onUpdate:modelValue":u[4]||(u[4]=k=>w.value.vin=k),placeholder:"VIN Number"},null,512),[[R,w.value.vin]])]),e("div",eo,[u[23]||(u[23]=e("label",{for:"loading-port-filter"},"Loading Port",-1)),S(e("select",{id:"loading-port-filter","onUpdate:modelValue":u[5]||(u[5]=k=>w.value.loading_port=k)},[u[22]||(u[22]=e("option",{value:""},"All Loading Ports",-1)),(c(!0),p(W,null,q(g.value,k=>(c(),p("option",{key:k.id,value:k.loading_port},$(k.loading_port),9,lo))),128))],512),[[T,w.value.loading_port]])]),e("div",so,[u[25]||(u[25]=e("label",{for:"discharge-port-filter"},"Discharge Port",-1)),S(e("select",{id:"discharge-port-filter","onUpdate:modelValue":u[6]||(u[6]=k=>w.value.discharge_port=k)},[u[24]||(u[24]=e("option",{value:""},"All Discharge Ports",-1)),(c(!0),p(W,null,q(h.value,k=>(c(),p("option",{key:k.id,value:k.discharge_port},$(k.discharge_port),9,to))),128))],512),[[T,w.value.discharge_port]])]),e("div",ao,[u[26]||(u[26]=e("label",null,"Freight Range",-1)),e("div",oo,[S(e("input",{type:"number","onUpdate:modelValue":u[7]||(u[7]=k=>w.value.freight_min=k),placeholder:"Min"},null,512),[[R,w.value.freight_min]]),S(e("input",{type:"number","onUpdate:modelValue":u[8]||(u[8]=k=>w.value.freight_max=k),placeholder:"Max"},null,512),[[R,w.value.freight_max]])])]),e("div",no,[u[27]||(u[27]=e("label",null,"Price Range",-1)),e("div",io,[S(e("input",{type:"number","onUpdate:modelValue":u[9]||(u[9]=k=>w.value.price_min=k),placeholder:"Min"},null,512),[[R,w.value.price_min]]),S(e("input",{type:"number","onUpdate:modelValue":u[10]||(u[10]=k=>w.value.price_max=k),placeholder:"Max"},null,512),[[R,w.value.price_max]])])]),e("div",ro,[u[28]||(u[28]=e("label",null,"Loading Date Range",-1)),e("div",uo,[S(e("input",{type:"date","onUpdate:modelValue":u[11]||(u[11]=k=>w.value.loading_date_from=k)},null,512),[[R,w.value.loading_date_from]]),S(e("input",{type:"date","onUpdate:modelValue":u[12]||(u[12]=k=>w.value.loading_date_to=k)},null,512),[[R,w.value.loading_date_to]])])]),e("div",co,[u[30]||(u[30]=e("label",{for:"status-filter"},"Status",-1)),S(e("select",{id:"status-filter","onUpdate:modelValue":u[13]||(u[13]=k=>w.value.status=k)},u[29]||(u[29]=[e("option",{value:""},"All Status",-1),e("option",{value:"available"},"Available",-1),e("option",{value:"sold"},"Sold",-1)]),512),[[T,w.value.status]])]),e("div",vo,[u[32]||(u[32]=e("label",{for:"client-filter"},"Client",-1)),S(e("select",{id:"client-filter","onUpdate:modelValue":u[14]||(u[14]=k=>w.value.client=k)},[u[31]||(u[31]=e("option",{value:""},"All Clients",-1)),(c(!0),p(W,null,q(l.value,k=>(c(),p("option",{key:k.id,value:k.name},$(k.name),9,po))),128))],512),[[T,w.value.client]])]),e("div",_o,[u[34]||(u[34]=e("label",{for:"warehouse-filter"},"Warehouse",-1)),S(e("select",{id:"warehouse-filter","onUpdate:modelValue":u[15]||(u[15]=k=>w.value.warehouse=k)},[u[33]||(u[33]=e("option",{value:""},"All Warehouses",-1)),(c(!0),p(W,null,q(a.value,k=>(c(),p("option",{key:k.id,value:k.name},$(k.name),9,fo))),128))],512),[[T,w.value.warehouse]])]),e("div",{class:"advanced-filter-actions"},[e("button",{onClick:v,class:"apply-btn"},"Apply Filters"),e("button",{onClick:s,class:"reset-btn"},"Reset All")])])])):N("",!0)]))}},go=j(mo,[["__scopeId","data-v-d3e3d315"]]),ho={class:"cars-stock"},bo={class:"content"},yo={key:0,class:"dialog-overlay"},$o={class:"dialog"},wo={__name:"CarsStock",setup(I){const O=De(),t=_(!1),b=_(null),r=_(null),i=_({basic:"",advanced:null}),g=D=>{b.value={...D},t.value=!0},h=()=>{t.value=!1,r.value&&r.value.fetchCarsStock()},l=D=>{i.value=D,r.value&&r.value.fetchCarsStock()},a=()=>{O.push("/warehouses")};return(D,F)=>(c(),p("div",ho,[F[1]||(F[1]=e("div",{class:"header"},[e("h2",null,"Cars Stock Management")],-1)),e("div",bo,[te(go,{onFilter:l}),te(ea,{ref_key:"carStockTableRef",ref:r,onEdit:g,filters:i.value},null,8,["filters"]),e("div",{class:"warehouses-button-container"},[e("button",{onClick:a,class:"warehouses-btn"}," Manage Warehouses ")])]),t.value?(c(),p("div",yo,[e("div",$o,[te(Ma,{carData:b.value,onSave:h,onCancel:F[0]||(F[0]=w=>t.value=!1)},null,8,["carData"])])])):N("",!0)]))}},Co=j(wo,[["__scopeId","data-v-ec68617c"]]);export{Co as default};
//# sourceMappingURL=CarsStock.CUGVvKds.js.map

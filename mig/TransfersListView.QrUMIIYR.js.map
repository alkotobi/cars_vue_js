{"version":3,"file":"TransfersListView.QrUMIIYR.js","sources":["../src/views/TransfersListView.vue"],"sourcesContent":["<script setup>\nimport { ref, onMounted } from 'vue'\nimport { useApi } from '../composables/useApi'\n\nconst { callApi } = useApi()\nconst transfers = ref([])\nconst showEditDialog = ref(false)\nconst selectedTransfer = ref(null)\nconst editForm = ref({\n  amount_sending_da: '',\n  rate: '',\n  notes: '',\n  amount_received_usd: '',\n  receiver_notes: ''\n})\n\nconst fetchTransfers = async () => {\n  const result = await callApi({\n    query: `\n      SELECT t.*, \n        u_sender.username as sender_name,\n        u_receiver.username as receiver_name\n      FROM transfers t\n      LEFT JOIN users u_sender ON t.id_user_do_transfer = u_sender.id\n      LEFT JOIN users u_receiver ON t.id_user_receive_transfer = u_receiver.id\n      ORDER BY t.date_do_transfer DESC\n    `,\n    params: []\n  })\n  if (result.success) {\n    transfers.value = result.data\n  }\n}\n\nconst calculateUSD = (amount, rate) => {\n  return (amount / rate).toFixed(2)\n}\n\nconst openEditDialog = (transfer) => {\n  selectedTransfer.value = transfer\n  editForm.value = {\n    amount_sending_da: transfer.amount_sending_da,\n    rate: transfer.rate,\n    notes: transfer.notes || '',\n    amount_received_usd: transfer.amount_received_usd || '',\n    receiver_notes: transfer.receiver_notes || ''\n  }\n  showEditDialog.value = true\n}\n\nconst updateTransfer = async () => {\n  const result = await callApi({\n    query: `\n      UPDATE transfers SET\n        amount_sending_da = ?,\n        rate = ?,\n        notes = ?,\n        amount_received_usd = ?,\n        receiver_notes = ?\n      WHERE id = ?\n    `,\n    params: [\n      editForm.value.amount_sending_da,\n      editForm.value.rate,\n      editForm.value.notes,\n      editForm.value.amount_received_usd,\n      editForm.value.receiver_notes,\n      selectedTransfer.value.id\n    ]\n  })\n\n  if (result.success) {\n    showEditDialog.value = false\n    fetchTransfers()\n  }\n}\nonMounted(() => {\n  fetchTransfers()\n})\nconst deleteTransfer = async (transfer) => {\n  if (!confirm('Are you sure you want to delete this transfer permanently?')) return\n  \n  const result = await callApi({\n    query: `DELETE FROM transfers WHERE id = ?`,\n    params: [transfer.id]\n  })\n\n  if (result.success) {\n    fetchTransfers()\n  }\n}\n</script>\n\n<template>\n  <div class=\"transfers-list-view\">\n    <h1>All Transfers List</h1>\n    <button @click=\"$router.push('/transfers')\" class=\"back-btn\">‚Üê Return to Transfers</button>\n\n    <div class=\"transfers-table\">\n      <table>\n        <thead>\n          <tr>\n            <th>Sender</th>\n            <th>Date Sent</th>\n            <th>Amount DA</th>\n            <th>Rate</th>\n            <th>USD Sent</th>\n            <th>Notes</th>\n            <th>Receiver</th>\n            <th>Date Received</th>\n            <th>Received USD</th>\n            <th>Receiver Notes</th>\n            <th>Actions</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for=\"transfer in transfers\" \n              :key=\"transfer.id\"\n              :class=\"{\n                'not-received': !transfer.date_receive,\n                'amount-mismatch': transfer.date_receive && calculateUSD(transfer.amount_sending_da, transfer.rate) !== transfer.amount_received_usd\n              }\">\n            <td>{{ transfer.sender_name }}</td>\n            <td>{{ new Date(transfer.date_do_transfer).toLocaleString() }}</td>\n            <td>{{ transfer.amount_sending_da }}</td>\n            <td>{{ transfer.rate }}</td>\n            <td>${{ calculateUSD(transfer.amount_sending_da, transfer.rate) }}</td>\n            <td>{{ transfer.notes || '-' }}</td>\n            <td>{{ transfer.receiver_name || '-' }}</td>\n            <td>{{ transfer.date_receive ? new Date(transfer.date_receive).toLocaleString() : '-' }}</td>\n            <td>{{ transfer.amount_received_usd ? `$${transfer.amount_received_usd}` : '-' }}</td>\n            <td>{{ transfer.receiver_notes || '-' }}</td>\n            <td>\n              <div class=\"action-buttons\">\n                <button @click=\"openEditDialog(transfer)\" class=\"btn edit-btn\">\n                  Edit\n                </button>\n                <button @click=\"deleteTransfer(transfer)\" class=\"btn delete-btn\">\n                  Delete\n                </button>\n              </div>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <!-- Edit Dialog -->\n    <div v-if=\"showEditDialog\" class=\"dialog-overlay\">\n      <div class=\"dialog\">\n        <h2>Edit Transfer</h2>\n        <div class=\"form-group\">\n          <label>Amount Sending (DA):</label>\n          <input type=\"number\" v-model=\"editForm.amount_sending_da\" step=\"0.01\"/>\n        </div>\n        <div class=\"form-group\">\n          <label>Rate:</label>\n          <input type=\"number\" v-model=\"editForm.rate\" step=\"0.0001\"/>\n        </div>\n        <div class=\"form-group\">\n          <label>Notes:</label>\n          <textarea v-model=\"editForm.notes\"/>\n        </div>\n        <div class=\"form-group\">\n          <label>Received USD:</label>\n          <input type=\"number\" v-model=\"editForm.amount_received_usd\" step=\"0.01\"/>\n        </div>\n        <div class=\"form-group\">\n          <label>Receiver Notes:</label>\n          <textarea v-model=\"editForm.receiver_notes\"/>\n        </div>\n        <div class=\"dialog-actions\">\n          <button @click=\"updateTransfer\" class=\"btn save-btn\">Save</button>\n          <button @click=\"showEditDialog = false\" class=\"btn cancel-btn\">Cancel</button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.transfers-list-view {\n  padding: 20px;\n  width: 90vw;\n}\n\n.transfers-table {\n  overflow-x: auto;\n  margin: 20px 0;\n}\n\ntable {\n  width: 100%;\n  border-collapse: collapse;\n  table-layout: fixed;\n}\n\nth, td {\n  padding: 12px;\n  text-align: left;\n  border-bottom: 1px solid #ddd;\n  word-wrap: break-word;\n}\n\nth {\n  background-color: #f8f9fa;\n  font-weight: 600;\n}\n\n/* Add to existing styles */\n.action-buttons {\n  display: flex;\n  gap: 8px;\n}\n\n.btn.delete-btn {\n  background-color: #DC2626;\n  color: white;\n}\n\n/* Adjust action column width */\nth:nth-child(11) { width: 9%; }  /* Actions */\n\n/* Adjusted column widths */\nth:nth-child(1) { width: 9%; }   /* Sender */\nth:nth-child(2) { width: 10%; }  /* Date Sent */\nth:nth-child(3) { width: 7%; }   /* Amount DA */\nth:nth-child(4) { width: 6%; }   /* Rate */\nth:nth-child(5) { width: 7%; }   /* USD Sent */\nth:nth-child(6) { width: 12%; }  /* Notes */\nth:nth-child(7) { width: 8%; }   /* Receiver */\nth:nth-child(8) { width: 10%; }  /* Date Received */\nth:nth-child(9) { width: 7%; }   /* Received USD */\nth:nth-child(10) { width: 9%; }  /* Receiver Notes */\nth:nth-child(11) { width: 7%; }  /* Actions */\n\n.back-btn {\n  padding: 8px 16px;\n  background-color: #4b5563;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  margin-top: 20px;\n}\n\n.btn.edit-btn {\n  background-color: #3b82f6;\n  color: white;\n}\n\n.dialog-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.dialog {\n  background-color: white;\n  padding: 20px;\n  border-radius: 8px;\n  min-width: 400px;\n}\n\n.form-group {\n  margin-bottom: 15px;\n}\n\n.form-group label {\n  display: block;\n  margin-bottom: 5px;\n}\n\n.form-group input,\n.form-group textarea {\n  width: 100%;\n  padding: 8px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n}\n\n.dialog-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 10px;\n  margin-top: 20px;\n}\n\n.btn.save-btn {\n  background-color: #10b981;\n}\n\n/* Add status highlighting */\n.not-received {\n  background-color: #FFEBEE;  /* Light red for unreceived */\n}\n\n.amount-mismatch {\n  background-color: #FFCDD2;  /* Darker red for amount mismatch */\n}\n\n/* Keep existing styles */\n.form-group label {\n  display: block;\n  margin-bottom: 5px;\n}\n\n.form-group input,\n.form-group textarea {\n  width: 100%;\n  padding: 8px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n}\n\n.dialog-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 10px;\n  margin-top: 20px;\n}\n\n.btn.save-btn {\n  background-color: #10b981;\n}\n\n@media print {\n  .action-buttons,\n  th:nth-child(6),\n  td:nth-child(6),\n  th:nth-child(10),\n  td:nth-child(10),\n  th:nth-child(11),\n  td:nth-child(11) {\n    display: none !important;\n  }\n\n  /* Adjusted print column widths */\n  th:nth-child(1) { width: 15% !important; }\n  th:nth-child(2) { width: 16% !important; }\n  th:nth-child(3) { width: 10% !important; }\n  th:nth-child(4) { width: 8% !important; }\n  th:nth-child(5) { width: 10% !important; }\n  th:nth-child(7) { width: 12% !important; }\n  th:nth-child(8) { width: 15% !important; }\n  th:nth-child(9) { width: 14% !important; }\n}\n</style>\n\n"],"names":["callApi","useApi","transfers","ref","showEditDialog","selectedTransfer","editForm","fetchTransfers","result","calculateUSD","amount","rate","openEditDialog","transfer","updateTransfer","onMounted","deleteTransfer"],"mappings":"qeAIA,KAAM,CAAE,QAAAA,CAAS,EAAGC,EAAM,EACpBC,EAAYC,EAAI,CAAE,CAAA,EAClBC,EAAiBD,EAAI,EAAK,EAC1BE,EAAmBF,EAAI,IAAI,EAC3BG,EAAWH,EAAI,CACnB,kBAAmB,GACnB,KAAM,GACN,MAAO,GACP,oBAAqB,GACrB,eAAgB,EAClB,CAAC,EAEKI,EAAiB,SAAY,CACjC,MAAMC,EAAS,MAAMR,EAAQ,CAC3B,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MASP,OAAQ,CAAA,CACT,CAAA,EACGQ,EAAO,UACTN,EAAU,MAAQM,EAAO,KAE7B,EAEMC,EAAe,CAACC,EAAQC,KACpBD,EAASC,GAAM,QAAQ,CAAC,EAG5BC,EAAkBC,GAAa,CACnCR,EAAiB,MAAQQ,EACzBP,EAAS,MAAQ,CACf,kBAAmBO,EAAS,kBAC5B,KAAMA,EAAS,KACf,MAAOA,EAAS,OAAS,GACzB,oBAAqBA,EAAS,qBAAuB,GACrD,eAAgBA,EAAS,gBAAkB,EAC/C,EACET,EAAe,MAAQ,EACzB,EAEMU,EAAiB,SAAY,EAClB,MAAMd,EAAQ,CAC3B,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MASP,OAAQ,CACNM,EAAS,MAAM,kBACfA,EAAS,MAAM,KACfA,EAAS,MAAM,MACfA,EAAS,MAAM,oBACfA,EAAS,MAAM,eACfD,EAAiB,MAAM,EAC7B,CACG,CAAA,GAEU,UACTD,EAAe,MAAQ,GACvBG,EAAc,EAElB,EACAQ,EAAU,IAAM,CACdR,EAAc,CAChB,CAAC,EACD,MAAMS,EAAiB,MAAOH,GAAa,CACzC,GAAI,CAAC,QAAQ,4DAA4D,EAAG,QAE7D,MAAMb,EAAQ,CAC3B,MAAO,qCACP,OAAQ,CAACa,EAAS,EAAE,CACrB,CAAA,GAEU,SACTN,EAAc,CAElB"}
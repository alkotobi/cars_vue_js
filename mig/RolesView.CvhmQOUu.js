import{_ as T,u as U,r as b,o as D,c as l,a as s,b as V,F as g,d as P,w as R,v as y,f as m,t as f,g as c,h as S,i as q}from"./index.DUoj9obe.js";const O={class:"roles-container"},A={class:"content-container"},L={class:"items-list"},x={key:0,class:"edit-form"},M={class:"button-group"},F=["onClick","disabled"],N={key:1,class:"item-content"},I={class:"item-text"},H={class:"description"},W={class:"button-group"},B=["onClick"],j=["onClick","disabled"],z={class:"add-form"},G=["disabled"],J={key:0,class:"error-message"},K={__name:"RolesCrud",setup(w){const{callApi:a,error:_,loading:h}=U(),p=b([]),o=b({role_name:"",description:""}),E=b(null),i=b({role_name:"",description:""}),v=async()=>{const e=await a({query:"SELECT * FROM roles"});e.success&&(p.value=e.data)},k=async()=>{if(!o.value.role_name)return;(await a({query:"INSERT INTO roles (role_name, description) VALUES (?, ?)",params:[o.value.role_name,o.value.description]})).success&&(v(),o.value={role_name:"",description:""})},C=e=>{E.value=e.id,i.value={role_name:e.role_name,description:e.description}},$=()=>{E.value=null,i.value={role_name:"",description:""}},r=async e=>{(await a({query:"UPDATE roles SET role_name = ?, description = ? WHERE id = ?",params:[i.value.role_name,i.value.description,e.id]})).success&&(v(),$())},d=async e=>{if(!confirm(`Are you sure you want to delete the role "${e.role_name}"?`))return;const t=await a({query:"SELECT COUNT(*) as count FROM users WHERE role_id = ?",params:[e.id]});if(t.success&&t.data[0].count>0){_.value=`Cannot delete role "${e.role_name}" because it is assigned to ${t.data[0].count} user(s)`;return}(await a({query:"DELETE FROM roles WHERE id = ?",params:[e.id]})).success&&v()};return D(()=>{v()}),(e,t)=>(c(),l("div",O,[t[4]||(t[4]=s("h2",{class:"title"},"Roles",-1)),s("div",A,[s("ul",L,[(c(!0),l(g,null,P(p.value,n=>(c(),l("li",{key:n.id,class:"item"},[E.value===n.id?(c(),l("div",x,[R(s("input",{"onUpdate:modelValue":t[0]||(t[0]=u=>i.value.role_name=u),placeholder:"Role name",class:"input-field"},null,512),[[y,i.value.role_name]]),R(s("input",{"onUpdate:modelValue":t[1]||(t[1]=u=>i.value.description=u),placeholder:"Description",class:"input-field"},null,512),[[y,i.value.description]]),s("div",M,[s("button",{onClick:u=>r(n),disabled:m(h),class:"btn save-btn"},"Save",8,F),s("button",{onClick:$,class:"btn cancel-btn"},"Cancel")])])):(c(),l("div",N,[s("div",I,[s("strong",null,f(n.role_name),1),s("span",H,f(n.description),1)]),s("div",W,[s("button",{onClick:u=>C(n),class:"btn edit-btn"},"Edit",8,B),s("button",{onClick:u=>d(n),disabled:m(h),class:"btn delete-btn"},"Delete",8,j)])]))]))),128))]),s("div",z,[R(s("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>o.value.role_name=n),placeholder:"Role name",class:"input-field"},null,512),[[y,o.value.role_name]]),R(s("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>o.value.description=n),placeholder:"Description",class:"input-field"},null,512),[[y,o.value.description]]),s("button",{onClick:k,disabled:m(h),class:"btn add-btn"},"Add Role",8,G)]),m(_)?(c(),l("div",J,f(m(_)),1)):V("",!0)])]))}},Q=T(K,[["__scopeId","data-v-2e68a000"]]),X={class:"permissions-container"},Y={class:"content-container"},Z={class:"items-list"},ss={key:0,class:"edit-form"},es={class:"button-group"},ts=["onClick","disabled"],ns={key:1,class:"item-content"},is={class:"item-text"},os={class:"description"},as={class:"button-group"},ls=["onClick"],cs=["onClick","disabled"],rs={class:"add-form"},ds=["disabled"],us={key:0,class:"error-message"},ms={__name:"PermissionsCrud",setup(w){const{callApi:a,error:_,loading:h}=U(),p=b([]),o=b({permission_name:"",description:""}),E=b(null),i=b({permission_name:"",description:""}),v=async()=>{const e=await a({query:"SELECT * FROM permissions"});e.success&&(p.value=e.data)},k=async()=>{if(!o.value.permission_name)return;(await a({query:"INSERT INTO permissions (permission_name, description) VALUES (?, ?)",params:[o.value.permission_name,o.value.description]})).success&&(v(),o.value={permission_name:"",description:""})},C=e=>{E.value=e.id,i.value={permission_name:e.permission_name,description:e.description}},$=()=>{E.value=null,i.value={permission_name:"",description:""}},r=async e=>{(await a({query:"UPDATE permissions SET permission_name = ?, description = ? WHERE id = ?",params:[i.value.permission_name,i.value.description,e.id]})).success&&(v(),$())},d=async e=>{if(!confirm(`Are you sure you want to delete the permission "${e.permission_name}"?`))return;const t=await a({query:"SELECT COUNT(*) as count FROM role_permissions WHERE permission_id = ?",params:[e.id]});if(t.success&&t.data[0].count>0){_.value=`Cannot delete permission "${e.permission_name}" because it is assigned to ${t.data[0].count} role(s)`;return}(await a({query:"DELETE FROM permissions WHERE id = ?",params:[e.id]})).success&&v()};return D(()=>{v()}),(e,t)=>(c(),l("div",X,[t[4]||(t[4]=s("h2",{class:"title"},"Permissions",-1)),s("div",Y,[s("ul",Z,[(c(!0),l(g,null,P(p.value,n=>(c(),l("li",{key:n.id,class:"item"},[E.value===n.id?(c(),l("div",ss,[R(s("input",{"onUpdate:modelValue":t[0]||(t[0]=u=>i.value.permission_name=u),placeholder:"Permission name",class:"input-field"},null,512),[[y,i.value.permission_name]]),R(s("input",{"onUpdate:modelValue":t[1]||(t[1]=u=>i.value.description=u),placeholder:"Description",class:"input-field"},null,512),[[y,i.value.description]]),s("div",es,[s("button",{onClick:u=>r(n),disabled:m(h),class:"btn save-btn"},"Save",8,ts),s("button",{onClick:$,class:"btn cancel-btn"},"Cancel")])])):(c(),l("div",ns,[s("div",is,[s("strong",null,f(n.permission_name),1),s("span",os,f(n.description),1)]),s("div",as,[s("button",{onClick:u=>C(n),class:"btn edit-btn"},"Edit",8,ls),s("button",{onClick:u=>d(n),disabled:m(h),class:"btn delete-btn"},"Delete",8,cs)])]))]))),128))]),s("div",rs,[R(s("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>o.value.permission_name=n),placeholder:"Permission name",class:"input-field"},null,512),[[y,o.value.permission_name]]),R(s("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>o.value.description=n),placeholder:"Description",class:"input-field"},null,512),[[y,o.value.description]]),s("button",{onClick:k,disabled:m(h),class:"btn add-btn"},"Add Permission",8,ds)]),m(_)?(c(),l("div",us,f(m(_)),1)):V("",!0)])]))}},_s=T(ms,[["__scopeId","data-v-0b56004a"]]),ps={class:"role-permissions-container"},vs={class:"table-container"},bs={class:"role-name"},hs={class:"permissions-cell"},Es={class:"checkbox-label"},fs=["checked","onChange","disabled"],Rs={class:"checkbox-text"},ys={key:0,class:"error-message"},$s={__name:"RolePermissionsCrud",setup(w){const{callApi:a,error:_,loading:h}=U(),p=b([]),o=b([]),E=b([]),i=async()=>{const r=await a({query:"SELECT * FROM role_permissions"});r.success&&(p.value=r.data)},v=async()=>{const r=await a({query:"SELECT * FROM roles"});r.success&&(o.value=r.data)},k=async()=>{const r=await a({query:"SELECT * FROM permissions"});r.success&&(E.value=r.data)},C=(r,d)=>p.value.some(e=>e.role_id===r&&e.permission_id===d),$=async(r,d,e)=>{e?(await a({query:"INSERT INTO role_permissions (role_id, permission_id) VALUES (?, ?)",params:[r,d]})).success&&i():(await a({query:"DELETE FROM role_permissions WHERE role_id = ? AND permission_id = ?",params:[r,d]})).success&&i()};return D(()=>{i(),v(),k()}),(r,d)=>(c(),l("div",ps,[d[1]||(d[1]=s("h2",{class:"title"},"Role Permissions",-1)),s("div",vs,[s("table",null,[d[0]||(d[0]=s("thead",null,[s("tr",null,[s("th",null,"Role"),s("th",null,"Permissions")])],-1)),s("tbody",null,[(c(!0),l(g,null,P(o.value,e=>(c(),l("tr",{key:e.id},[s("td",bs,f(e.role_name),1),s("td",hs,[(c(!0),l(g,null,P(E.value,t=>(c(),l("div",{class:"permission-item",key:t.id},[s("label",Es,[s("input",{type:"checkbox",checked:C(e.id,t.id),onChange:n=>$(e.id,t.id,n.target.checked),disabled:m(h)},null,40,fs),s("span",Rs,f(t.permission_name),1)])]))),128))])]))),128))])])]),m(_)?(c(),l("div",ys,f(m(_)),1)):V("",!0)]))}},ks=T($s,[["__scopeId","data-v-c35c3257"]]),Cs={class:"roles-page"},gs={class:"crud-section"},Ps={__name:"RolesView",setup(w){const a=q(),_=()=>{a.push("/users")};return(h,p)=>(c(),l("div",Cs,[s("div",{class:"header"},[s("button",{onClick:_,class:"back-btn"},"‚Üê Return to Users"),p[0]||(p[0]=s("h1",null,"Roles, Permissions, and Role Permissions Management",-1))]),s("div",gs,[S(Q),S(_s),S(ks)])]))}},ws=T(Ps,[["__scopeId","data-v-f795bdb2"]]);export{ws as default};
//# sourceMappingURL=RolesView.CvhmQOUu.js.map

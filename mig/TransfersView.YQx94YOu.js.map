{"version":3,"file":"TransfersView.YQx94YOu.js","sources":["../src/views/TransfersView.vue"],"sourcesContent":["<script setup>\nimport { ref, computed, onMounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useApi } from '../composables/useApi'\n\nconst router = useRouter()\nconst { callApi, error } = useApi()\nconst user = ref(null)\nconst transfers = ref([])\n\nconst canSendTransfer = computed(() => {\n  if (!user.value) return false\n  if (user.value.role_id === 1) return true\n  return user.value.permissions?.some(p => p.permission_name === 'is_exchange_sender')\n})\n\nconst canReceiveTransfer = computed(() => {\n  if (!user.value) return false\n  if (user.value.role_id === 1) return true\n  return user.value.permissions?.some(p => p.permission_name === 'is_exchange_receiver')\n})\n\nconst canViewTransfersList = computed(() => {\n  return user.value?.role_id === 1\n})\n\n// Statistics computations\nconst statistics = computed(() => {\n  if (!transfers.value.length) return {\n    totalSent: 0,\n    totalReceived: 0,\n    totalPending: 0,\n    totalPendingDA: 0,\n    totalPendingUSD: 0\n  }\n\n  const stats = transfers.value.reduce((acc, transfer) => {\n    // Count total sent\n    acc.totalSent++\n\n    if (transfer.date_receive) {\n      // Count received transfers\n      acc.totalReceived++\n    } else {\n      // Count pending transfers\n      acc.totalPending++\n      // Sum pending amounts\n      acc.totalPendingDA += parseFloat(transfer.amount_sending_da)\n      acc.totalPendingUSD += parseFloat(transfer.amount_sending_da) / parseFloat(transfer.rate)\n    }\n\n    return acc\n  }, {\n    totalSent: 0,\n    totalReceived: 0,\n    totalPending: 0,\n    totalPendingDA: 0,\n    totalPendingUSD: 0\n  })\n\n  // Round USD to 2 decimal places\n  stats.totalPendingUSD = Math.round(stats.totalPendingUSD * 100) / 100\n\n  return stats\n})\n\nconst fetchTransfers = async () => {\n  const result = await callApi({\n    query: `\n      SELECT t.* \n      FROM transfers t\n      WHERE t.id_user_do_transfer = ?\n      ORDER BY t.date_do_transfer DESC\n    `,\n    params: [user.value.id]\n  })\n  if (result.success) {\n    transfers.value = result.data\n  }\n}\n\nonMounted(() => {\n  const userStr = localStorage.getItem('user')\n  if (userStr) {\n    user.value = JSON.parse(userStr)\n    fetchTransfers()\n  }\n})\n</script>\n\n<template>\n  <div class=\"transfers-page\">\n    <div class=\"sidebar\">\n      <router-link to=\"/dashboard\" class=\"dashboard-btn\">‚Üê Return to Dashboard</router-link>\n      <div class=\"nav-buttons\">\n        <router-link \n          v-if=\"canViewTransfersList\" \n          to=\"/transfers-list\" \n          class=\"nav-btn\"\n        >\n          Transfers List\n        </router-link>\n        <router-link \n          v-if=\"canSendTransfer\" \n          to=\"/send\" \n          class=\"nav-btn\"\n        >\n          Send Transfer\n        </router-link>\n        <router-link \n          v-if=\"canReceiveTransfer\" \n          to=\"/receive\" \n          class=\"nav-btn\"\n        >\n          Receive Transfer\n        </router-link>\n      </div>\n    </div>\n    <div class=\"main-content\">\n      <!-- Statistics Section -->\n      <div class=\"statistics-container\">\n        <h2>Transfer Statistics</h2>\n        <div class=\"statistics-grid\">\n          <div class=\"stat-card\">\n            <span class=\"stat-label\">Total Sent</span>\n            <span class=\"stat-value\">{{ statistics.totalSent }}</span>\n          </div>\n          <div class=\"stat-card\">\n            <span class=\"stat-label\">Total Received</span>\n            <span class=\"stat-value\">{{ statistics.totalReceived }}</span>\n          </div>\n          <div class=\"stat-card\">\n            <span class=\"stat-label\">Pending Transfers</span>\n            <span class=\"stat-value\">{{ statistics.totalPending }}</span>\n          </div>\n          <div class=\"stat-card\">\n            <span class=\"stat-label\">Total Pending (DA)</span>\n            <span class=\"stat-value\">{{ statistics.totalPendingDA.toLocaleString() }} DA</span>\n          </div>\n          <div class=\"stat-card\">\n            <span class=\"stat-label\">Total Pending (USD)</span>\n            <span class=\"stat-value\">${{ statistics.totalPendingUSD.toLocaleString() }}</span>\n          </div>\n        </div>\n      </div>\n      <router-view></router-view>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.transfers-page {\n  display: flex;\n  min-height: 100vh;\n}\n\n.sidebar {\n  width: 250px;\n  background-color: #f3f4f6;\n  padding: 20px;\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n.nav-buttons {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n\n.nav-btn {\n  padding: 10px;\n  background-color: #3b82f6;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  text-decoration: none;\n  text-align: center;\n}\n\n.nav-btn:hover {\n  background-color: #2563eb;\n}\n\n.main-content {\n  flex: 1;\n  padding: 20px;\n}\n\n.dashboard-btn {\n  padding: 8px 16px;\n  background-color: #4b5563;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  text-decoration: none;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.dashboard-btn:hover {\n  background-color: #374151;\n}\n\n.statistics-container {\n  margin-bottom: 30px;\n}\n\n.statistics-container h2 {\n  color: #1f2937;\n  font-size: 1.5em;\n  margin-bottom: 20px;\n}\n\n.statistics-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 20px;\n}\n\n.stat-card {\n  background-color: #ffffff;\n  padding: 20px;\n  border-radius: 8px;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  text-align: center;\n}\n\n.stat-label {\n  color: #6b7280;\n  font-size: 0.9em;\n  margin-bottom: 8px;\n}\n\n.stat-value {\n  font-size: 1.5em;\n  font-weight: 600;\n  color: #1f2937;\n}\n</style>"],"names":["useRouter","callApi","useApi","user","ref","transfers","canSendTransfer","computed","_a","p","canReceiveTransfer","canViewTransfersList","statistics","stats","acc","transfer","fetchTransfers","result","onMounted","userStr"],"mappings":"wjBAKeA,EAAS,EACxB,KAAM,CAAE,QAAAC,CAAe,EAAIC,EAAM,EAC3BC,EAAOC,EAAI,IAAI,EACfC,EAAYD,EAAI,CAAE,CAAA,EAElBE,EAAkBC,EAAS,IAAM,OACrC,OAAKJ,EAAK,MACNA,EAAK,MAAM,UAAY,EAAU,IAC9BK,EAAAL,EAAK,MAAM,cAAX,YAAAK,EAAwB,KAAKC,GAAKA,EAAE,kBAAoB,sBAFvC,EAG1B,CAAC,EAEKC,EAAqBH,EAAS,IAAM,OACxC,OAAKJ,EAAK,MACNA,EAAK,MAAM,UAAY,EAAU,IAC9BK,EAAAL,EAAK,MAAM,cAAX,YAAAK,EAAwB,KAAKC,GAAKA,EAAE,kBAAoB,wBAFvC,EAG1B,CAAC,EAEKE,EAAuBJ,EAAS,IAAM,OAC1C,QAAOC,EAAAL,EAAK,QAAL,YAAAK,EAAY,WAAY,CACjC,CAAC,EAGKI,EAAaL,EAAS,IAAM,CAChC,GAAI,CAACF,EAAU,MAAM,OAAQ,MAAO,CAClC,UAAW,EACX,cAAe,EACf,aAAc,EACd,eAAgB,EAChB,gBAAiB,CACrB,EAEE,MAAMQ,EAAQR,EAAU,MAAM,OAAO,CAACS,EAAKC,KAEzCD,EAAI,YAEAC,EAAS,aAEXD,EAAI,iBAGJA,EAAI,eAEJA,EAAI,gBAAkB,WAAWC,EAAS,iBAAiB,EAC3DD,EAAI,iBAAmB,WAAWC,EAAS,iBAAiB,EAAI,WAAWA,EAAS,IAAI,GAGnFD,GACN,CACD,UAAW,EACX,cAAe,EACf,aAAc,EACd,eAAgB,EAChB,gBAAiB,CAClB,CAAA,EAGD,OAAAD,EAAM,gBAAkB,KAAK,MAAMA,EAAM,gBAAkB,GAAG,EAAI,IAE3DA,CACT,CAAC,EAEKG,EAAiB,SAAY,CACjC,MAAMC,EAAS,MAAMhB,EAAQ,CAC3B,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA,MAMP,OAAQ,CAACE,EAAK,MAAM,EAAE,CACvB,CAAA,EACGc,EAAO,UACTZ,EAAU,MAAQY,EAAO,KAE7B,EAEA,OAAAC,EAAU,IAAM,CACd,MAAMC,EAAU,aAAa,QAAQ,MAAM,EACvCA,IACFhB,EAAK,MAAQ,KAAK,MAAMgB,CAAO,EAC/BH,EAAc,EAElB,CAAC"}
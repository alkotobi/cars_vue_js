import{_ as j,r as b,u as z,j as Y,o as X,c as n,g as t,a as e,b as k,F as B,d as O,t as m,f as ne,w as f,v as w,p as L,n as W,e as x,q as fe,s as ye,x as Z,i as ge,h as ke,m as Q,k as Ee}from"./index.CbkLKmc7.js";import $e from"./CarsStock.CVAW-SBr.js";import Ce from"./SellBillsView.B3iBpFxF.js";import we from"./WarehousesView.DJ0CkOs8.js";const he={class:"clients-view"},Se={class:"header"},De={class:"content"},Ae={class:"clients-table"},Ne={class:"id-document-cell"},Te=["onClick"],Ue=["src","alt"],Pe=["href"],Re={key:2},Ve=["onClick"],Be=["onClick"],Oe={key:0,class:"dialog-overlay"},Ie={class:"dialog"},qe={class:"form-group"},Le={class:"file-upload"},Fe={key:0,class:"error-message"},Me={class:"dialog-actions"},xe=["disabled"],We={key:1,class:"dialog-overlay"},He={class:"dialog"},Ye={class:"form-group"},Je=["readonly"],Qe={class:"file-upload"},je={key:0,class:"current-file"},Ge=["href"],ze={key:0,class:"error-message"},Ke={class:"dialog-actions"},Xe=["disabled"],Ze={__name:"ClientsView",setup(q){const D=b([]),{callApi:E,uploadFile:T,getFileUrl:P,error:h}=z(),d=b(!1),A=b(!1),_=b(null),$=b(null),N=b(""),y=b(null),U=b(null),g=Y(()=>{var r;return((r=$.value)==null?void 0:r.role_id)===1}),c=r=>{if(!r)return!1;const s=r.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif","webp"].includes(s)},i=r=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r),p=b({name:"",address:"",email:"",mobiles:"",id_no:""}),S=async()=>{const r=await E({query:`
      SELECT * FROM clients where is_broker = 0
      ORDER BY name ASC
    `,params:[]});r.success&&(D.value=r.data)},R=(r,s=!1)=>{const v=r.target.files[0];s?U.value=v:y.value=v},V=async()=>{if(!i(p.value.email)){N.value="Please enter a valid email address";return}try{const r=await E({query:`
      INSERT INTO clients (name, address, email, mobiles, id_no, is_broker)
      VALUES (?, ?, ?, ?, ?, 0)
    `,params:[p.value.name,p.value.address,p.value.email,p.value.mobiles,p.value.id_no]});if(r.success){const s=r.insertId;if(y.value)try{const v=`${s}.${y.value.name.split(".").pop()}`,J=await T(y.value,"ids",v);J.success&&await E({query:"UPDATE clients SET id_copy_path = ? WHERE id = ?",params:[J.relativePath,s]})}catch(v){console.error("Error uploading file:",v),h.value="Client created but failed to upload ID document"}d.value=!1,N.value="",y.value=null,p.value={name:"",address:"",email:"",mobiles:"",id_no:""},await S()}else h.value=r.error,console.error("Error adding client:",r.error)}catch(r){h.value=r.message,console.error("Error in add client process:",r)}},M=r=>{_.value={...r},U.value=null,A.value=!0},K=async()=>{if(!i(_.value.email)){N.value="Please enter a valid email address";return}try{const r=await E({query:`
      UPDATE clients 
      SET name = ?, address = ?, email = ?, mobiles = ?, id_no = ?, is_broker = 0
      WHERE id = ?
    `,params:[_.value.name,_.value.address,_.value.email,_.value.mobiles,_.value.id_no,_.value.id]});if(r.success){if(U.value)try{const s=`${_.value.id}.${U.value.name.split(".").pop()}`,v=await T(U.value,"ids",s);v.success&&await E({query:"UPDATE clients SET id_copy_path = ? WHERE id = ?",params:[v.relativePath,_.value.id]})}catch(s){console.error("Error uploading file:",s),h.value="Client updated but failed to upload new ID document"}A.value=!1,_.value=null,U.value=null,N.value="",await S()}else h.value=r.error,console.error("Error updating client:",r.error)}catch(r){h.value=r.message,console.error("Error in update client process:",r)}},I=async r=>{confirm("Are you sure you want to delete this client?")&&(await E({query:"DELETE FROM clients WHERE id = ?",params:[r.id]})).success&&await S()},F=r=>{r&&window.open(P(r),"_blank")};return X(()=>{const r=localStorage.getItem("user");r&&($.value=JSON.parse(r),S())}),(r,s)=>(t(),n("div",he,[e("div",Se,[s[15]||(s[15]=e("h2",null,"Clients Management",-1)),e("button",{onClick:s[0]||(s[0]=v=>d.value=!0),class:"add-btn"},"Add Client")]),e("div",De,[e("table",Ae,[s[16]||(s[16]=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Address"),e("th",null,"Email"),e("th",null,"Mobile"),e("th",null,"ID No"),e("th",null,"ID Document"),e("th",null,"Actions")])],-1)),e("tbody",null,[(t(!0),n(B,null,O(D.value,v=>(t(),n("tr",{key:v.id},[e("td",null,m(v.name),1),e("td",null,m(v.address),1),e("td",null,m(v.email),1),e("td",null,m(v.mobiles),1),e("td",null,m(v.id_no),1),e("td",Ne,[v.id_copy_path&&c(v.id_copy_path)?(t(),n("div",{key:0,class:"image-preview",onClick:J=>F(v.id_copy_path)},[e("img",{src:ne(P)(v.id_copy_path),alt:"ID for "+v.name},null,8,Ue)],8,Te)):v.id_copy_path?(t(),n("a",{key:1,href:ne(P)(v.id_copy_path),target:"_blank",class:"document-link"}," View Document ",8,Pe)):(t(),n("span",Re,"No ID"))]),e("td",null,[e("button",{onClick:J=>M(v),class:"btn edit-btn"},"Edit",8,Ve),g.value?(t(),n("button",{key:0,onClick:J=>I(v),class:"btn delete-btn"},"Delete",8,Be)):k("",!0)])]))),128))])])]),d.value?(t(),n("div",Oe,[e("div",Ie,[s[18]||(s[18]=e("h3",null,"Add New Client",-1)),e("div",qe,[f(e("input",{"onUpdate:modelValue":s[1]||(s[1]=v=>p.value.name=v),placeholder:"Name",class:"input-field"},null,512),[[w,p.value.name]]),f(e("input",{"onUpdate:modelValue":s[2]||(s[2]=v=>p.value.address=v),placeholder:"Address",class:"input-field"},null,512),[[w,p.value.address]]),f(e("input",{"onUpdate:modelValue":s[3]||(s[3]=v=>p.value.email=v),placeholder:"Email",class:L(["input-field",{error:N.value&&p.value.email}])},null,2),[[w,p.value.email]]),f(e("input",{"onUpdate:modelValue":s[4]||(s[4]=v=>p.value.mobiles=v),placeholder:"Mobile",class:"input-field"},null,512),[[w,p.value.mobiles]]),f(e("input",{"onUpdate:modelValue":s[5]||(s[5]=v=>p.value.id_no=v),placeholder:"ID No",class:"input-field"},null,512),[[w,p.value.id_no]]),e("div",Le,[s[17]||(s[17]=e("label",{for:"id-document"},"ID Document:",-1)),e("input",{type:"file",id:"id-document",onChange:s[6]||(s[6]=v=>R(v)),accept:"image/*,.pdf",class:"file-input"},null,32)]),N.value?(t(),n("div",Fe,m(N.value),1)):k("",!0)]),e("div",Me,[e("button",{onClick:V,class:"btn save-btn",disabled:!g.value},"Add",8,xe),e("button",{onClick:s[7]||(s[7]=v=>d.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0),A.value?(t(),n("div",We,[e("div",He,[s[21]||(s[21]=e("h3",null,"Edit Client",-1)),e("div",Ye,[f(e("input",{"onUpdate:modelValue":s[8]||(s[8]=v=>_.value.name=v),placeholder:"Name",class:"input-field",readonly:!g.value},null,8,Je),[[w,_.value.name]]),f(e("input",{"onUpdate:modelValue":s[9]||(s[9]=v=>_.value.address=v),placeholder:"Address",class:"input-field"},null,512),[[w,_.value.address]]),f(e("input",{"onUpdate:modelValue":s[10]||(s[10]=v=>_.value.email=v),placeholder:"Email",class:L(["input-field",{error:N.value&&_.value.email}])},null,2),[[w,_.value.email]]),f(e("input",{"onUpdate:modelValue":s[11]||(s[11]=v=>_.value.mobiles=v),placeholder:"Mobile",class:"input-field"},null,512),[[w,_.value.mobiles]]),f(e("input",{"onUpdate:modelValue":s[12]||(s[12]=v=>_.value.id_no=v),placeholder:"ID No",class:"input-field"},null,512),[[w,_.value.id_no]]),e("div",Qe,[s[20]||(s[20]=e("label",{for:"edit-id-document"},"ID Document:",-1)),_.value.id_copy_path?(t(),n("div",je,[s[19]||(s[19]=W(" Current: ")),e("a",{href:_.value.id_copy_path,target:"_blank"},"View ID",8,Ge)])):k("",!0),e("input",{type:"file",id:"edit-id-document",onChange:s[13]||(s[13]=v=>R(v,!0)),accept:"image/*,.pdf",class:"file-input"},null,32)]),N.value?(t(),n("div",ze,m(N.value),1)):k("",!0)]),e("div",Ke,[e("button",{onClick:K,class:"btn save-btn",disabled:!g.value},"Save",8,Xe),e("button",{onClick:s[14]||(s[14]=v=>A.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0)]))}},el=j(Ze,[["__scopeId","data-v-c10137e8"]]),ll={class:"clients-view"},tl={class:"header"},sl={class:"content"},al={class:"clients-table"},ol=["onClick"],nl=["onClick"],il={key:0,class:"dialog-overlay"},ul={class:"dialog"},rl={class:"form-group"},dl={key:0,class:"error-message"},cl={class:"dialog-actions"},vl=["disabled"],pl={key:1,class:"dialog-overlay"},_l={class:"dialog"},bl={class:"form-group"},ml=["readonly"],fl={key:0,class:"error-message"},gl={class:"dialog-actions"},yl=["disabled"],kl={__name:"BrokersView",setup(q){const D=b([]),{callApi:E,error:T}=z(),P=b(!1),h=b(!1),d=b(null),A=b(null),_=b(""),$=Y(()=>{var S;return((S=A.value)==null?void 0:S.role_id)===1}),N=S=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(S),y=b({name:"",address:"",email:"",mobiles:"",id_no:""}),U=async()=>{const S=await E({query:`
      SELECT * FROM clients where is_broker = 1
      ORDER BY name ASC
    `,params:[]});S.success&&(D.value=S.data)},g=async()=>{if(!N(y.value.email)){_.value="Please enter a valid email address";return}const S=await E({query:`
      INSERT INTO clients (name, address, email, mobiles, id_no, is_broker)
      VALUES (?, ?, ?, ?, ?, 1)
    `,params:[y.value.name,y.value.address,y.value.email,y.value.mobiles,y.value.id_no]});S.success?(P.value=!1,_.value="",y.value={name:"",address:"",email:"",mobiles:"",id_no:""},await U()):(T.value=S.error,console.error("Error adding client:",S.error))},c=S=>{d.value={...S},h.value=!0},i=async()=>{if(!N(d.value.email)){_.value="Please enter a valid email address";return}const S=await E({query:`
      UPDATE clients 
      SET name = ?, address = ?, email = ?, mobiles = ?, id_no = ?, is_broker = 1
      WHERE id = ?
    `,params:[d.value.name,d.value.address,d.value.email,d.value.mobiles,d.value.id_no,d.value.id]});S.success?(h.value=!1,d.value=null,_.value="",await U()):(T.value=S.error,console.error("Error updating client:",S.error))},p=async S=>{confirm("Are you sure you want to delete this client?")&&(await E({query:"DELETE FROM clients WHERE id = ?",params:[S.id]})).success&&await U()};return X(()=>{const S=localStorage.getItem("user");S&&(A.value=JSON.parse(S),U())}),(S,R)=>(t(),n("div",ll,[e("div",tl,[R[13]||(R[13]=e("h2",null,"Brokers Management",-1)),e("button",{onClick:R[0]||(R[0]=V=>P.value=!0),class:"add-btn"},"Add Client")]),e("div",sl,[e("table",al,[R[14]||(R[14]=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Address"),e("th",null,"Email"),e("th",null,"Mobile"),e("th",null,"ID No"),e("th",null,"Actions")])],-1)),e("tbody",null,[(t(!0),n(B,null,O(D.value,V=>(t(),n("tr",{key:V.id},[e("td",null,m(V.name),1),e("td",null,m(V.address),1),e("td",null,m(V.email),1),e("td",null,m(V.mobiles),1),e("td",null,m(V.id_no),1),e("td",null,[e("button",{onClick:M=>c(V),class:"btn edit-btn"},"Edit",8,ol),$.value?(t(),n("button",{key:0,onClick:M=>p(V),class:"btn delete-btn"},"Delete",8,nl)):k("",!0)])]))),128))])])]),P.value?(t(),n("div",il,[e("div",ul,[R[15]||(R[15]=e("h3",null,"Add New Client",-1)),e("div",rl,[f(e("input",{"onUpdate:modelValue":R[1]||(R[1]=V=>y.value.name=V),placeholder:"Name",class:"input-field"},null,512),[[w,y.value.name]]),f(e("input",{"onUpdate:modelValue":R[2]||(R[2]=V=>y.value.address=V),placeholder:"Address",class:"input-field"},null,512),[[w,y.value.address]]),f(e("input",{"onUpdate:modelValue":R[3]||(R[3]=V=>y.value.email=V),placeholder:"Email",class:L(["input-field",{error:_.value&&y.value.email}])},null,2),[[w,y.value.email]]),f(e("input",{"onUpdate:modelValue":R[4]||(R[4]=V=>y.value.mobiles=V),placeholder:"Mobile",class:"input-field"},null,512),[[w,y.value.mobiles]]),f(e("input",{"onUpdate:modelValue":R[5]||(R[5]=V=>y.value.id_no=V),placeholder:"ID No",class:"input-field"},null,512),[[w,y.value.id_no]]),_.value?(t(),n("div",dl,m(_.value),1)):k("",!0)]),e("div",cl,[e("button",{onClick:g,class:"btn save-btn",disabled:!$.value},"Add",8,vl),e("button",{onClick:R[6]||(R[6]=V=>P.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0),h.value?(t(),n("div",pl,[e("div",_l,[R[16]||(R[16]=e("h3",null,"Edit Client",-1)),e("div",bl,[f(e("input",{"onUpdate:modelValue":R[7]||(R[7]=V=>d.value.name=V),placeholder:"Name",class:"input-field",readonly:!$.value},null,8,ml),[[w,d.value.name]]),f(e("input",{"onUpdate:modelValue":R[8]||(R[8]=V=>d.value.address=V),placeholder:"Address",class:"input-field"},null,512),[[w,d.value.address]]),f(e("input",{"onUpdate:modelValue":R[9]||(R[9]=V=>d.value.email=V),placeholder:"Email",class:L(["input-field",{error:_.value&&d.value.email}])},null,2),[[w,d.value.email]]),f(e("input",{"onUpdate:modelValue":R[10]||(R[10]=V=>d.value.mobiles=V),placeholder:"Mobile",class:"input-field"},null,512),[[w,d.value.mobiles]]),f(e("input",{"onUpdate:modelValue":R[11]||(R[11]=V=>d.value.id_no=V),placeholder:"ID No",class:"input-field"},null,512),[[w,d.value.id_no]]),_.value?(t(),n("div",fl,m(_.value),1)):k("",!0)]),e("div",gl,[e("button",{onClick:i,class:"btn save-btn",disabled:!$.value},"Save",8,yl),e("button",{onClick:R[12]||(R[12]=V=>h.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0)]))}},El=j(kl,[["__scopeId","data-v-8051a3ee"]]),$l={class:"suppliers-view"},Cl={class:"header"},wl={class:"content"},hl={class:"suppliers-table"},Sl=["onClick"],Dl=["onClick"],Al={key:0,class:"dialog-overlay"},Nl={class:"dialog"},Tl={class:"form-group"},Ul={class:"dialog-actions"},Pl={key:1,class:"dialog-overlay"},Rl={class:"dialog"},Vl={class:"form-group"},Bl={class:"dialog-actions"},Ol={__name:"SuppliersView",setup(q){const D=b([]),{callApi:E,error:T}=z(),P=b(!1),h=b(!1),d=b(null),A=b(null),_=Y(()=>{var i;return((i=A.value)==null?void 0:i.role_id)===1}),$=b({name:"",contact_info:"",notes:""}),N=async()=>{const i=await E({query:`
      SELECT * FROM suppliers
      ORDER BY name ASC
    `,params:[]});i.success&&(D.value=i.data)},y=async()=>{const i=await E({query:`
      INSERT INTO suppliers (name, contact_info, notes)
      VALUES (?, ?, ?)
    `,params:[$.value.name,$.value.contact_info,$.value.notes]});i.success?(P.value=!1,$.value={name:"",contact_info:"",notes:""},await N()):(T.value=i.error,console.error("Error adding supplier:",i.error))},U=i=>{d.value={...i},h.value=!0},g=async()=>{const i=await E({query:`
      UPDATE suppliers 
      SET name = ?, contact_info = ?, notes = ?
      WHERE id = ?
    `,params:[d.value.name,d.value.contact_info,d.value.notes,d.value.id]});i.success?(h.value=!1,d.value=null,await N()):(T.value=i.error,console.error("Error updating supplier:",i.error))},c=async i=>{confirm("Are you sure you want to delete this supplier?")&&(await E({query:"DELETE FROM suppliers WHERE id = ?",params:[i.id]})).success&&await N()};return X(()=>{const i=localStorage.getItem("user");i&&(A.value=JSON.parse(i),N())}),(i,p)=>(t(),n("div",$l,[e("div",Cl,[p[9]||(p[9]=e("h2",null,"Suppliers Management",-1)),e("button",{onClick:p[0]||(p[0]=S=>P.value=!0),class:"add-btn"},"Add Supplier")]),e("div",wl,[e("table",hl,[p[10]||(p[10]=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Contact Info"),e("th",null,"Notes"),e("th",null,"Actions")])],-1)),e("tbody",null,[(t(!0),n(B,null,O(D.value,S=>(t(),n("tr",{key:S.id},[e("td",null,m(S.name),1),e("td",null,m(S.contact_info),1),e("td",null,m(S.notes),1),e("td",null,[e("button",{onClick:R=>U(S),class:"btn edit-btn"},"Edit",8,Sl),_.value?(t(),n("button",{key:0,onClick:R=>c(S),class:"btn delete-btn"},"Delete",8,Dl)):k("",!0)])]))),128))])])]),P.value?(t(),n("div",Al,[e("div",Nl,[p[11]||(p[11]=e("h3",null,"Add New Supplier",-1)),e("div",Tl,[f(e("input",{"onUpdate:modelValue":p[1]||(p[1]=S=>$.value.name=S),placeholder:"Name",class:"input-field"},null,512),[[w,$.value.name]]),f(e("textarea",{"onUpdate:modelValue":p[2]||(p[2]=S=>$.value.contact_info=S),placeholder:"Contact Information",class:"input-field textarea"},null,512),[[w,$.value.contact_info]]),f(e("textarea",{"onUpdate:modelValue":p[3]||(p[3]=S=>$.value.notes=S),placeholder:"Notes",class:"input-field textarea"},null,512),[[w,$.value.notes]])]),e("div",Ul,[e("button",{onClick:y,class:"btn save-btn"},"Save"),e("button",{onClick:p[4]||(p[4]=S=>P.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0),h.value?(t(),n("div",Pl,[e("div",Rl,[p[12]||(p[12]=e("h3",null,"Edit Supplier",-1)),e("div",Vl,[f(e("input",{"onUpdate:modelValue":p[5]||(p[5]=S=>d.value.name=S),placeholder:"Name",class:"input-field"},null,512),[[w,d.value.name]]),f(e("textarea",{"onUpdate:modelValue":p[6]||(p[6]=S=>d.value.contact_info=S),placeholder:"Contact Information",class:"input-field textarea"},null,512),[[w,d.value.contact_info]]),f(e("textarea",{"onUpdate:modelValue":p[7]||(p[7]=S=>d.value.notes=S),placeholder:"Notes",class:"input-field textarea"},null,512),[[w,d.value.notes]])]),e("div",Bl,[e("button",{onClick:g,class:"btn save-btn"},"Save"),e("button",{onClick:p[8]||(p[8]=S=>h.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0)]))}},Il=j(Ol,[["__scopeId","data-v-c8ee631a"]]),ql={class:"models-view"},Ll={class:"section"},Fl={class:"header"},Ml={class:"data-table"},xl=["onClick"],Wl=["onClick"],Hl={class:"section"},Yl={class:"header"},Jl={class:"data-table"},Ql=["onClick"],jl=["onClick"],Gl={key:0,class:"dialog-overlay"},zl={class:"dialog"},Kl={class:"form-group"},Xl={class:"dialog-actions"},Zl={key:1,class:"dialog-overlay"},et={class:"dialog"},lt={class:"form-group"},tt={class:"dialog-actions"},st={key:2,class:"dialog-overlay"},at={class:"dialog"},ot={class:"form-group"},nt={class:"form-group"},it=["value"],ut={class:"form-group"},rt={class:"form-group"},dt={class:"dialog-buttons"},ct={key:3,class:"dialog-overlay"},vt={class:"dialog"},pt={class:"form-group"},_t={class:"form-group"},bt=["value"],mt={class:"form-group"},ft={class:"form-group"},gt={class:"dialog-buttons"},yt={__name:"CarModelsView",setup(q){const{callApi:D}=z(),E=b(!1),T=b(!1),P=b(!1),h=b(!1),d=b([]),A=b([]),_=b(null),$=b(null),N=b(null),y=Y(()=>{var r;return((r=N.value)==null?void 0:r.role_id)===1}),U=b({brand:""}),g=b({car_name:"",notes:"",is_big_car:!1,id_brand:null}),c=async()=>{const r=await D({query:"SELECT * FROM brands ORDER BY brand ASC",params:[]});r.success&&(d.value=r.data)},i=async()=>{const r=await D({query:`
      SELECT cn.*, b.brand 
      FROM cars_names cn
      LEFT JOIN brands b ON cn.id_brand = b.id 
      ORDER BY cn.car_name ASC
    `,params:[]});r.success&&(A.value=r.data)},p=async()=>{const r=await D({query:"INSERT INTO brands (brand) VALUES (?)",params:[U.value.brand]});r.success?(E.value=!1,U.value={brand:""},await c()):console.log(r.error)},S=async()=>{const r=await D({query:"INSERT INTO cars_names (car_name, notes, is_big_car, id_brand) VALUES (?, ?, ?, ?)",params:[g.value.car_name,g.value.notes,g.value.is_big_car?1:0,g.value.id_brand]});r.success?(P.value=!1,g.value={car_name:"",notes:"",is_big_car:!1,id_brand:null},await i()):console.log(r.error)},R=r=>{_.value={...r},T.value=!0},V=r=>{$.value={...r},h.value=!0},M=async()=>{const r=await D({query:"UPDATE brands SET brand = ? WHERE id = ?",params:[_.value.brand,_.value.id]});r.success?(T.value=!1,_.value=null,await c()):console.log(r.error)},K=async()=>{const r=await D({query:"UPDATE cars_names SET car_name = ?, notes = ?, is_big_car = ?, id_brand = ? WHERE id = ?",params:[$.value.car_name,$.value.notes,$.value.is_big_car?1:0,$.value.id_brand,$.value.id]});r.success?(h.value=!1,$.value=null,await i()):console.log(r.error)},I=async r=>{confirm("Are you sure you want to delete this brand?")&&(await D({query:"DELETE FROM brands WHERE id = ?",params:[r.id]})).success&&await c()},F=async r=>{confirm("Are you sure you want to delete this car name?")&&(await D({query:"DELETE FROM cars_names WHERE id = ?",params:[r.id]})).success&&await i()};return X(()=>{const r=localStorage.getItem("user");r&&(N.value=JSON.parse(r),c(),i())}),(r,s)=>(t(),n("div",ql,[e("div",Ll,[e("div",Fl,[s[16]||(s[16]=e("h2",null,"Brands Management",-1)),e("button",{onClick:s[0]||(s[0]=v=>E.value=!0),class:"add-btn"},"Add Brand")]),e("table",Ml,[s[17]||(s[17]=e("thead",null,[e("tr",null,[e("th",null,"Brand"),e("th",null,"Actions")])],-1)),e("tbody",null,[(t(!0),n(B,null,O(d.value,v=>(t(),n("tr",{key:v.id},[e("td",null,m(v.brand),1),e("td",null,[e("button",{onClick:J=>R(v),class:"btn edit-btn"},"Edit",8,xl),y.value?(t(),n("button",{key:0,onClick:J=>I(v),class:"btn delete-btn"},"Delete",8,Wl)):k("",!0)])]))),128))])])]),e("div",Hl,[e("div",Yl,[s[18]||(s[18]=e("h2",null,"Car Names Management",-1)),e("button",{onClick:s[1]||(s[1]=v=>P.value=!0),class:"add-btn"},"Add Car Name")]),e("table",Jl,[s[19]||(s[19]=e("thead",null,[e("tr",null,[e("th",null,"Car Name"),e("th",null,"Brand"),e("th",null,"Notes"),e("th",null,"Big Car"),e("th",null,"Actions")])],-1)),e("tbody",null,[(t(!0),n(B,null,O(A.value,v=>(t(),n("tr",{key:v.id},[e("td",null,m(v.car_name),1),e("td",null,m(v.brand),1),e("td",null,m(v.notes),1),e("td",null,m(v.is_big_car?"Yes":"No"),1),e("td",null,[e("button",{onClick:J=>V(v),class:"btn edit-btn"},"Edit",8,Ql),y.value?(t(),n("button",{key:0,onClick:J=>F(v),class:"btn delete-btn"},"Delete",8,jl)):k("",!0)])]))),128))])])]),E.value?(t(),n("div",Gl,[e("div",zl,[s[20]||(s[20]=e("h3",null,"Add New Brand",-1)),e("div",Kl,[f(e("input",{"onUpdate:modelValue":s[2]||(s[2]=v=>U.value.brand=v),placeholder:"Brand Name",class:"input-field"},null,512),[[w,U.value.brand]])]),e("div",Xl,[e("button",{onClick:p,class:"btn save-btn"},"Save"),e("button",{onClick:s[3]||(s[3]=v=>E.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0),T.value?(t(),n("div",Zl,[e("div",et,[s[21]||(s[21]=e("h3",null,"Edit Brand",-1)),e("div",lt,[f(e("input",{"onUpdate:modelValue":s[4]||(s[4]=v=>_.value.brand=v),placeholder:"Brand Name",class:"input-field"},null,512),[[w,_.value.brand]])]),e("div",tt,[e("button",{onClick:M,class:"btn save-btn"},"Save"),e("button",{onClick:s[5]||(s[5]=v=>T.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0),P.value?(t(),n("div",st,[e("div",at,[s[24]||(s[24]=e("h3",null,"Add New Car Name",-1)),e("div",ot,[f(e("input",{"onUpdate:modelValue":s[6]||(s[6]=v=>g.value.car_name=v),placeholder:"Car Name"},null,512),[[w,g.value.car_name]])]),e("div",nt,[f(e("select",{"onUpdate:modelValue":s[7]||(s[7]=v=>g.value.id_brand=v)},[s[22]||(s[22]=e("option",{value:""},"Select Brand",-1)),(t(!0),n(B,null,O(d.value,v=>(t(),n("option",{key:v.id,value:v.id},m(v.brand),9,it))),128))],512),[[x,g.value.id_brand]])]),e("div",ut,[f(e("input",{"onUpdate:modelValue":s[8]||(s[8]=v=>g.value.notes=v),placeholder:"Notes"},null,512),[[w,g.value.notes]])]),e("div",rt,[e("label",null,[f(e("input",{type:"checkbox","onUpdate:modelValue":s[9]||(s[9]=v=>g.value.is_big_car=v)},null,512),[[fe,g.value.is_big_car]]),s[23]||(s[23]=W(" Big Car "))])]),e("div",dt,[e("button",{onClick:S,class:"btn save-btn"},"Save"),e("button",{onClick:s[10]||(s[10]=v=>P.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0),h.value?(t(),n("div",ct,[e("div",vt,[s[27]||(s[27]=e("h3",null,"Edit Car Name",-1)),e("div",pt,[f(e("input",{"onUpdate:modelValue":s[11]||(s[11]=v=>$.value.car_name=v),placeholder:"Car Name"},null,512),[[w,$.value.car_name]])]),e("div",_t,[f(e("select",{"onUpdate:modelValue":s[12]||(s[12]=v=>$.value.id_brand=v)},[s[25]||(s[25]=e("option",{value:""},"Select Brand",-1)),(t(!0),n(B,null,O(d.value,v=>(t(),n("option",{key:v.id,value:v.id},m(v.brand),9,bt))),128))],512),[[x,$.value.id_brand]])]),e("div",mt,[f(e("input",{"onUpdate:modelValue":s[13]||(s[13]=v=>$.value.notes=v),placeholder:"Notes"},null,512),[[w,$.value.notes]])]),e("div",ft,[e("label",null,[f(e("input",{type:"checkbox","onUpdate:modelValue":s[14]||(s[14]=v=>$.value.is_big_car=v)},null,512),[[fe,$.value.is_big_car]]),s[26]||(s[26]=W(" Big Car "))])]),e("div",gt,[e("button",{onClick:K,class:"btn save-btn"},"Save"),e("button",{onClick:s[15]||(s[15]=v=>h.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0)]))}},kt=j(yt,[["__scopeId","data-v-1ce5e605"]]),Et={class:"colors-view"},$t={class:"header"},Ct={class:"content"},wt={class:"colors-table"},ht=["onClick"],St=["onClick"],Dt={key:0,class:"dialog-overlay"},At={class:"dialog"},Nt={class:"form-group"},Tt={class:"dialog-actions"},Ut={key:1,class:"dialog-overlay"},Pt={class:"dialog"},Rt={class:"form-group"},Vt={class:"dialog-actions"},Bt={__name:"ColorsView",setup(q){const D=b([]),{callApi:E}=z(),T=b(!1),P=b(!1),h=b(null),d=b(null),A=Y(()=>{var c;return((c=d.value)==null?void 0:c.role_id)===1}),_=b({color:""}),$=async()=>{const c=await E({query:"SELECT * FROM colors ORDER BY color ASC",params:[]});c.success&&(D.value=c.data)},N=async()=>{(await E({query:"INSERT INTO colors (color) VALUES (?)",params:[_.value.color]})).success&&(T.value=!1,_.value={color:""},await $())},y=c=>{h.value={...c},P.value=!0},U=async()=>{(await E({query:"UPDATE colors SET color = ? WHERE id = ?",params:[h.value.color,h.value.id]})).success&&(P.value=!1,h.value=null,await $())},g=async c=>{confirm("Are you sure you want to delete this color?")&&(await E({query:"DELETE FROM colors WHERE id = ?",params:[c.id]})).success&&await $()};return X(()=>{const c=localStorage.getItem("user");c&&(d.value=JSON.parse(c),$())}),(c,i)=>(t(),n("div",Et,[e("div",$t,[i[5]||(i[5]=e("h2",null,"Colors Management",-1)),e("button",{onClick:i[0]||(i[0]=p=>T.value=!0),class:"add-btn"},"Add Color")]),e("div",Ct,[e("table",wt,[i[6]||(i[6]=e("thead",null,[e("tr",null,[e("th",null,"Color"),e("th",null,"Actions")])],-1)),e("tbody",null,[(t(!0),n(B,null,O(D.value,p=>(t(),n("tr",{key:p.id},[e("td",null,m(p.color),1),e("td",null,[e("button",{onClick:S=>y(p),class:"btn edit-btn"},"Edit",8,ht),A.value?(t(),n("button",{key:0,onClick:S=>g(p),class:"btn delete-btn"},"Delete",8,St)):k("",!0)])]))),128))])])]),T.value?(t(),n("div",Dt,[e("div",At,[i[7]||(i[7]=e("h3",null,"Add New Color",-1)),e("div",Nt,[f(e("input",{"onUpdate:modelValue":i[1]||(i[1]=p=>_.value.color=p),placeholder:"Color Name",class:"input-field"},null,512),[[w,_.value.color]])]),e("div",Tt,[e("button",{onClick:N,class:"btn save-btn"},"Save"),e("button",{onClick:i[2]||(i[2]=p=>T.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0),P.value?(t(),n("div",Ut,[e("div",Pt,[i[8]||(i[8]=e("h3",null,"Edit Color",-1)),e("div",Rt,[f(e("input",{"onUpdate:modelValue":i[3]||(i[3]=p=>h.value.color=p),placeholder:"Color Name",class:"input-field"},null,512),[[w,h.value.color]])]),e("div",Vt,[e("button",{onClick:U,class:"btn save-btn"},"Save"),e("button",{onClick:i[4]||(i[4]=p=>P.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0)]))}},Ot=j(Bt,[["__scopeId","data-v-4eb1323d"]]),It={class:"ports-view"},qt={class:"header"},Lt={class:"content"},Ft={class:"ports-table"},Mt=["onClick"],xt=["onClick"],Wt={key:0,class:"dialog-overlay"},Ht={class:"dialog"},Yt={class:"form-group"},Jt={class:"dialog-actions"},Qt={key:1,class:"dialog-overlay"},jt={class:"dialog"},Gt={class:"form-group"},zt={class:"dialog-actions"},Kt={__name:"DischargePortsView",setup(q){const D=b([]),{callApi:E}=z(),T=b(!1),P=b(!1),h=b(null),d=b(null),A=Y(()=>{var c;return((c=d.value)==null?void 0:c.role_id)===1}),_=b({discharge_port:""}),$=async()=>{const c=await E({query:"SELECT * FROM discharge_ports ORDER BY discharge_port ASC",params:[]});c.success&&(D.value=c.data)},N=async()=>{(await E({query:"INSERT INTO discharge_ports (discharge_port) VALUES (?)",params:[_.value.discharge_port]})).success&&(T.value=!1,_.value={discharge_port:""},await $())},y=c=>{h.value={...c},P.value=!0},U=async()=>{(await E({query:"UPDATE discharge_ports SET discharge_port = ? WHERE id = ?",params:[h.value.discharge_port,h.value.id]})).success&&(P.value=!1,h.value=null,await $())},g=async c=>{confirm("Are you sure you want to delete this discharge port?")&&(await E({query:"DELETE FROM discharge_ports WHERE id = ?",params:[c.id]})).success&&await $()};return X(()=>{const c=localStorage.getItem("user");c&&(d.value=JSON.parse(c),$())}),(c,i)=>(t(),n("div",It,[e("div",qt,[i[5]||(i[5]=e("h2",null,"Discharge Ports Management",-1)),e("button",{onClick:i[0]||(i[0]=p=>T.value=!0),class:"add-btn"},"Add Discharge Port")]),e("div",Lt,[e("table",Ft,[i[6]||(i[6]=e("thead",null,[e("tr",null,[e("th",null,"Discharge Port"),e("th",null,"Actions")])],-1)),e("tbody",null,[(t(!0),n(B,null,O(D.value,p=>(t(),n("tr",{key:p.id},[e("td",null,m(p.discharge_port),1),e("td",null,[e("button",{onClick:S=>y(p),class:"btn edit-btn"},"Edit",8,Mt),A.value?(t(),n("button",{key:0,onClick:S=>g(p),class:"btn delete-btn"},"Delete",8,xt)):k("",!0)])]))),128))])])]),T.value?(t(),n("div",Wt,[e("div",Ht,[i[7]||(i[7]=e("h3",null,"Add New Discharge Port",-1)),e("div",Yt,[f(e("input",{"onUpdate:modelValue":i[1]||(i[1]=p=>_.value.discharge_port=p),placeholder:"Discharge Port Name",class:"input-field"},null,512),[[w,_.value.discharge_port]])]),e("div",Jt,[e("button",{onClick:N,class:"btn save-btn"},"Save"),e("button",{onClick:i[2]||(i[2]=p=>T.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0),P.value?(t(),n("div",Qt,[e("div",jt,[i[8]||(i[8]=e("h3",null,"Edit Discharge Port",-1)),e("div",Gt,[f(e("input",{"onUpdate:modelValue":i[3]||(i[3]=p=>h.value.discharge_port=p),placeholder:"Discharge Port Name",class:"input-field"},null,512),[[w,h.value.discharge_port]])]),e("div",zt,[e("button",{onClick:U,class:"btn save-btn"},"Save"),e("button",{onClick:i[4]||(i[4]=p=>P.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0)]))}},Xt=j(Kt,[["__scopeId","data-v-d7d6cc70"]]),Zt={class:"ports-view"},es={class:"header"},ls={class:"content"},ts={class:"ports-table"},ss=["onClick"],as=["onClick"],os={key:0,class:"dialog-overlay"},ns={class:"dialog"},is={class:"form-group"},us={class:"dialog-actions"},rs={key:1,class:"dialog-overlay"},ds={class:"dialog"},cs={class:"form-group"},vs={class:"dialog-actions"},ps={__name:"LoadingPortsView",setup(q){const D=b([]),{callApi:E}=z(),T=b(!1),P=b(!1),h=b(null),d=b(null),A=Y(()=>{var c;return((c=d.value)==null?void 0:c.role_id)===1}),_=b({loading_port:""}),$=async()=>{const c=await E({query:"SELECT * FROM loading_ports ORDER BY loading_port ASC",params:[]});c.success&&(D.value=c.data)},N=async()=>{(await E({query:"INSERT INTO loading_ports (loading_port) VALUES (?)",params:[_.value.loading_port]})).success&&(T.value=!1,_.value={loading_port:""},await $())},y=c=>{h.value={...c},P.value=!0},U=async()=>{(await E({query:"UPDATE loading_ports SET loading_port = ? WHERE id = ?",params:[h.value.loading_port,h.value.id]})).success&&(P.value=!1,h.value=null,await $())},g=async c=>{confirm("Are you sure you want to delete this loading port?")&&(await E({query:"DELETE FROM loading_ports WHERE id = ?",params:[c.id]})).success&&await $()};return X(()=>{const c=localStorage.getItem("user");c&&(d.value=JSON.parse(c),$())}),(c,i)=>(t(),n("div",Zt,[e("div",es,[i[5]||(i[5]=e("h2",null,"Loading Ports Management",-1)),e("button",{onClick:i[0]||(i[0]=p=>T.value=!0),class:"add-btn"},"Add Loading Port")]),e("div",ls,[e("table",ts,[i[6]||(i[6]=e("thead",null,[e("tr",null,[e("th",null,"Loading Port"),e("th",null,"Actions")])],-1)),e("tbody",null,[(t(!0),n(B,null,O(D.value,p=>(t(),n("tr",{key:p.id},[e("td",null,m(p.loading_port),1),e("td",null,[e("button",{onClick:S=>y(p),class:"btn edit-btn"},"Edit",8,ss),A.value?(t(),n("button",{key:0,onClick:S=>g(p),class:"btn delete-btn"},"Delete",8,as)):k("",!0)])]))),128))])])]),T.value?(t(),n("div",os,[e("div",ns,[i[7]||(i[7]=e("h3",null,"Add New Loading Port",-1)),e("div",is,[f(e("input",{"onUpdate:modelValue":i[1]||(i[1]=p=>_.value.loading_port=p),placeholder:"Loading Port Name",class:"input-field"},null,512),[[w,_.value.loading_port]])]),e("div",us,[e("button",{onClick:N,class:"btn save-btn"},"Save"),e("button",{onClick:i[2]||(i[2]=p=>T.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0),P.value?(t(),n("div",rs,[e("div",ds,[i[8]||(i[8]=e("h3",null,"Edit Loading Port",-1)),e("div",cs,[f(e("input",{"onUpdate:modelValue":i[3]||(i[3]=p=>h.value.loading_port=p),placeholder:"Loading Port Name",class:"input-field"},null,512),[[w,h.value.loading_port]])]),e("div",vs,[e("button",{onClick:U,class:"btn save-btn"},"Save"),e("button",{onClick:i[4]||(i[4]=p=>P.value=!1),class:"btn cancel-btn"},"Cancel")])])])):k("",!0)]))}},_s=j(ps,[["__scopeId","data-v-b6aa02ef"]]),bs={class:"master-section"},ms={key:0,class:"toolbar"},fs={class:"bill-info"},gs={class:"bill-id"},ys={class:"bill-details"},ks={class:"detail-item"},Es={class:"value"},$s={class:"detail-item"},Cs={class:"value"},ws={class:"detail-item"},hs={class:"value"},Ss={class:"detail-item"},Ds={class:"value"},As={class:"detail-item"},Ns={class:"toolbar-actions"},Ts={class:"data-table"},Us=["onClick"],Ps=["href"],Rs={key:1,class:"no-document"},Vs={__name:"BuyBillsTable",props:{buyBills:{type:Array,required:!0},selectedBill:{type:Object,default:null}},emits:["select-bill"],setup(q,{emit:D}){const{getFileUrl:E}=z(),T=h=>h?new Date(h).toLocaleDateString():"N/A",P=h=>{const d=Number(h);return isNaN(d)?"N/A":d.toFixed(2)};return(h,d)=>(t(),n("div",bs,[q.selectedBill?(t(),n("div",ms,[e("div",fs,[e("div",gs," Purchase #"+m(q.selectedBill.id),1),e("div",ys,[e("div",ks,[d[1]||(d[1]=e("span",{class:"label"},"Supplier:",-1)),e("span",Es,m(q.selectedBill.supplier_name),1)]),e("div",$s,[d[2]||(d[2]=e("span",{class:"label"},"Amount:",-1)),e("span",Cs,m(P(q.selectedBill.amount)),1)]),e("div",ws,[d[3]||(d[3]=e("span",{class:"label"},"Paid:",-1)),e("span",hs,m(P(q.selectedBill.payed)),1)]),e("div",Ss,[d[4]||(d[4]=e("span",{class:"label"},"Balance:",-1)),e("span",Ds,m(P(q.selectedBill.amount-q.selectedBill.payed)),1)]),e("div",As,[d[5]||(d[5]=e("span",{class:"label"},"Status:",-1)),e("span",{class:L(["value",q.selectedBill.is_stock_updated?"status-updated":"status-pending"])},m(q.selectedBill.is_stock_updated?"Updated":"Pending"),3)])])]),e("div",Ns,[ye(h.$slots,"actions",{bill:q.selectedBill},void 0,!0)])])):k("",!0),e("table",Ts,[d[6]||(d[6]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Date"),e("th",null,"Supplier"),e("th",null,"Bill Ref"),e("th",null,"Amount"),e("th",null,"Paid"),e("th",null,"Balance"),e("th",null,"Status"),e("th",null,"PI Document")])],-1)),e("tbody",null,[(t(!0),n(B,null,O(q.buyBills,A=>{var _;return t(),n("tr",{key:A.id,class:L({selected:((_=q.selectedBill)==null?void 0:_.id)===A.id}),onClick:$=>h.$emit("select-bill",A)},[e("td",null,m(A.id),1),e("td",null,m(T(A.date_buy)),1),e("td",null,m(A.supplier_name),1),e("td",null,m(A.bill_ref||"N/A"),1),e("td",null,m(P(A.amount)),1),e("td",null,m(P(A.payed)),1),e("td",null,m(P(A.amount-A.payed)),1),e("td",null,[e("span",{class:L(A.is_stock_updated?"status-updated":"status-pending")},m(A.is_stock_updated?"Updated":"Pending"),3)]),e("td",null,[A.pi_path?(t(),n("a",{key:0,href:ne(E)(A.pi_path),target:"_blank",class:"pi-document-link",onClick:d[0]||(d[0]=Z(()=>{},["stop"]))}," View PI ",8,Ps)):(t(),n("span",Rs,"No document"))])],10,Us)}),128))])])]))}},Bs=j(Vs,[["__scopeId","data-v-1d466006"]]),Os={class:"detail-section"},Is={class:"detail-header"},qs={class:"button-group"},Ls=["disabled","title"],Fs=["disabled","title"],Ms={class:"data-table"},xs={class:"actions"},Ws=["onClick","disabled","title"],Hs=["onClick","disabled","title"],Ys={key:0,class:"dialog-overlay"},Js={class:"dialog"},Qs={class:"form-group"},js={class:"form-group"},Gs={class:"form-row"},zs={class:"form-group half"},Ks={class:"form-group half"},Xs={class:"form-group"},Zs={class:"form-group"},ea={class:"dialog-buttons"},la={__name:"BuyDetailsTable",props:{buyDetails:{type:Array,required:!0},isAdmin:{type:Boolean,default:!1}},emits:["add-detail","delete-detail","update-detail"],setup(q,{emit:D}){const{callApi:E}=z(),T=q,P=D,h=b(!1),d=b(null),A=Y(()=>{var U;return((U=T.buyDetails[0])==null?void 0:U.is_stock_updated)===1}),_=(U,g)=>{if(g){alert("Cannot delete details - Stock has already been updated");return}confirm("Are you sure you want to delete this detail?")&&P("delete-detail",U)},$=U=>{d.value={...U},h.value=!0},N=()=>{P("update-detail",d.value),h.value=!1,d.value=null},y=async()=>{if(!T.buyDetails.length){alert("No details to process");return}if(confirm("Are you sure you want to update the stock? This action cannot be undone.")){for(const g of T.buyDetails)for(let c=0;c<g.QTY;c++){const i=await E({query:`
            INSERT INTO cars_stock 
            (id_buy_details,price_cell)
            VALUES (?,?)
          `,params:[g.id,g.price_sell]});if(!i.success){alert("Error creating stock entry"),console.error("Error creating stock entry:",i.error);return}}const U=await E({query:"UPDATE buy_bill SET is_stock_updated = 1 WHERE id = ?",params:[T.buyDetails[0].id_buy_bill]});U.success?(alert("Stock has been successfully updated"),P("update-detail",T.buyDetails[0])):(console.error("Error updating is_stock_updated flag:",U.error),alert("Error updating stock"))}};return(U,g)=>(t(),n(B,null,[e("div",Os,[e("div",Is,[g[8]||(g[8]=e("h3",null,"Purchase Details",-1)),e("div",qs,[e("button",{onClick:y,class:L(["stock-btn",{disabled:A.value}]),disabled:A.value,title:A.value?"Stock has already been updated":"Update stock"}," Update Stock ",10,Ls),e("button",{onClick:g[0]||(g[0]=c=>U.$emit("add-detail")),class:L(["add-btn",{disabled:A.value}]),disabled:A.value,title:A.value?"Cannot add details - Stock has been updated":"Add new detail"}," Add Detail ",10,Fs)])]),e("table",Ms,[g[9]||(g[9]=e("thead",null,[e("tr",null,[e("th",null,"Car"),e("th",null,"Color"),e("th",null,"Quantity"),e("th",null,"Amount"),e("th",null,"Year"),e("th",null,"Month"),e("th",null,"Price Sell"),e("th",null,"Actions")])],-1)),e("tbody",null,[(t(!0),n(B,null,O(q.buyDetails,c=>(t(),n("tr",{key:c.id},[e("td",null,m(c.car_name),1),e("td",null,m(c.color),1),e("td",null,m(c.QTY),1),e("td",null,m(c.amount),1),e("td",null,m(c.year),1),e("td",null,m(c.month),1),e("td",null,m(c.price_sell),1),e("td",xs,[e("button",{onClick:i=>$(c),class:L(["edit-btn",{disabled:c.is_stock_updated}]),disabled:c.is_stock_updated,title:c.is_stock_updated?"Cannot edit - Stock has been updated":"Edit this detail"}," Edit ",10,Ws),e("button",{onClick:i=>_(c.id,c.is_stock_updated),class:L(["delete-btn",{disabled:c.is_stock_updated}]),disabled:c.is_stock_updated,title:c.is_stock_updated?"Cannot delete - Stock has been updated":"Delete this detail"}," Delete ",10,Hs)])]))),128))])])]),h.value&&d.value?(t(),n("div",Ys,[e("div",Js,[g[17]||(g[17]=e("h3",null,"Edit Purchase Detail",-1)),e("form",{onSubmit:Z(N,["prevent"])},[e("div",Qs,[g[10]||(g[10]=e("label",{for:"edit-qty"},"Quantity",-1)),f(e("input",{type:"number",id:"edit-qty","onUpdate:modelValue":g[1]||(g[1]=c=>d.value.QTY=c),min:"1",required:""},null,512),[[w,d.value.QTY]])]),e("div",js,[g[11]||(g[11]=e("label",{for:"edit-amount"},"Amount",-1)),f(e("input",{type:"number",id:"edit-amount","onUpdate:modelValue":g[2]||(g[2]=c=>d.value.amount=c),step:"0.01",required:""},null,512),[[w,d.value.amount]])]),e("div",Gs,[e("div",zs,[g[12]||(g[12]=e("label",{for:"edit-year"},"Year",-1)),f(e("input",{type:"number",id:"edit-year","onUpdate:modelValue":g[3]||(g[3]=c=>d.value.year=c),required:""},null,512),[[w,d.value.year]])]),e("div",Ks,[g[13]||(g[13]=e("label",{for:"edit-month"},"Month",-1)),f(e("input",{type:"number",id:"edit-month","onUpdate:modelValue":g[4]||(g[4]=c=>d.value.month=c),min:"1",max:"12",required:""},null,512),[[w,d.value.month]])])]),e("div",Xs,[g[14]||(g[14]=e("label",{for:"edit-price-sell"},"Price Sell",-1)),f(e("input",{type:"number",id:"edit-price-sell","onUpdate:modelValue":g[5]||(g[5]=c=>d.value.price_sell=c),step:"0.01",required:""},null,512),[[w,d.value.price_sell]])]),e("div",Zs,[g[15]||(g[15]=e("label",{for:"edit-notes"},"Notes",-1)),f(e("textarea",{id:"edit-notes","onUpdate:modelValue":g[6]||(g[6]=c=>d.value.notes=c),rows:"3"},null,512),[[w,d.value.notes]])]),e("div",ea,[e("button",{type:"button",onClick:g[7]||(g[7]=c=>h.value=!1),class:"cancel-btn"}," Cancel "),g[16]||(g[16]=e("button",{type:"submit",class:"submit-btn"}," Save Changes ",-1))])],32)])])):k("",!0)],64))}},ta=j(la,[["__scopeId","data-v-25287d99"]]),sa={class:"buy-view"},aa={class:"content"},oa={class:"master-detail-vertical"},na=["onClick","disabled"],ia=["onClick","disabled"];const ua=["onClick","disabled"],ra={key:0,class:"dialog-overlay"},da={class:"dialog"},ca={class:"form-group"},va=["value"],pa={class:"form-group"},_a={class:"form-group"},ba={class:"form-group"},ma=["href"],fa={class:"dialog-buttons"},ga=["disabled"],ya={key:0,class:"spinner"},ka={key:1,class:"dialog-overlay"},Ea={class:"dialog"},$a={class:"form-group"},Ca=["value"],wa={class:"form-group"},ha={class:"form-group"},Sa={class:"form-group"},Da=["href"],Aa={key:1,class:"validation-message"},Na={class:"dialog-buttons"},Ta=["disabled"],Ua={key:0,class:"spinner"},Pa={key:2,class:"dialog-overlay"},Ra={class:"dialog"},Va={class:"form-group"},Ba=["value"],Oa={class:"form-group"},Ia=["value"],qa={class:"form-group"},La={class:"form-group"},Fa={class:"form-row"},Ma={class:"form-group half"},xa={class:"form-group half"},Wa={class:"form-group"},Ha={class:"form-group"},Ya={class:"form-group checkbox"},Ja={class:"dialog-buttons"},Qa=["disabled"],ja={key:0,class:"spinner"},Ga={__name:"BuyView",setup(q){const{callApi:D,uploadFile:E,getFileUrl:T}=z(),P=ge(),h=b([]),d=b(null),A=b([]),_=b([]),$=b([]),N=b([]),y=b(!1),U=b(!1),g=b(!1),c=b(null),i=b(!1),p=b(!1),S=b(JSON.parse(localStorage.getItem("user"))),R=Y(()=>{var C;return((C=S.value)==null?void 0:C.role_id)===1}),V=C=>C.amount>0&&!C.is_stock_updated,M=async C=>{if(confirm("Are you sure you want to update the stock? This action cannot be undone."))try{(await D({query:`
        UPDATE buy_bill 
        SET is_stock_updated = 1 
        WHERE id = ?
      `,params:[C.id]})).success?await G():alert("Failed to update stock")}catch(u){console.error("Error updating stock:",u),alert("Failed to update stock")}},K=async C=>{var u;if(confirm("Are you sure you want to delete this purchase and all its details? This action cannot be undone."))try{if(C.is_stock_updated){alert("Cannot delete a purchase that has already been updated in stock");return}if(!(await D({query:"DELETE FROM buy_payments WHERE id_buy_bill = ?",params:[C.id]})).success)throw new Error("Failed to delete related payments");if(!(await D({query:"DELETE FROM buy_details WHERE id_buy_bill = ?",params:[C.id]})).success)throw new Error("Failed to delete purchase details");if((await D({query:"DELETE FROM buy_bill WHERE id = ? AND is_stock_updated = 0",params:[C.id]})).success)((u=d.value)==null?void 0:u.id)===C.id&&(d.value=null,A.value=[]),await G();else throw new Error("Failed to delete purchase")}catch(o){console.error("Error deleting purchase:",o),alert(o.message||"Failed to delete purchase")}},I=C=>{c.value=C,r.value={id_supplier:C.id_supplier,date_buy:C.date_buy.slice(0,16),bill_ref:C.bill_ref||"",pi_path:C.pi_path||"",pi_file:null},U.value=!0},F=()=>{c.value=null,r.value={id_supplier:null,date_buy:new Date().toISOString().slice(0,16),bill_ref:"",pi_path:"",pi_file:null},y.value=!0},r=b({id_supplier:null,date_buy:new Date().toISOString().slice(0,16),amount:0,bill_ref:"",pi_path:"",pi_file:null}),s=b({id_car_name:null,id_color:null,amount:0,notes:"",QTY:1,year:new Date().getFullYear(),month:new Date().getMonth()+1,is_used_car:!1,id_buy_bill:null}),v=C=>{const u=C.target.files[0];if(!u)return;if(!["application/pdf","image/jpeg","image/png","image/gif","image/webp"].includes(u.type)){alert("Only PDF and image files (JPEG, PNG, GIF, WEBP) are allowed"),C.target.value="";return}r.value.pi_file=u},J=async()=>{const C=await D({query:"SELECT * FROM suppliers ORDER BY name ASC",params:[]});C.success&&(_.value=C.data)},ee=async()=>{var C;if(!i.value)try{if(i.value=!0,!r.value.pi_file){alert("PI document is required. Please select a file.");return}try{const o=new Date,l=o.getTime(),a=o.toISOString().split("T")[0],H=o.toISOString().split("T")[1].split(".")[0].replace(/:/g,"-"),_e=((C=_.value.find(me=>me.id===r.value.id_supplier))==null?void 0:C.name)||"unknown",be=r.value.pi_file.name.split(".").pop().toLowerCase(),ae=`pi_purchase_${_e.replace(/\s+/g,"_")}_${a}_${H}_${l}.${be}`,oe=await E(r.value.pi_file,"purchase_pi",ae);if(!oe.success)throw new Error(oe.message||"Failed to upload PI document");r.value.pi_path=`purchase_pi/${ae}`}catch(o){throw console.error("Upload error:",o),new Error(`Failed to upload PI document: ${o.message}`)}const u=await D({query:`
        INSERT INTO buy_bill (id_supplier, date_buy, bill_ref, pi_path)
        VALUES (?, ?, ?, ?)
      `,params:[r.value.id_supplier,r.value.date_buy,r.value.bill_ref,r.value.pi_path]});if(u.success)y.value=!1,await G(),r.value={id_supplier:null,date_buy:new Date().toISOString().slice(0,16),bill_ref:"",pi_path:"",pi_file:null};else throw new Error(u.error||"Failed to add purchase")}catch(u){console.error("Error adding purchase:",u),alert(u.message)}finally{i.value=!1}},le=async()=>{var C;if(!i.value)try{if(i.value=!0,!r.value.pi_file&&!r.value.pi_path){alert("PI document is required. Please select a file.");return}if(r.value.pi_file)try{const o=new Date,l=o.getTime(),a=o.toISOString().split("T")[0],H=o.toISOString().split("T")[1].split(".")[0].replace(/:/g,"-"),_e=((C=_.value.find(me=>me.id===r.value.id_supplier))==null?void 0:C.name)||"unknown",be=r.value.pi_file.name.split(".").pop().toLowerCase(),ae=`pi_purchase_${_e.replace(/\s+/g,"_")}_${a}_${H}_${l}.${be}`,oe=await E(r.value.pi_file,"purchase_pi",ae);if(!oe.success)throw new Error(oe.message||"Failed to upload PI document");r.value.pi_path=`purchase_pi/${ae}`}catch(o){throw console.error("Upload error:",o),new Error(`Failed to upload PI document: ${o.message}`)}const u=await D({query:`
        UPDATE buy_bill 
        SET id_supplier = ?, date_buy = ?, bill_ref = ?, pi_path = ?
        WHERE id = ?
      `,params:[r.value.id_supplier,r.value.date_buy,r.value.bill_ref,r.value.pi_path,c.value.id]});if(u.success)U.value=!1,c.value=null,await G(),r.value={id_supplier:null,date_buy:new Date().toISOString().slice(0,16),bill_ref:"",pi_path:"",pi_file:null};else throw new Error(u.error||"Failed to update purchase")}catch(u){console.error("Error updating purchase:",u),alert(u.message)}finally{i.value=!1}},G=async()=>{const C=await D({query:`
      SELECT 
        bb.*,
        s.name as supplier_name,
        COALESCE((
          SELECT SUM(amount * QTY)
          FROM buy_details
          WHERE id_buy_bill = bb.id
        ), 0) as calculated_amount
      FROM buy_bill bb 
      LEFT JOIN suppliers s ON bb.id_supplier = s.id 
      ORDER BY bb.date_buy DESC
    `,params:[]});C.success&&(h.value=C.data.map(u=>({...u,amount:Number(u.calculated_amount),payed:Number(u.payed)})))},te=async C=>{const u=await D({query:`
      SELECT bd.*, cn.car_name, c.color, bb.is_stock_updated
      FROM buy_details bd
      LEFT JOIN cars_names cn ON bd.id_car_name = cn.id
      LEFT JOIN colors c ON bd.id_color = c.id
      LEFT JOIN buy_bill bb ON bd.id_buy_bill = bb.id
      WHERE bd.id_buy_bill = ?
    `,params:[C]});u.success?A.value=u.data:console.error("Error fetching details:",u.error)},ie=C=>{d.value=C,te(C.id)},ue=async()=>{const C=await D({query:"SELECT * FROM cars_names ORDER BY car_name ASC",params:[]});C.success&&($.value=C.data)},re=async()=>{const C=await D({query:"SELECT * FROM colors ORDER BY color ASC",params:[]});C.success&&(N.value=C.data)},se=async C=>{const u=await D({query:`
      UPDATE buy_bill 
      SET amount = (
        SELECT COALESCE(SUM(amount * QTY), 0)
        FROM buy_details
        WHERE id_buy_bill = ?
      )
      WHERE id = ?
    `,params:[C,C]});u.success||console.error("Error updating bill amount:",u.error)},de=async()=>{if(!p.value)try{p.value=!0;const C=await D({query:`
      INSERT INTO buy_details 
      (id_car_name, id_color, amount, notes, QTY, year, month, is_used_car, id_buy_bill, price_sell)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `,params:[s.value.id_car_name,s.value.id_color,s.value.amount,s.value.notes,s.value.QTY,s.value.year,s.value.month,s.value.is_used_car?1:0,d.value.id,s.value.price_sell]});C.success?(await se(d.value.id),g.value=!1,await te(d.value.id),await G(),s.value={id_car_name:null,id_color:null,amount:0,notes:"",QTY:1,year:new Date().getFullYear(),month:new Date().getMonth()+1,is_used_car:!1,id_buy_bill:null}):console.error("Error adding detail:",C.error)}catch(C){console.error("Error adding detail:",C),alert("Failed to add detail. Please try again.")}finally{p.value=!1}};X(()=>{G(),J(),ue(),re()});const ce=async C=>{const u=await D({query:"DELETE FROM buy_details WHERE id = ?",params:[C]});u.success?(await se(d.value.id),await te(d.value.id),await G()):(alert("Failed to delete detail. Please try again."),console.error("Error deleting detail:",u.error))},ve=async C=>{const u=await D({query:`
      UPDATE buy_details 
      SET QTY = ?, amount = ?, year = ?, month = ?, notes = ?, price_sell = ?
      WHERE id = ?
    `,params:[C.QTY,C.amount,C.year,C.month,C.notes,C.price_sell,C.id]});u.success?(await se(d.value.id),await te(d.value.id),await G()):(alert("Failed to update detail. Please try again."),console.error("Error updating detail:",u.error))},pe=C=>{const u=P.resolve({name:"buy-payments",params:{id:C.id}});window.open(u.href,"_blank")};return(C,u)=>(t(),n("div",sa,[e("div",{class:"header"},[u[19]||(u[19]=e("h2",null,"Buy Management",-1)),e("button",{onClick:F,class:"add-btn"},"Add New Purchase")]),e("div",aa,[e("div",oa,[ke(Bs,{buyBills:h.value,selectedBill:d.value,onSelectBill:ie},{actions:Ee(({bill:o})=>[e("button",{onClick:Z(l=>pe(o),["stop"]),class:"payment-btn",disabled:o.is_stock_updated}," Payments ",8,na),e("button",{onClick:Z(l=>I(o),["stop"]),class:"action-btn edit-btn",disabled:o.is_stock_updated}," Edit ",8,ia),k("",!0),R.value?(t(),n("button",{key:1,onClick:Z(l=>K(o),["stop"]),class:"action-btn delete-btn",disabled:o.is_stock_updated}," Delete ",8,ua)):k("",!0)]),_:1},8,["buyBills","selectedBill"]),d.value?(t(),Q(ta,{key:0,buyDetails:A.value,isAdmin:R.value,onAddDetail:u[0]||(u[0]=o=>g.value=!0),onDeleteDetail:ce,onUpdateDetail:ve},null,8,["buyDetails","isAdmin"])):k("",!0)])]),y.value?(t(),n("div",ra,[e("div",da,[u[25]||(u[25]=e("h3",null,"Add New Purchase",-1)),e("form",{onSubmit:Z(ee,["prevent"])},[e("div",ca,[u[21]||(u[21]=e("label",null,"Supplier",-1)),f(e("select",{"onUpdate:modelValue":u[1]||(u[1]=o=>r.value.id_supplier=o),required:""},[u[20]||(u[20]=e("option",{value:""},"Select Supplier",-1)),(t(!0),n(B,null,O(_.value,o=>(t(),n("option",{key:o.id,value:o.id},m(o.name),9,va))),128))],512),[[x,r.value.id_supplier]])]),e("div",pa,[u[22]||(u[22]=e("label",null,"Date",-1)),f(e("input",{type:"datetime-local","onUpdate:modelValue":u[2]||(u[2]=o=>r.value.date_buy=o),required:""},null,512),[[w,r.value.date_buy]])]),e("div",_a,[u[23]||(u[23]=e("label",null,[W("Bill Reference "),e("span",{class:"required"},"*")],-1)),f(e("input",{type:"text","onUpdate:modelValue":u[3]||(u[3]=o=>r.value.bill_ref=o),placeholder:"Enter bill reference number",required:""},null,512),[[w,r.value.bill_ref]])]),e("div",ba,[u[24]||(u[24]=e("label",null,[W("PI Document (PDF or Image) "),e("span",{class:"required"},"*")],-1)),e("input",{type:"file",onChange:v,accept:".pdf,.jpg,.jpeg,.png,.gif,.webp",required:""},null,32),r.value.pi_path?(t(),n("a",{key:0,href:ne(T)(r.value.pi_path),target:"_blank",class:"current-file-link"}," View Current PI Document ",8,ma)):k("",!0)]),e("div",fa,[e("button",{type:"button",onClick:u[4]||(u[4]=o=>y.value=!1),class:"cancel-btn"},"Cancel"),e("button",{type:"submit",class:"submit-btn",disabled:i.value},[i.value?(t(),n("span",ya)):k("",!0),W(" "+m(i.value?"Adding...":"Add Purchase"),1)],8,ga)])],32)])])):k("",!0),U.value?(t(),n("div",ka,[e("div",Ea,[u[31]||(u[31]=e("h3",null,"Edit Purchase",-1)),e("form",{onSubmit:Z(le,["prevent"])},[e("div",$a,[u[27]||(u[27]=e("label",null,"Supplier",-1)),f(e("select",{"onUpdate:modelValue":u[5]||(u[5]=o=>r.value.id_supplier=o),required:""},[u[26]||(u[26]=e("option",{value:""},"Select Supplier",-1)),(t(!0),n(B,null,O(_.value,o=>(t(),n("option",{key:o.id,value:o.id},m(o.name),9,Ca))),128))],512),[[x,r.value.id_supplier]])]),e("div",wa,[u[28]||(u[28]=e("label",null,"Date",-1)),f(e("input",{type:"datetime-local","onUpdate:modelValue":u[6]||(u[6]=o=>r.value.date_buy=o),required:""},null,512),[[w,r.value.date_buy]])]),e("div",ha,[u[29]||(u[29]=e("label",null,[W("Bill Reference "),e("span",{class:"required"},"*")],-1)),f(e("input",{type:"text","onUpdate:modelValue":u[7]||(u[7]=o=>r.value.bill_ref=o),placeholder:"Enter bill reference number",required:""},null,512),[[w,r.value.bill_ref]])]),e("div",Sa,[u[30]||(u[30]=e("label",null,[W("PI Document (PDF or Image) "),e("span",{class:"required"},"*")],-1)),e("input",{type:"file",onChange:v,accept:".pdf,.jpg,.jpeg,.png,.gif,.webp"},null,32),r.value.pi_path?(t(),n("a",{key:0,href:ne(T)(r.value.pi_path),target:"_blank",class:"current-file-link"}," View Current PI Document ",8,Da)):k("",!0),!r.value.pi_path&&!r.value.pi_file?(t(),n("div",Aa," PI document is required ")):k("",!0)]),e("div",Na,[e("button",{type:"button",onClick:u[8]||(u[8]=o=>U.value=!1),class:"cancel-btn"},"Cancel"),e("button",{type:"submit",class:"submit-btn",disabled:i.value},[i.value?(t(),n("span",Ua)):k("",!0),W(" "+m(i.value?"Updating...":"Update Purchase"),1)],8,Ta)])],32)])])):k("",!0),g.value?(t(),n("div",Pa,[e("div",Ra,[u[43]||(u[43]=e("h3",null,"Add Purchase Detail",-1)),e("form",{onSubmit:Z(de,["prevent"])},[e("div",Va,[u[33]||(u[33]=e("label",null,"Car",-1)),f(e("select",{"onUpdate:modelValue":u[9]||(u[9]=o=>s.value.id_car_name=o),required:""},[u[32]||(u[32]=e("option",{value:""},"Select Car",-1)),(t(!0),n(B,null,O($.value,o=>(t(),n("option",{key:o.id,value:o.id},m(o.car_name),9,Ba))),128))],512),[[x,s.value.id_car_name]])]),e("div",Oa,[u[35]||(u[35]=e("label",null,"Color",-1)),f(e("select",{"onUpdate:modelValue":u[10]||(u[10]=o=>s.value.id_color=o),required:""},[u[34]||(u[34]=e("option",{value:""},"Select Color",-1)),(t(!0),n(B,null,O(N.value,o=>(t(),n("option",{key:o.id,value:o.id},m(o.color),9,Ia))),128))],512),[[x,s.value.id_color]])]),e("div",qa,[u[36]||(u[36]=e("label",null,"Quantity",-1)),f(e("input",{type:"number","onUpdate:modelValue":u[11]||(u[11]=o=>s.value.QTY=o),min:"1",required:""},null,512),[[w,s.value.QTY]])]),e("div",La,[u[37]||(u[37]=e("label",null,"Amount",-1)),f(e("input",{type:"number","onUpdate:modelValue":u[12]||(u[12]=o=>s.value.amount=o),step:"0.01",required:""},null,512),[[w,s.value.amount]])]),e("div",Fa,[e("div",Ma,[u[38]||(u[38]=e("label",null,"Year",-1)),f(e("input",{type:"number","onUpdate:modelValue":u[13]||(u[13]=o=>s.value.year=o),required:""},null,512),[[w,s.value.year]])]),e("div",xa,[u[39]||(u[39]=e("label",null,"Month",-1)),f(e("input",{type:"number","onUpdate:modelValue":u[14]||(u[14]=o=>s.value.month=o),min:"1",max:"12",required:""},null,512),[[w,s.value.month]])])]),e("div",Wa,[u[40]||(u[40]=e("label",null,"Price Sell",-1)),f(e("input",{type:"number","onUpdate:modelValue":u[15]||(u[15]=o=>s.value.price_sell=o),step:"0.01",required:""},null,512),[[w,s.value.price_sell]])]),e("div",Ha,[u[41]||(u[41]=e("label",null,"Notes",-1)),f(e("textarea",{"onUpdate:modelValue":u[16]||(u[16]=o=>s.value.notes=o),rows:"3"},null,512),[[w,s.value.notes]])]),e("div",Ya,[e("label",null,[f(e("input",{type:"checkbox","onUpdate:modelValue":u[17]||(u[17]=o=>s.value.is_used_car=o)},null,512),[[fe,s.value.is_used_car]]),u[42]||(u[42]=W(" Used Car "))])]),e("div",Ja,[e("button",{type:"button",onClick:u[18]||(u[18]=o=>g.value=!1),class:"cancel-btn"}," Cancel "),e("button",{type:"submit",class:"submit-btn",disabled:p.value},[p.value?(t(),n("span",ja)):k("",!0),W(" "+m(p.value?"Adding...":"Add Detail"),1)],8,Qa)])],32)])])):k("",!0)]))}},za=j(Ga,[["__scopeId","data-v-dddd1378"]]),Ka={class:"sell-view"},Xa={class:"header"},Za={key:0,class:"selected-bill"},eo={class:"bill-id"},lo={class:"content"},to={key:0,class:"loading"},so={key:1,class:"error"},ao={key:2,class:"tables-container"},oo={class:"sell-bills-table"},no=["onClick"],io=["onClick"],uo=["onClick"],ro={key:0,class:"car-stock-table"},co={key:0,class:"loading"},vo={key:1,class:"no-data"},po={key:2},_o=["onClick"],bo=["onClick"],mo={key:1,class:"available-cars-table"},fo={key:0,class:"loading"},go={key:1,class:"no-data"},yo={key:2},ko=["onClick"],Eo={key:1,class:"dialog-overlay"},$o={class:"dialog"},Co={class:"form-group"},wo=["value"],ho={class:"form-group"},So={class:"form-group"},Do=["value"],Ao={class:"form-group"},No=["value"],To={class:"form-group"},Uo={class:"dialog-buttons"},Po={key:2,class:"dialog-overlay"},Ro={class:"dialog"},Vo={class:"form-group"},Bo=["value"],Oo={class:"form-group"},Io={class:"form-group"},qo={class:"dialog-buttons"},Lo={key:3,class:"dialog-overlay"},Fo={class:"dialog"},Mo={class:"form-group"},xo=["value"],Wo={class:"form-group"},Ho={class:"form-group"},Yo=["value"],Jo={class:"form-group"},Qo=["value"],jo={class:"form-group"},Go={class:"form-group"},zo={class:"dialog-buttons"},Ko={key:4,class:"dialog-overlay"},Xo={class:"dialog"},Zo={class:"form-group"},en=["value"],ln={class:"form-group"},tn={class:"form-group"},sn=["value"],an={class:"form-group"},on=["value"],nn={class:"form-group"},un={class:"dialog-buttons"},rn={key:5,class:"dialog-overlay"},dn={class:"dialog"},cn={class:"form-group"},vn=["value"],pn={class:"form-group"},_n={class:"form-group"},bn={class:"dialog-buttons"},mn={key:6,class:"dialog-overlay"},fn={class:"dialog"},gn={class:"form-group"},yn=["value"],kn={class:"form-group"},En={class:"form-group"},$n={class:"dialog-buttons"},Cn={__name:"SellView",setup(q){const{callApi:D}=z(),E=b([]),T=b([]),P=b([]),h=b(!0),d=b(!1),A=b(!1),_=b(null),$=b(null),N=b(!1),y=b(!1),U=b(!1),g=b(!1),c=b(!1),i=b(null),p=b([]),S=b([]),R=b([]),V=b(!1),M=b({id:null,id_broker:null,date_sell:"",notes:""}),K=b(!1),I=b(null),F=b({id_broker:null,date_sell:new Date().toISOString().split("T")[0],notes:""}),r=b([]),s=async()=>{h.value=!0,_.value=null;try{const o=await D({query:`
        SELECT 
          sb.id,
          sb.date_sell,
          sb.notes,
          c.name as broker_name,
          c.mobiles as broker_mobile
        FROM sell_bill sb
        LEFT JOIN clients c ON sb.id_broker = c.id AND c.is_broker = 1
        ORDER BY sb.date_sell DESC
      `,params:[]});o.success?E.value=o.data:_.value=o.error||"Failed to fetch sell bills"}catch(o){_.value=o.message||"An error occurred"}finally{h.value=!1}},v=async()=>{try{const o=await D({query:`
        SELECT id, name, mobiles
        FROM clients
        WHERE is_broker = 1
        ORDER BY name ASC
      `,params:[]});o.success&&(r.value=o.data)}catch(o){console.error("Error fetching brokers:",o)}},J=async o=>{$.value=o.id,await ee(o.id)},ee=async o=>{d.value=!0;try{const l=await D({query:`
        SELECT 
          cs.id,
          cs.vin,
          cs.price_cell,
          cs.date_loding,
          cs.date_sell,
          cs.notes,
          cs.freight,
          cs.path_documents,
          cs.sell_pi_path,
          cs.buy_pi_path,
          c.name as client_name,
          cn.car_name,
          clr.color,
          lp.loading_port,
          dp.discharge_port,
          bd.price_sell as buy_price
        FROM cars_stock cs
        LEFT JOIN clients c ON cs.id_client = c.id
        LEFT JOIN buy_details bd ON cs.id_buy_details = bd.id
        LEFT JOIN cars_names cn ON bd.id_car_name = cn.id
        LEFT JOIN colors clr ON bd.id_color = clr.id
        LEFT JOIN loading_ports lp ON cs.id_port_loading = lp.id
        LEFT JOIN discharge_ports dp ON cs.id_port_discharge = dp.id
        WHERE cs.id_sell = ? AND cs.hidden = 0
        ORDER BY cs.id DESC
      `,params:[o]});l.success?T.value=l.data:_.value=l.error||"Failed to fetch cars stock"}catch(l){_.value=l.message||"An error occurred"}finally{d.value=!1}},le=async()=>{A.value=!0;try{const o=await D({query:`
        SELECT 
          cs.id,
          cs.vin,
          cs.price_cell,
          cs.date_loding,
          cs.notes,
          cs.freight,
          c.name as client_name,
          cn.car_name,
          clr.color,
          lp.loading_port,
          dp.discharge_port,
          bd.price_sell as buy_price
        FROM cars_stock cs
        LEFT JOIN clients c ON cs.id_client = c.id
        LEFT JOIN buy_details bd ON cs.id_buy_details = bd.id
        LEFT JOIN cars_names cn ON bd.id_car_name = cn.id
        LEFT JOIN colors clr ON bd.id_color = clr.id
        LEFT JOIN loading_ports lp ON cs.id_port_loading = lp.id
        LEFT JOIN discharge_ports dp ON cs.id_port_discharge = dp.id
        WHERE cs.id_sell IS NULL AND cs.hidden = 0
        ORDER BY cs.id DESC
      `,params:[]});o.success?P.value=o.data:_.value=o.error||"Failed to fetch available cars"}catch(o){_.value=o.message||"An error occurred"}finally{A.value=!1}},G=async()=>{if(!y.value)try{y.value=!0;const o=await D({query:`
        INSERT INTO sell_bill (id_broker, date_sell, notes)
        VALUES (?, ?, ?)
      `,params:[F.value.id_broker,F.value.date_sell,F.value.notes]});o.success?(N.value=!1,F.value={id_broker:null,date_sell:new Date().toISOString().split("T")[0],notes:""},await s()):_.value=o.error||"Failed to add sell bill"}catch(o){_.value=o.message||"An error occurred"}finally{y.value=!1}},te=async()=>{try{const o=await D({query:"SELECT * FROM loading_ports ORDER BY loading_port ASC",params:[]});o.success&&(p.value=o.data)}catch(o){console.error("Error fetching loading ports:",o)}},ie=async()=>{try{const o=await D({query:"SELECT * FROM discharge_ports ORDER BY discharge_port ASC",params:[]});o.success&&(S.value=o.data)}catch(o){console.error("Error fetching discharge ports:",o)}},ue=async()=>{try{const o=await D({query:"SELECT * FROM clients WHERE is_broker = 0 ORDER BY name ASC",params:[]});o.success&&(R.value=o.data)}catch(o){console.error("Error fetching clients:",o)}},re=o=>{i.value={...o},c.value=!0},se=async()=>{if(!U.value){if(!$.value){alert("Please select a bill first");return}if(!i.value.id_client){alert("Client name is required");return}if(!i.value.id_port_discharge){alert("Discharge port is required");return}if(!i.value.price_cell){alert("Selling price is required");return}try{U.value=!0;const o=await D({query:`
        UPDATE cars_stock 
        SET id_sell = ?,
            id_client = ?,
            vin = ?,
            id_port_loading = ?,
            id_port_discharge = ?,
            price_cell = ?
        WHERE id = ?
      `,params:[$.value,i.value.id_client,i.value.vin,i.value.id_port_loading,i.value.id_port_discharge,i.value.price_cell,i.value.id]});o.success?(c.value=!1,await ee($.value),await le()):_.value=o.error||"Failed to assign car to bill"}catch(o){_.value=o.message||"An error occurred"}finally{U.value=!1}}},de=async o=>{try{const l=await D({query:`
        UPDATE cars_stock 
        SET id_client = NULL,
            id_port_discharge = NULL,
            id_sell = NULL
        WHERE id = ?
      `,params:[o]});l.success?(await ee($.value),await le()):_.value=l.error||"Failed to unassign car"}catch(l){_.value=l.message||"An error occurred"}},ce=(o,l)=>{l.stopPropagation(),M.value={id:o.id,id_broker:o.id_broker,date_sell:o.date_sell.split("T")[0],notes:o.notes||""},V.value=!0},ve=async()=>{if(!g.value)try{g.value=!0;const o=await D({query:`
        UPDATE sell_bill 
        SET id_broker = ?, 
            date_sell = ?, 
            notes = ?
        WHERE id = ?
      `,params:[M.value.id_broker,M.value.date_sell,M.value.notes,M.value.id]});o.success?(V.value=!1,await s(),$.value===M.value.id&&await ee($.value)):_.value=o.error||"Failed to update sell bill"}catch(o){_.value=o.message||"An error occurred"}finally{g.value=!1}},pe=async(o,l)=>{if(l.stopPropagation(),!!confirm("Are you sure you want to delete this sell bill? This will also unassign all cars from this bill."))try{const a=await D({query:`
        UPDATE cars_stock 
        SET id_sell = NULL 
        WHERE id_sell = ?
      `,params:[o]});if(!a.success){_.value=a.error||"Failed to unassign cars from bill";return}const H=await D({query:`
        DELETE FROM sell_bill 
        WHERE id = ?
      `,params:[o]});H.success?($.value===o&&($.value=null,T.value=[]),await s(),await le()):_.value=H.error||"Failed to delete sell bill"}catch(a){_.value=a.message||"An error occurred"}};X(async()=>{await s(),await v(),await le(),await te(),await ie(),await ue()});const C=o=>{I.value={...o},K.value=!0},u=async()=>{if(I.value&&!g.value)try{g.value=!0;const o=await D({query:`
        UPDATE cars_stock 
        SET id_client = ?,
            vin = ?,
            id_port_loading = ?,
            id_port_discharge = ?,
            price_cell = ?,
            notes = ?
        WHERE id = ?
      `,params:[I.value.id_client,I.value.vin,I.value.id_port_loading,I.value.id_port_discharge,I.value.price_cell,I.value.notes,I.value.id]});o.success?(K.value=!1,await ee($.value)):_.value=o.error||"Failed to update car"}catch(o){_.value=o.message||"An error occurred"}finally{g.value=!1}};return(o,l)=>(t(),n("div",Ka,[e("div",Xa,[l[32]||(l[32]=e("h2",null,"Sell Bills Management",-1)),e("button",{class:"add-btn",onClick:l[0]||(l[0]=a=>N.value=!0)}," Add New Sell Bill ")]),$.value?(t(),n("div",Za,[l[33]||(l[33]=W(" Selected Bill ID: ")),e("span",eo,m($.value),1)])):k("",!0),e("div",lo,[h.value?(t(),n("div",to,"Loading...")):_.value?(t(),n("div",so,m(_.value),1)):(t(),n("div",ao,[e("div",oo,[l[35]||(l[35]=e("h3",null,"Sell Bills",-1)),e("table",null,[l[34]||(l[34]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Date"),e("th",null,"Broker"),e("th",null,"Notes"),e("th",null,"Actions")])],-1)),e("tbody",null,[(t(!0),n(B,null,O(E.value,a=>(t(),n("tr",{key:a.id,onClick:H=>J(a),class:L({selected:$.value===a.id})},[e("td",null,m(a.id),1),e("td",null,m(new Date(a.date_sell).toLocaleDateString()),1),e("td",null,m(a.broker_name||"N/A"),1),e("td",null,m(a.notes||"N/A"),1),e("td",null,[e("button",{onClick:H=>ce(a,H),class:"btn edit-btn"},"Edit",8,io),e("button",{class:"btn delete-btn",onClick:H=>pe(a.id,H)},"Delete",8,uo)])],10,no))),128))])])]),$.value?(t(),n("div",ro,[l[37]||(l[37]=e("h3",null,"Cars in Selected Bill",-1)),d.value?(t(),n("div",co,"Loading cars...")):T.value.length===0?(t(),n("div",vo," No cars found for this sell bill ")):(t(),n("table",po,[l[36]||(l[36]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Car"),e("th",null,"Color"),e("th",null,"VIN"),e("th",null,"Client"),e("th",null,"Loading Port"),e("th",null,"Discharge Port"),e("th",null,"Buy Price"),e("th",null,"Sell Price"),e("th",null,"Profit"),e("th",null,"Actions")])],-1)),e("tbody",null,[(t(!0),n(B,null,O(T.value,a=>(t(),n("tr",{key:a.id},[e("td",null,m(a.id),1),e("td",null,m(a.car_name||"N/A"),1),e("td",null,m(a.color||"N/A"),1),e("td",null,m(a.vin||"N/A"),1),e("td",null,m(a.client_name||"N/A"),1),e("td",null,m(a.loading_port||"N/A"),1),e("td",null,m(a.discharge_port||"N/A"),1),e("td",null,"$"+m(a.buy_price||0),1),e("td",null,"$"+m(a.price_cell||0),1),e("td",null,"$"+m(a.price_cell-a.buy_price||0),1),e("td",null,[e("button",{onClick:H=>C(a),class:"edit-btn"},"Edit",8,_o),e("button",{onClick:H=>de(a.id),class:"unassign-btn"},"Unassign",8,bo)])]))),128))])]))])):k("",!0),$.value?(t(),n("div",mo,[l[39]||(l[39]=e("h3",null,"Available Cars",-1)),A.value?(t(),n("div",fo,"Loading...")):P.value.length===0?(t(),n("div",go,"No available cars")):(t(),n("table",yo,[l[38]||(l[38]=e("thead",null,[e("tr",null,[e("th",null,"Car"),e("th",null,"Color"),e("th",null,"VIN"),e("th",null,"Buy Price"),e("th",null,"Actions")])],-1)),e("tbody",null,[(t(!0),n(B,null,O(P.value,a=>(t(),n("tr",{key:a.id},[e("td",null,m(a.car_name||"N/A"),1),e("td",null,m(a.color||"N/A"),1),e("td",null,m(a.vin||"N/A"),1),e("td",null,"$"+m(a.buy_price||0),1),e("td",null,"$"+m(a.price_cell||0),1),e("td",null,"$"+m(a.price_cell-a.buy_price||0),1),e("td",null,[e("button",{onClick:H=>re(a),class:"assign-btn"},"Assign to Bill",8,ko)])]))),128))])]))])):k("",!0)]))]),c.value?(t(),n("div",Eo,[e("div",$o,[l[48]||(l[48]=e("h2",null,"Assign Car to Bill",-1)),e("div",Co,[l[41]||(l[41]=e("label",{for:"client"},[W("Client: "),e("span",{class:"required"},"*")],-1)),f(e("select",{id:"client","onUpdate:modelValue":l[1]||(l[1]=a=>i.value.id_client=a),required:""},[l[40]||(l[40]=e("option",{value:""},"Select Client",-1)),(t(!0),n(B,null,O(R.value,a=>(t(),n("option",{key:a.id,value:a.id},m(a.name),9,wo))),128))],512),[[x,i.value.id_client]])]),e("div",ho,[l[42]||(l[42]=e("label",{for:"vin"},"VIN:",-1)),f(e("input",{type:"text",id:"vin","onUpdate:modelValue":l[2]||(l[2]=a=>i.value.vin=a)},null,512),[[w,i.value.vin]])]),e("div",So,[l[44]||(l[44]=e("label",{for:"loading-port"},"Loading Port:",-1)),f(e("select",{id:"loading-port","onUpdate:modelValue":l[3]||(l[3]=a=>i.value.id_port_loading=a)},[l[43]||(l[43]=e("option",{value:""},"Select Loading Port",-1)),(t(!0),n(B,null,O(p.value,a=>(t(),n("option",{key:a.id,value:a.id},m(a.loading_port),9,Do))),128))],512),[[x,i.value.id_port_loading]])]),e("div",Ao,[l[46]||(l[46]=e("label",{for:"discharge-port"},[W("Discharge Port: "),e("span",{class:"required"},"*")],-1)),f(e("select",{id:"discharge-port","onUpdate:modelValue":l[4]||(l[4]=a=>i.value.id_port_discharge=a),required:""},[l[45]||(l[45]=e("option",{value:""},"Select Discharge Port",-1)),(t(!0),n(B,null,O(S.value,a=>(t(),n("option",{key:a.id,value:a.id},m(a.discharge_port),9,No))),128))],512),[[x,i.value.id_port_discharge]])]),e("div",To,[l[47]||(l[47]=e("label",{for:"sell-price"},[W("Sell Price: "),e("span",{class:"required"},"*")],-1)),f(e("input",{type:"number",id:"sell-price","onUpdate:modelValue":l[5]||(l[5]=a=>i.value.price_cell=a),required:""},null,512),[[w,i.value.price_cell]])]),e("div",Uo,[e("button",{onClick:se,class:"primary"},"Assign"),e("button",{onClick:l[6]||(l[6]=a=>c.value=!1)},"Cancel")])])])):k("",!0),N.value?(t(),n("div",Po,[e("div",Ro,[l[53]||(l[53]=e("h3",null,"Add New Sell Bill",-1)),e("div",Vo,[l[50]||(l[50]=e("label",{for:"broker"},"Broker:",-1)),f(e("select",{id:"broker","onUpdate:modelValue":l[7]||(l[7]=a=>F.value.id_broker=a)},[l[49]||(l[49]=e("option",{value:""},"Select Broker",-1)),(t(!0),n(B,null,O(r.value,a=>(t(),n("option",{key:a.id,value:a.id},m(a.name),9,Bo))),128))],512),[[x,F.value.id_broker]])]),e("div",Oo,[l[51]||(l[51]=e("label",{for:"date"},"Date:",-1)),f(e("input",{type:"date",id:"date","onUpdate:modelValue":l[8]||(l[8]=a=>F.value.date_sell=a)},null,512),[[w,F.value.date_sell]])]),e("div",Io,[l[52]||(l[52]=e("label",{for:"notes"},"Notes:",-1)),f(e("textarea",{id:"notes","onUpdate:modelValue":l[9]||(l[9]=a=>F.value.notes=a)},null,512),[[w,F.value.notes]])]),e("div",qo,[e("button",{onClick:l[10]||(l[10]=a=>N.value=!1)},"Cancel"),e("button",{onClick:G,class:"primary"},"Add")])])])):k("",!0),K.value?(t(),n("div",Lo,[e("div",Fo,[l[63]||(l[63]=e("h3",null,"Edit Car Details",-1)),e("div",Mo,[l[55]||(l[55]=e("label",{for:"edit-car-client"},"Client:",-1)),f(e("select",{id:"edit-car-client","onUpdate:modelValue":l[11]||(l[11]=a=>I.value.id_client=a)},[l[54]||(l[54]=e("option",{value:""},"Select Client",-1)),(t(!0),n(B,null,O(R.value,a=>(t(),n("option",{key:a.id,value:a.id},m(a.name),9,xo))),128))],512),[[x,I.value.id_client]])]),e("div",Wo,[l[56]||(l[56]=e("label",{for:"edit-car-vin"},"VIN:",-1)),f(e("input",{type:"text",id:"edit-car-vin","onUpdate:modelValue":l[12]||(l[12]=a=>I.value.vin=a)},null,512),[[w,I.value.vin]])]),e("div",Ho,[l[58]||(l[58]=e("label",{for:"edit-car-loading-port"},"Loading Port:",-1)),f(e("select",{id:"edit-car-loading-port","onUpdate:modelValue":l[13]||(l[13]=a=>I.value.id_port_loading=a)},[l[57]||(l[57]=e("option",{value:""},"Select Loading Port",-1)),(t(!0),n(B,null,O(p.value,a=>(t(),n("option",{key:a.id,value:a.id},m(a.loading_port),9,Yo))),128))],512),[[x,I.value.id_port_loading]])]),e("div",Jo,[l[60]||(l[60]=e("label",{for:"edit-car-discharge-port"},"Discharge Port:",-1)),f(e("select",{id:"edit-car-discharge-port","onUpdate:modelValue":l[14]||(l[14]=a=>I.value.id_port_discharge=a)},[l[59]||(l[59]=e("option",{value:""},"Select Discharge Port",-1)),(t(!0),n(B,null,O(S.value,a=>(t(),n("option",{key:a.id,value:a.id},m(a.discharge_port),9,Qo))),128))],512),[[x,I.value.id_port_discharge]])]),e("div",jo,[l[61]||(l[61]=e("label",{for:"edit-car-price"},"Selling Price:",-1)),f(e("input",{type:"number",id:"edit-car-price","onUpdate:modelValue":l[15]||(l[15]=a=>I.value.price_cell=a)},null,512),[[w,I.value.price_cell]])]),e("div",Go,[l[62]||(l[62]=e("label",{for:"edit-car-notes"},"Notes:",-1)),f(e("textarea",{id:"edit-car-notes","onUpdate:modelValue":l[16]||(l[16]=a=>I.value.notes=a)},null,512),[[w,I.value.notes]])]),e("div",zo,[e("button",{onClick:u,class:"primary"},"Update"),e("button",{onClick:l[17]||(l[17]=a=>K.value=!1)},"Cancel")])])])):k("",!0),c.value?(t(),n("div",Ko,[e("div",Xo,[l[72]||(l[72]=e("h2",null,"Assign Car to Bill",-1)),e("div",Zo,[l[65]||(l[65]=e("label",{for:"client"},[W("Client: "),e("span",{class:"required"},"*")],-1)),f(e("select",{id:"client","onUpdate:modelValue":l[18]||(l[18]=a=>i.value.id_client=a),required:""},[l[64]||(l[64]=e("option",{value:""},"Select Client",-1)),(t(!0),n(B,null,O(R.value,a=>(t(),n("option",{key:a.id,value:a.id},m(a.name),9,en))),128))],512),[[x,i.value.id_client]])]),e("div",ln,[l[66]||(l[66]=e("label",{for:"vin"},"VIN:",-1)),f(e("input",{type:"text",id:"vin","onUpdate:modelValue":l[19]||(l[19]=a=>i.value.vin=a)},null,512),[[w,i.value.vin]])]),e("div",tn,[l[68]||(l[68]=e("label",{for:"loading-port"},"Loading Port:",-1)),f(e("select",{id:"loading-port","onUpdate:modelValue":l[20]||(l[20]=a=>i.value.id_port_loading=a)},[l[67]||(l[67]=e("option",{value:""},"Select Loading Port",-1)),(t(!0),n(B,null,O(p.value,a=>(t(),n("option",{key:a.id,value:a.id},m(a.loading_port),9,sn))),128))],512),[[x,i.value.id_port_loading]])]),e("div",an,[l[70]||(l[70]=e("label",{for:"discharge-port"},[W("Discharge Port: "),e("span",{class:"required"},"*")],-1)),f(e("select",{id:"discharge-port","onUpdate:modelValue":l[21]||(l[21]=a=>i.value.id_port_discharge=a),required:""},[l[69]||(l[69]=e("option",{value:""},"Select Discharge Port",-1)),(t(!0),n(B,null,O(S.value,a=>(t(),n("option",{key:a.id,value:a.id},m(a.discharge_port),9,on))),128))],512),[[x,i.value.id_port_discharge]])]),e("div",nn,[l[71]||(l[71]=e("label",{for:"sell-price"},[W("Sell Price: "),e("span",{class:"required"},"*")],-1)),f(e("input",{type:"number",id:"sell-price","onUpdate:modelValue":l[22]||(l[22]=a=>i.value.price_cell=a),required:""},null,512),[[w,i.value.price_cell]])]),e("div",un,[e("button",{onClick:se,class:"primary"},"Assign"),e("button",{onClick:l[23]||(l[23]=a=>c.value=!1)},"Cancel")])])])):k("",!0),N.value?(t(),n("div",rn,[e("div",dn,[l[77]||(l[77]=e("h3",null,"Add New Sell Bill",-1)),e("div",cn,[l[74]||(l[74]=e("label",{for:"broker"},"Broker:",-1)),f(e("select",{id:"broker","onUpdate:modelValue":l[24]||(l[24]=a=>F.value.id_broker=a)},[l[73]||(l[73]=e("option",{value:""},"Select Broker",-1)),(t(!0),n(B,null,O(r.value,a=>(t(),n("option",{key:a.id,value:a.id},m(a.name),9,vn))),128))],512),[[x,F.value.id_broker]])]),e("div",pn,[l[75]||(l[75]=e("label",{for:"date"},"Date:",-1)),f(e("input",{type:"date",id:"date","onUpdate:modelValue":l[25]||(l[25]=a=>F.value.date_sell=a)},null,512),[[w,F.value.date_sell]])]),e("div",_n,[l[76]||(l[76]=e("label",{for:"notes"},"Notes:",-1)),f(e("textarea",{id:"notes","onUpdate:modelValue":l[26]||(l[26]=a=>F.value.notes=a)},null,512),[[w,F.value.notes]])]),e("div",bn,[e("button",{onClick:l[27]||(l[27]=a=>N.value=!1)},"Cancel"),e("button",{onClick:G,class:"primary"},"Add")])])])):k("",!0),V.value?(t(),n("div",mn,[e("div",fn,[l[82]||(l[82]=e("h3",null,"Edit Sell Bill",-1)),e("div",gn,[l[79]||(l[79]=e("label",{for:"edit-broker"},"Broker:",-1)),f(e("select",{id:"edit-broker","onUpdate:modelValue":l[28]||(l[28]=a=>M.value.id_broker=a)},[l[78]||(l[78]=e("option",{value:""},"Select Broker",-1)),(t(!0),n(B,null,O(r.value,a=>(t(),n("option",{key:a.id,value:a.id},m(a.name),9,yn))),128))],512),[[x,M.value.id_broker]])]),e("div",kn,[l[80]||(l[80]=e("label",{for:"edit-date"},"Date:",-1)),f(e("input",{type:"date",id:"edit-date","onUpdate:modelValue":l[29]||(l[29]=a=>M.value.date_sell=a)},null,512),[[w,M.value.date_sell]])]),e("div",En,[l[81]||(l[81]=e("label",{for:"edit-notes"},"Notes:",-1)),f(e("textarea",{id:"edit-notes","onUpdate:modelValue":l[30]||(l[30]=a=>M.value.notes=a)},null,512),[[w,M.value.notes]])]),e("div",$n,[e("button",{onClick:l[31]||(l[31]=a=>V.value=!1)},"Cancel"),e("button",{onClick:ve,class:"primary"},"Update")])])])):k("",!0)]))}},wn=j(Cn,[["__scopeId","data-v-f334adec"]]),hn={class:"cars-view"},Sn={class:"sidebar"},Dn={class:"sidebar-top"},An=["disabled"],Nn=["disabled"],Tn=["disabled"],Un={class:"sidebar-bottom"},Pn={class:"main-content"},Rn={class:"content"},Vn={key:0,class:"empty-state"},Bn={__name:"CarsView",setup(q){const D=ge(),E=b(null),T=N=>{E.value=N},P=()=>{D.push("/")},h=Y(()=>{const N=localStorage.getItem("user");return N?JSON.parse(N):null}),d=Y(()=>{var N;return h.value?((N=h.value)==null?void 0:N.role_id)===1:(D.push("/login"),!1)}),A=Y(()=>{var N;return d.value?!0:(N=user.value.permissions)==null?void 0:N.some(y=>y.permission_name==="can_purchase_cars")}),_=Y(()=>{var N;return d.value?!0:(N=user.value.permissions)==null?void 0:N.some(y=>y.permission_name==="can_sell_cars")}),$=Y(()=>{var N;return d.value?!0:(N=user.value.permissions)==null?void 0:N.some(y=>y.permission_name==="can_c_car_stock")});return(N,y)=>(t(),n("div",hn,[e("div",Sn,[e("div",Dn,[e("button",{onClick:P,class:"sidebar-btn return-btn"}," Return to Dashboard "),e("button",{disabled:!A.value,onClick:y[0]||(y[0]=U=>T("buy")),class:L([{active:E.value==="buy"},"sidebar-btn buy-btn"])}," Purchases ",10,An),k("",!0),e("button",{disabled:!_.value,onClick:y[2]||(y[2]=U=>T("sell-bills")),class:L([{active:E.value==="sell-bills"},"sidebar-btn sell-bills-btn"])}," Sells ",10,Nn),e("button",{disabled:!$.value,onClick:y[3]||(y[3]=U=>T("stock")),class:L([{active:E.value==="stock"},"sidebar-btn stock-btn"])}," Cars Stock ",10,Tn)]),e("div",Un,[y[12]||(y[12]=e("div",{class:"sidebar-section-title"},"Settings",-1)),A.value?(t(),n("button",{key:0,onClick:y[4]||(y[4]=U=>T("models")),class:L([{active:E.value==="models"},"sidebar-btn"])}," Car Models ",2)):k("",!0),A.value?(t(),n("button",{key:1,onClick:y[5]||(y[5]=U=>T("colors")),class:L([{active:E.value==="colors"},"sidebar-btn"])}," Colors ",2)):k("",!0),A.value?(t(),n("button",{key:2,onClick:y[6]||(y[6]=U=>T("discharge-ports")),class:L([{active:E.value==="discharge-ports"},"sidebar-btn"])}," Discharge Ports ",2)):k("",!0),A.value?(t(),n("button",{key:3,onClick:y[7]||(y[7]=U=>T("loading-ports")),class:L([{active:E.value==="loading-ports"},"sidebar-btn"])}," Loading Ports ",2)):k("",!0),_.value?(t(),n("button",{key:4,onClick:y[8]||(y[8]=U=>T("clients")),class:L([{active:E.value==="clients"},"sidebar-btn"])}," Clients ",2)):k("",!0),_.value?(t(),n("button",{key:5,onClick:y[9]||(y[9]=U=>T("brokers")),class:L([{active:E.value==="brokers"},"sidebar-btn"])}," Brokers ",2)):k("",!0),A.value?(t(),n("button",{key:6,onClick:y[10]||(y[10]=U=>T("suppliers")),class:L([{active:E.value==="suppliers"},"sidebar-btn"])}," Suppliers ",2)):k("",!0),A.value?(t(),n("button",{key:7,onClick:y[11]||(y[11]=U=>T("warehouses")),class:L([{active:E.value==="warehouses"},"sidebar-btn"])}," Warehouses ",2)):k("",!0)])]),e("div",Pn,[y[13]||(y[13]=e("h1",null,"Cars Management",-1)),e("div",Rn,[E.value?k("",!0):(t(),n("div",Vn," Please select an option from the sidebar ")),E.value==="buy"?(t(),Q(za,{key:1})):k("",!0),E.value==="sell"?(t(),Q(wn,{key:2})):k("",!0),E.value==="sell-bills"?(t(),Q(Ce,{key:3})):k("",!0),E.value==="stock"?(t(),Q($e,{key:4})):k("",!0),E.value==="models"?(t(),Q(kt,{key:5})):k("",!0),E.value==="colors"?(t(),Q(Ot,{key:6})):k("",!0),E.value==="discharge-ports"?(t(),Q(Xt,{key:7})):k("",!0),E.value==="loading-ports"?(t(),Q(_s,{key:8})):k("",!0),E.value==="clients"?(t(),Q(el,{key:9})):k("",!0),E.value==="brokers"?(t(),Q(El,{key:10})):k("",!0),E.value==="suppliers"?(t(),Q(Il,{key:11})):k("",!0),E.value==="warehouses"?(t(),Q(we,{key:12})):k("",!0)])])]))}},Fn=j(Bn,[["__scopeId","data-v-5717d124"]]);export{Fn as default};
//# sourceMappingURL=CarsView.txb5TwOG.js.map

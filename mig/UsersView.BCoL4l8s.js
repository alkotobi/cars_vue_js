import{_ as R,u as D,r as _,o as M,c as r,a as e,b as F,F as b,d as h,w as i,v as c,e as C,t as p,f as w,g as d,h as L,i as O}from"./index.CbkLKmc7.js";const $={class:"users-container"},q={class:"content-container"},x={class:"users-table"},I=["value"],B={class:"actions-cell"},P={class:"button-group"},H=["onClick","disabled"],W={class:"actions-cell"},J={class:"button-group"},j=["onClick"],z=["onClick","disabled"],G={class:"add-form"},K=["value"],Q=["disabled"],X={key:0,class:"error-message"},Y={__name:"UsersCrud",setup(V){const{callApi:u,error:m,loading:v}=D(),y=_([]),f=_([]),t=_({username:"",email:"",password:"",role_id:""}),E=_(null),o=_({username:"",email:"",password:"",role_id:""}),U=async()=>{const a=await u({query:`
      SELECT users.*, roles.role_name 
      FROM users 
      LEFT JOIN roles ON users.role_id = roles.id
    `});a.success&&(y.value=a.data)},g=async()=>{const a=await u({query:"SELECT * FROM roles"});a.success&&(f.value=a.data)},T=async()=>{if(!t.value.username||!t.value.password||!t.value.email)return;const a=await u({query:"INSERT INTO users (username, email, password, role_id) VALUES (?, ?, ?, ?)",params:[t.value.username,t.value.email,t.value.password,t.value.role_id],action:"insert_user"});a.success?(U(),t.value={username:"",email:"",password:"",role_id:""}):(m.value=a.error,console.error(a.error))},N=a=>{E.value=a.id,o.value={username:a.username,email:a.email,password:"",role_id:a.role_id}},S=async a=>{let s="UPDATE users SET username = ?, email = ?, role_id = ?",l=[o.value.username,o.value.email,o.value.role_id];o.value.password&&(s+=", password = ?",l.push(o.value.password)),s+=" WHERE id = ?",l.push(a.id),(await u({query:s,params:l,action:o.value.password?"hash_password":void 0})).success&&(U(),k())},k=()=>{E.value=null,o.value={username:"",password:"",role_id:""}},A=async a=>{if(!confirm(`Are you sure you want to delete user "${a.username}"?`))return;(await u({query:"DELETE FROM users WHERE id = ?",params:[a.id]})).success&&U()};return M(()=>{U(),g()}),(a,s)=>(d(),r("div",$,[s[12]||(s[12]=e("h2",{class:"title"},"Users",-1)),e("div",q,[e("table",x,[s[9]||(s[9]=e("thead",null,[e("tr",null,[e("th",null,"Username"),e("th",null,"Role"),e("th",null,"Actions")])],-1)),e("tbody",null,[(d(!0),r(b,null,h(y.value,l=>(d(),r("tr",{key:l.id},[E.value===l.id?(d(),r(b,{key:0},[e("td",null,[i(e("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>o.value.username=n),placeholder:"Username",class:"input-field"},null,512),[[c,o.value.username]])]),e("td",null,[i(e("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>o.value.email=n),placeholder:"Email",class:"input-field"},null,512),[[c,o.value.email]])]),e("td",null,[i(e("select",{"onUpdate:modelValue":s[2]||(s[2]=n=>o.value.role_id=n),class:"input-field"},[s[8]||(s[8]=e("option",{disabled:"",value:""},"Select Role",-1)),(d(!0),r(b,null,h(f.value,n=>(d(),r("option",{key:n.id,value:n.id},p(n.role_name),9,I))),128))],512),[[C,o.value.role_id]])]),e("td",B,[i(e("input",{"onUpdate:modelValue":s[3]||(s[3]=n=>o.value.password=n),type:"password",placeholder:"New Password (optional)",class:"input-field"},null,512),[[c,o.value.password]]),e("div",P,[e("button",{onClick:n=>S(l),disabled:w(v),class:"btn save-btn"},"Save",8,H),e("button",{onClick:k,class:"btn cancel-btn"},"Cancel")])])],64)):(d(),r(b,{key:1},[e("td",null,p(l.username),1),e("td",null,p(l.email),1),e("td",null,p(l.role_name||"No Role"),1),e("td",W,[e("div",J,[e("button",{onClick:n=>N(l),class:"btn edit-btn"},"Edit",8,j),e("button",{onClick:n=>A(l),disabled:w(v),class:"btn delete-btn"},"Delete",8,z)])])],64))]))),128))])]),e("div",G,[s[11]||(s[11]=e("h3",null,"Add New User",-1)),i(e("input",{"onUpdate:modelValue":s[4]||(s[4]=l=>t.value.username=l),placeholder:"Username",class:"input-field"},null,512),[[c,t.value.username]]),i(e("input",{"onUpdate:modelValue":s[5]||(s[5]=l=>t.value.email=l),type:"email",placeholder:"Email",class:"input-field"},null,512),[[c,t.value.email]]),i(e("input",{"onUpdate:modelValue":s[6]||(s[6]=l=>t.value.password=l),type:"password",placeholder:"Password",class:"input-field"},null,512),[[c,t.value.password]]),i(e("select",{"onUpdate:modelValue":s[7]||(s[7]=l=>t.value.role_id=l),class:"input-field"},[s[10]||(s[10]=e("option",{disabled:"",value:""},"Select Role",-1)),(d(!0),r(b,null,h(f.value,l=>(d(),r("option",{key:l.id,value:l.id},p(l.role_name),9,K))),128))],512),[[C,t.value.role_id]]),e("button",{onClick:T,disabled:w(v),class:"btn add-btn"},"Add User",8,Q)]),w(m)?(d(),r("div",X,p(w(m)),1)):F("",!0)])]))}},Z=R(Y,[["__scopeId","data-v-9ab28ec7"]]),ee={class:"users-page"},se={__name:"UsersView",setup(V){const u=O(),m=()=>{u.push("/roles")},v=()=>{u.push("/")};return(y,f)=>(d(),r("div",ee,[e("div",{class:"header-buttons"},[e("button",{onClick:v,class:"dashboard-btn"},"‚Üê Return to Dashboard")]),L(Z),e("button",{onClick:m,class:"roles-btn"},"Manage Roles")]))}},ae=R(se,[["__scopeId","data-v-5e3dd633"]]);export{ae as default};
//# sourceMappingURL=UsersView.BCoL4l8s.js.map

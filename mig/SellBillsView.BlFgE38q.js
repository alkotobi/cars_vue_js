import{_ as R,u as U,r as v,o as J,c as r,a as l,t as e,F as O,d as L,p as H,s as q,g as d,x,b as D,w as B,e as V,v as T,n as P,h as w,y as Y,j as z}from"./index.e4AY3vWr.js";const G={class:"sell-bills-table-component"},j={key:0,class:"loading"},Z={key:1,class:"error"},K={key:2,class:"no-data"},Q={key:3,class:"sell-bills-table"},X=["onClick"],ll=["onClick"],el=["onClick"],sl={__name:"SellBillsTable",props:{onEdit:Function,onDelete:Function,onSelect:Function},emits:["refresh","select-bill"],setup(S,{expose:A,emit:y}){const $=S,k=y,{callApi:N}=U(),u=v([]),f=v(!0),b=v(null),c=v(null),p=async()=>{f.value=!0,b.value=null;try{const t=await N({query:`
        SELECT 
          sb.id,
          sb.id_broker,
          sb.date_sell,
          sb.notes,
          c.name as broker_name
        FROM sell_bill sb
        LEFT JOIN clients c ON sb.id_broker = c.id AND c.is_broker = 1
        ORDER BY sb.date_sell DESC
      `,params:[]});t.success?u.value=t.data:b.value=t.error||"Failed to fetch sell bills"}catch(t){b.value=t.message||"An error occurred"}finally{f.value=!1}},I=t=>{$.onEdit&&$.onEdit(t)},s=t=>{$.onDelete&&$.onDelete(t)},n=t=>{c.value=t.id,k("select-bill",t.id),$.onSelect&&$.onSelect(t.id)};return A({fetchSellBills:p}),J(()=>{p()}),(t,E)=>(d(),r("div",G,[E[1]||(E[1]=l("h3",null,"Sell Bills",-1)),f.value?(d(),r("div",j,"Loading...")):b.value?(d(),r("div",Z,e(b.value),1)):u.value.length===0?(d(),r("div",K," No sell bills found ")):(d(),r("table",Q,[E[0]||(E[0]=l("thead",null,[l("tr",null,[l("th",null,"ID"),l("th",null,"Date"),l("th",null,"Broker"),l("th",null,"Notes"),l("th",null,"Actions")])],-1)),l("tbody",null,[(d(!0),r(O,null,L(u.value,C=>(d(),r("tr",{key:C.id,onClick:F=>n(C),class:H({selected:c.value===C.id})},[l("td",null,e(C.id),1),l("td",null,e(new Date(C.date_sell).toLocaleDateString()),1),l("td",null,e(C.broker_name||"N/A"),1),l("td",null,e(C.notes||"N/A"),1),l("td",null,[l("button",{onClick:q(F=>I(C),["stop"]),class:"edit-btn"},"Edit",8,ll),l("button",{onClick:q(F=>s(C.id),["stop"]),class:"delete-btn"},"Delete",8,el)])],10,X))),128))])]))]))}},tl=R(sl,[["__scopeId","data-v-d021a13c"]]),al={class:"sell-bill-form"},nl={key:0,class:"error"},ol={class:"form-group"},il=["value"],rl={class:"form-group"},dl={class:"form-group"},ul={class:"form-actions"},cl=["disabled"],vl={__name:"SellBillForm",props:{mode:{type:String,default:"add",validator:S=>["add","edit"].includes(S)},billData:{type:Object,default:()=>({id:null,id_broker:null,date_sell:new Date().toISOString().split("T")[0],notes:""})}},emits:["save","cancel"],setup(S,{emit:A}){const y=S,$=v(null),k=A,{callApi:N}=U(),u=v([]),f=v(!1),b=v(null),c=v({id:null,id_broker:null,date_sell:new Date().toISOString().split("T")[0],notes:""});x(()=>y.billData,s=>{if(s&&(c.value={...s},c.value.date_sell)){const n=new Date(c.value.date_sell);isNaN(n)||(c.value.date_sell=n.toISOString().split("T")[0])}},{immediate:!0});const p=async()=>{try{const s=await N({query:`
        SELECT id, name
        FROM clients
        WHERE is_broker = 1
        ORDER BY name ASC
      `,params:[]});s.success?u.value=s.data:b.value=s.error||"Failed to fetch brokers"}catch(s){b.value=s.message||"An error occurred"}},I=async()=>{f.value=!0,b.value=null;try{let s;y.mode==="add"?s=await N({query:`
          INSERT INTO sell_bill (id_broker, date_sell, notes,id_user)
          VALUES (?, ?, ?,?)
        `,params:[c.value.id_broker||null,c.value.date_sell,c.value.notes||"",$.value.id]}):s=await N({query:`
          UPDATE sell_bill
          SET id_broker = ?, date_sell = ?, notes = ?
          WHERE id = ?
        `,params:[c.value.id_broker||null,c.value.date_sell,c.value.notes||"",c.value.id]}),s.success?k("save",s.data):b.value=s.error||`Failed to ${y.mode} sell bill`}catch(s){b.value=s.message||"An error occurred"}finally{f.value=!1}};return J(()=>{const s=localStorage.getItem("user");s&&($.value=JSON.parse(s),p())}),(s,n)=>(d(),r("div",al,[l("h3",null,e(S.mode==="add"?"Add New":"Edit")+" Sell Bill",1),b.value?(d(),r("div",nl,e(b.value),1)):D("",!0),l("form",{onSubmit:q(I,["prevent"])},[l("div",ol,[n[5]||(n[5]=l("label",{for:"broker"},"Broker:",-1)),B(l("select",{id:"broker","onUpdate:modelValue":n[0]||(n[0]=t=>c.value.id_broker=t)},[n[4]||(n[4]=l("option",{value:""},"Select Broker",-1)),(d(!0),r(O,null,L(u.value,t=>(d(),r("option",{key:t.id,value:t.id},e(t.name),9,il))),128))],512),[[V,c.value.id_broker]])]),l("div",rl,[n[6]||(n[6]=l("label",{for:"date"},"Date:",-1)),B(l("input",{type:"date",id:"date","onUpdate:modelValue":n[1]||(n[1]=t=>c.value.date_sell=t),required:""},null,512),[[T,c.value.date_sell]])]),l("div",dl,[n[7]||(n[7]=l("label",{for:"notes"},"Notes:",-1)),B(l("textarea",{id:"notes","onUpdate:modelValue":n[2]||(n[2]=t=>c.value.notes=t)},null,512),[[T,c.value.notes]])]),l("div",ul,[l("button",{type:"button",onClick:n[3]||(n[3]=t=>s.$emit("cancel")),class:"cancel-btn"},"Cancel"),l("button",{type:"submit",class:"save-btn",disabled:f.value},e(f.value?"Saving...":S.mode==="add"?"Add":"Update"),9,cl)])],32)]))}},M=R(vl,[["__scopeId","data-v-9681ebac"]]),_l={class:"sell-bill-cars-table"},pl={key:0,class:"no-selection"},bl={key:1,class:"loading"},fl={key:2,class:"error"},ml={key:3,class:"no-data"},gl={key:4,class:"cars-table"},hl=["onClick"],yl={__name:"SellBillCarsTable",props:{sellBillId:{type:Number,default:null}},emits:["refresh"],setup(S,{expose:A,emit:y}){const $=S,k=y,{callApi:N}=U(),u=v([]),f=v(!1),b=v(null),c=async s=>{if(confirm("Are you sure you want to unassign this car from the sell bill?")){f.value=!0,b.value=null;try{const n=await N({query:`
        UPDATE cars_stock 
        SET id_sell = NULL, 
            id_client = NULL, 
            id_port_discharge = NULL, 
            freight = NULL 
        WHERE id = ?
      `,params:[s]});n.success?(await p($.sellBillId),k("refresh")):b.value=n.error||"Failed to unassign car"}catch(n){b.value=n.message||"An error occurred"}finally{f.value=!1}}},p=async s=>{if(!s){u.value=[];return}f.value=!0,b.value=null;try{const n=await N({query:`
        SELECT 
          cs.id,
          cs.vin,
          cs.notes,
          cs.date_sell,
          cs.price_cell,
          cs.freight,
          cs.date_loding,
          cs.date_send_documents,
          c.name as client_name,
          lp.loading_port,
          dp.discharge_port,
          bd.price_sell as buy_price,
          cn.car_name,
          clr.color
        FROM cars_stock cs
        LEFT JOIN clients c ON cs.id_client = c.id
        LEFT JOIN loading_ports lp ON cs.id_port_loading = lp.id
        LEFT JOIN discharge_ports dp ON cs.id_port_discharge = dp.id
        LEFT JOIN buy_details bd ON cs.id_buy_details = bd.id
        LEFT JOIN cars_names cn ON bd.id_car_name = cn.id
        LEFT JOIN colors clr ON bd.id_color = clr.id
        WHERE cs.id_sell = ?
        ORDER BY cs.id DESC
      `,params:[s]});n.success?u.value=n.data:b.value=n.error||"Failed to fetch cars"}catch(n){b.value=n.message||"An error occurred"}finally{f.value=!1}};x(()=>$.sellBillId,s=>{s?p(s):u.value=[]},{immediate:!0});const I=(s,n,t)=>{if(!s||!n)return"N/A";const E=parseFloat(s),C=parseFloat(n),F=t?parseFloat(t):0;return(E-C-F).toFixed(2)};return A({fetchCarsByBillId:p}),(s,n)=>(d(),r("div",_l,[n[1]||(n[1]=l("h3",null,"Cars in Selected Bill",-1)),$.sellBillId?f.value?(d(),r("div",bl,"Loading cars...")):b.value?(d(),r("div",fl,e(b.value),1)):u.value.length===0?(d(),r("div",ml," No cars found for this sell bill ")):(d(),r("table",gl,[n[0]||(n[0]=l("thead",null,[l("tr",null,[l("th",null,"ID"),l("th",null,"Car"),l("th",null,"Color"),l("th",null,"VIN"),l("th",null,"Client"),l("th",null,"Loading Port"),l("th",null,"Discharge Port"),l("th",null,"Buy Price"),l("th",null,"Sell Price"),l("th",null,"Freight"),l("th",null,"Profit"),l("th",null,"Notes"),l("th",null,"Actions")])],-1)),l("tbody",null,[(d(!0),r(O,null,L(u.value,t=>(d(),r("tr",{key:t.id},[l("td",null,e(t.id),1),l("td",null,e(t.car_name||"N/A"),1),l("td",null,e(t.color||"N/A"),1),l("td",null,e(t.vin||"N/A"),1),l("td",null,e(t.client_name||"N/A"),1),l("td",null,e(t.loading_port||"N/A"),1),l("td",null,e(t.discharge_port||"N/A"),1),l("td",null,"$"+e(t.buy_price||"N/A"),1),l("td",null,"$"+e(t.price_cell||"N/A"),1),l("td",null,"$"+e(t.freight||"0.00"),1),l("td",null,"$"+e(I(t.price_cell,t.buy_price,t.freight)),1),l("td",null,e(t.notes||"N/A"),1),l("td",null,[l("button",{onClick:E=>c(t.id),class:"unassign-btn"},"Unassign",8,hl)])]))),128))])])):(d(),r("div",pl," Please select a sell bill to view associated cars "))]))}},Nl=R(yl,[["__scopeId","data-v-4ffbed4e"]]),Cl={key:0,class:"car-assignment-form-overlay"},$l={class:"car-assignment-form"},kl={class:"form-header"},El={key:0,class:"error"},Sl={key:1,class:"car-details"},Il={class:"detail-item"},Fl={class:"value"},Al={class:"detail-item"},Bl={class:"value"},Dl={class:"detail-item"},Ol={class:"value"},Ll={class:"detail-item"},Tl={class:"value"},wl={class:"form-group"},Pl=["value"],Rl={class:"form-group"},Ul=["value"],Vl={class:"form-group"},Jl={class:"form-group"},ql={key:0,class:"profit-calculation"},xl={class:"value profit"},Ml={class:"form-actions"},Hl=["disabled"],Wl={__name:"CarAssignmentForm",props:{carId:{type:Number,default:null},sellBillId:{type:Number,default:null},visible:{type:Boolean,default:!1}},emits:["close","assign-success"],setup(S,{emit:A}){const y=S,$=A,{callApi:k}=U(),N=v(!1),u=v(null),f=v([]),b=v([]),c=v(null),p=v({id_client:null,id_port_discharge:null,price_cell:null,freight:null}),I=async()=>{try{const g=await k({query:`
        SELECT id, name
        FROM clients
        WHERE is_broker = 0
        ORDER BY name ASC
      `,params:[]});g.success?f.value=g.data:u.value=g.error||"Failed to fetch clients"}catch(g){u.value=g.message||"An error occurred"}},s=async()=>{try{const g=await k({query:`
        SELECT id, discharge_port
        FROM discharge_ports
        ORDER BY discharge_port ASC
      `,params:[]});g.success?b.value=g.data:u.value=g.error||"Failed to fetch discharge ports"}catch(g){u.value=g.message||"An error occurred"}},n=async()=>{if(y.carId)try{const g=await k({query:`
        SELECT 
          cs.id,
          cs.vin,
          cn.car_name,
          clr.color,
          bd.price_sell as buy_price
        FROM cars_stock cs
        LEFT JOIN buy_details bd ON cs.id_buy_details = bd.id
        LEFT JOIN cars_names cn ON bd.id_car_name = cn.id
        LEFT JOIN colors clr ON bd.id_color = clr.id
        WHERE cs.id = ?
      `,params:[y.carId]});g.success&&g.data.length>0?c.value=g.data[0]:u.value=g.error||"Failed to fetch car details"}catch(g){u.value=g.message||"An error occurred"}},t=async()=>{if(E()){N.value=!0,u.value=null;try{const g=await k({query:`
        UPDATE cars_stock 
        SET id_sell = ?,
            id_client = ?,
            id_port_discharge = ?,
            price_cell = ?,
            freight = ?
        WHERE id = ?
      `,params:[y.sellBillId,p.value.id_client,p.value.id_port_discharge,p.value.price_cell,p.value.freight||null,y.carId]});g.success?($("assign-success"),C()):u.value=g.error||"Failed to assign car"}catch(g){u.value=g.message||"An error occurred"}finally{N.value=!1}}},E=()=>p.value.id_client?p.value.id_port_discharge?p.value.price_cell?!0:(u.value="Please enter a sell price",!1):(u.value="Please select a discharge port",!1):(u.value="Please select a client",!1),C=()=>{p.value={id_client:null,id_port_discharge:null,price_cell:null,freight:null},u.value=null},F=()=>{var o;if(!((o=c.value)!=null&&o.buy_price)||!p.value.price_cell)return"N/A";const g=parseFloat(c.value.buy_price),a=parseFloat(p.value.price_cell),_=p.value.freight?parseFloat(p.value.freight):0;return(a-g-_).toFixed(2)};return J(()=>{I(),s(),y.carId&&n()}),(g,a)=>{var _;return S.visible?(d(),r("div",Cl,[l("div",$l,[l("div",kl,[a[6]||(a[6]=l("h3",null,"Assign Car to Sell Bill",-1)),l("button",{onClick:a[0]||(a[0]=o=>g.$emit("close")),class:"close-btn"},"Ã—")]),u.value?(d(),r("div",El,e(u.value),1)):D("",!0),c.value?(d(),r("div",Sl,[l("div",Il,[a[7]||(a[7]=l("span",{class:"label"},"Car:",-1)),l("span",Fl,e(c.value.car_name),1)]),l("div",Al,[a[8]||(a[8]=l("span",{class:"label"},"Color:",-1)),l("span",Bl,e(c.value.color),1)]),l("div",Dl,[a[9]||(a[9]=l("span",{class:"label"},"VIN:",-1)),l("span",Ol,e(c.value.vin),1)]),l("div",Ll,[a[10]||(a[10]=l("span",{class:"label"},"Buy Price:",-1)),l("span",Tl,"$"+e(c.value.buy_price),1)])])):D("",!0),l("form",{onSubmit:q(t,["prevent"])},[l("div",wl,[a[12]||(a[12]=l("label",{for:"client"},[P("Client: "),l("span",{class:"required"},"*")],-1)),B(l("select",{id:"client","onUpdate:modelValue":a[1]||(a[1]=o=>p.value.id_client=o),required:""},[a[11]||(a[11]=l("option",{value:""},"Select Client",-1)),(d(!0),r(O,null,L(f.value,o=>(d(),r("option",{key:o.id,value:o.id},e(o.name),9,Pl))),128))],512),[[V,p.value.id_client]])]),l("div",Rl,[a[14]||(a[14]=l("label",{for:"discharge-port"},[P("Discharge Port: "),l("span",{class:"required"},"*")],-1)),B(l("select",{id:"discharge-port","onUpdate:modelValue":a[2]||(a[2]=o=>p.value.id_port_discharge=o),required:""},[a[13]||(a[13]=l("option",{value:""},"Select Discharge Port",-1)),(d(!0),r(O,null,L(b.value,o=>(d(),r("option",{key:o.id,value:o.id},e(o.discharge_port),9,Ul))),128))],512),[[V,p.value.id_port_discharge]])]),l("div",Vl,[a[15]||(a[15]=l("label",{for:"sell-price"},[P("Sell Price: "),l("span",{class:"required"},"*")],-1)),B(l("input",{type:"number",id:"sell-price","onUpdate:modelValue":a[3]||(a[3]=o=>p.value.price_cell=o),step:"0.01",min:"0",required:""},null,512),[[T,p.value.price_cell]])]),l("div",Jl,[a[16]||(a[16]=l("label",{for:"freight"},"Freight:",-1)),B(l("input",{type:"number",id:"freight","onUpdate:modelValue":a[4]||(a[4]=o=>p.value.freight=o),step:"0.01",min:"0"},null,512),[[T,p.value.freight]])]),p.value.price_cell&&((_=c.value)!=null&&_.buy_price)?(d(),r("div",ql,[a[17]||(a[17]=l("span",{class:"label"},"Estimated Profit:",-1)),l("span",xl,"$"+e(F()),1)])):D("",!0),l("div",Ml,[l("button",{type:"button",onClick:a[5]||(a[5]=o=>g.$emit("close")),class:"cancel-btn"},"Cancel"),l("button",{type:"submit",class:"assign-btn",disabled:N.value},e(N.value?"Assigning...":"Assign Car"),9,Hl)])],32)])])):D("",!0)}}},Yl=R(Wl,[["__scopeId","data-v-22526b1c"]]),zl={class:"unassigned-cars-table"},Gl={class:"filters"},jl={class:"filter-row"},Zl={class:"filter-group"},Kl={class:"filter-group"},Ql={class:"filter-group"},Xl={class:"filter-group"},le={key:0,class:"loading"},ee={key:1,class:"error"},se={key:2,class:"no-data"},te={key:3,class:"cars-table"},ae=["onClick","disabled"],ne={__name:"UnassignedCarsTable",emits:["refresh","assign-car"],setup(S,{expose:A,emit:y}){const $=y,{callApi:k}=U(),N=v([]),u=v([]),f=v(!0),b=v(null),c=v(null),p=v(!1),I=v(null),s=v({carName:"",color:"",vin:"",loadingPort:""}),n=async()=>{f.value=!0,b.value=null;try{const _=await k({query:`
        SELECT 
          cs.id,
          cs.vin,
          cs.notes,
          cs.price_cell,
          cs.freight,
          cs.date_loding,
          cs.path_documents,
          lp.loading_port,
          bd.price_sell as buy_price,
          cn.car_name,
          clr.color
        FROM cars_stock cs
        LEFT JOIN loading_ports lp ON cs.id_port_loading = lp.id
        LEFT JOIN buy_details bd ON cs.id_buy_details = bd.id
        LEFT JOIN cars_names cn ON bd.id_car_name = cn.id
        LEFT JOIN colors clr ON bd.id_color = clr.id
        WHERE cs.id_sell IS NULL
        AND cs.hidden = 0
        ORDER BY cs.id DESC
      `,params:[]});_.success?(u.value=_.data,t()):b.value=_.error||"Failed to fetch unassigned cars"}catch(_){b.value=_.message||"An error occurred"}finally{f.value=!1}},t=()=>{N.value=u.value.filter(_=>{const o=!s.value.carName||_.car_name&&_.car_name.toLowerCase().includes(s.value.carName.toLowerCase()),m=!s.value.color||_.color&&_.color.toLowerCase().includes(s.value.color.toLowerCase()),i=!s.value.vin||_.vin&&_.vin.toLowerCase().includes(s.value.vin.toLowerCase()),h=!s.value.loadingPort||_.loading_port&&_.loading_port.toLowerCase().includes(s.value.loadingPort.toLowerCase());return o&&m&&i&&h})},E=()=>{s.value={carName:"",color:"",vin:"",loadingPort:""},t()},C=()=>{t()},F=_=>{if(!c.value){alert("Please select a sell bill first");return}I.value=_,p.value=!0},g=()=>{p.value=!1,n(),$("refresh")};return A({fetchUnassignedCars:n,setSellBillId:_=>{c.value=_}}),J(()=>{n()}),(_,o)=>(d(),r("div",zl,[o[10]||(o[10]=l("h3",null,"Unassigned Cars",-1)),l("div",Gl,[l("div",jl,[l("div",Zl,[o[5]||(o[5]=l("label",{for:"car-name-filter"},"Car Name:",-1)),B(l("input",{id:"car-name-filter","onUpdate:modelValue":o[0]||(o[0]=m=>s.value.carName=m),onInput:C,placeholder:"Filter by car name"},null,544),[[T,s.value.carName]])]),l("div",Kl,[o[6]||(o[6]=l("label",{for:"color-filter"},"Color:",-1)),B(l("input",{id:"color-filter","onUpdate:modelValue":o[1]||(o[1]=m=>s.value.color=m),onInput:C,placeholder:"Filter by color"},null,544),[[T,s.value.color]])]),l("div",Ql,[o[7]||(o[7]=l("label",{for:"vin-filter"},"VIN:",-1)),B(l("input",{id:"vin-filter","onUpdate:modelValue":o[2]||(o[2]=m=>s.value.vin=m),onInput:C,placeholder:"Filter by VIN"},null,544),[[T,s.value.vin]])]),l("div",Xl,[o[8]||(o[8]=l("label",{for:"loading-port-filter"},"Loading Port:",-1)),B(l("input",{id:"loading-port-filter","onUpdate:modelValue":o[3]||(o[3]=m=>s.value.loadingPort=m),onInput:C,placeholder:"Filter by loading port"},null,544),[[T,s.value.loadingPort]])]),l("button",{onClick:E,class:"reset-btn"},"Reset Filters")])]),f.value?(d(),r("div",le,"Loading cars...")):b.value?(d(),r("div",ee,e(b.value),1)):N.value.length===0?(d(),r("div",se," No unassigned cars found matching your filters ")):(d(),r("table",te,[o[9]||(o[9]=l("thead",null,[l("tr",null,[l("th",null,"ID"),l("th",null,"Car"),l("th",null,"Color"),l("th",null,"VIN"),l("th",null,"Loading Port"),l("th",null,"Buy Price"),l("th",null,"Notes"),l("th",null,"Actions")])],-1)),l("tbody",null,[(d(!0),r(O,null,L(N.value,m=>(d(),r("tr",{key:m.id},[l("td",null,e(m.id),1),l("td",null,e(m.car_name||"N/A"),1),l("td",null,e(m.color||"N/A"),1),l("td",null,e(m.vin||"N/A"),1),l("td",null,e(m.loading_port||"N/A"),1),l("td",null,"$"+e(m.buy_price||"N/A"),1),l("td",null,e(m.notes||"N/A"),1),l("td",null,[l("button",{onClick:i=>F(m.id),class:"assign-btn",disabled:!c.value}," Assign to Bill ",8,ae)])]))),128))])])),w(Yl,{visible:p.value,carId:I.value,sellBillId:c.value,onClose:o[4]||(o[4]=m=>p.value=!1),onAssignSuccess:g},null,8,["visible","carId","sellBillId"])]))}},oe=R(ne,[["__scopeId","data-v-60037dab"]]),ie=""+new URL("logo.Dz9W2yBM.png",import.meta.url).href,re={key:0,class:"print-overlay"},de={class:"print-container"},ue={key:0,class:"loading"},ce={key:1,class:"error"},ve={key:2,class:"bill-document"},_e={class:"bill-header"},pe={class:"company-info"},be=["src"],fe={class:"company-details"},me={class:"bill-info"},ge={class:"broker-info"},he={key:0},ye={class:"cars-section"},Ne={class:"cars-table"},Ce={colspan:"2",class:"grand-total-value"},$e={key:0,class:"notes-section"},ke={key:1,class:"document-dialog"},Ee={class:"dialog-content"},Se={class:"form-group"},Ie=["value"],Fe={class:"form-group"},Ae=["value"],Be={class:"dialog-actions"},De={__name:"SellBillPrint",props:{billId:{type:Number,required:!0},visible:{type:Boolean,default:!1}},emits:["close"],setup(S,{emit:A}){const y=S,$=A,{callApi:k}=U(),N=v(!0),u=v(null),f=v(null),b=v([]),c=v({name:"GROUP MERHAB LIMITED",address:"GUANGZHOU, CHINA",phone:"+86 123 456 7890",email:"merhab@merhab.com",logo:ie}),p=async()=>{if(y.billId){N.value=!0,u.value=null;try{const m=await k({query:`
        SELECT 
          sb.id,
          sb.date_sell,
          sb.notes,
          c.name as broker_name,
          c.address as broker_address
        FROM sell_bill sb
        LEFT JOIN clients c ON sb.id_broker = c.id
        WHERE sb.id = ?
      `,params:[y.billId]});if(!m.success){u.value=m.error||"Failed to fetch bill data";return}if(m.data.length===0){u.value="Bill not found";return}f.value=m.data[0];const i=await k({query:`
        SELECT 
          cs.id,
          cs.vin,
          cs.notes,
          cs.price_cell,
          cs.freight,
          c.name as client_name,
          lp.loading_port,
          dp.discharge_port,
          bd.price_sell as buy_price,
          cn.car_name,
          clr.color
        FROM cars_stock cs
        LEFT JOIN clients c ON cs.id_client = c.id
        LEFT JOIN loading_ports lp ON cs.id_port_loading = lp.id
        LEFT JOIN discharge_ports dp ON cs.id_port_discharge = dp.id
        LEFT JOIN buy_details bd ON cs.id_buy_details = bd.id
        LEFT JOIN cars_names cn ON bd.id_car_name = cn.id
        LEFT JOIN colors clr ON bd.id_color = clr.id
        WHERE cs.id_sell = ?
        ORDER BY cs.id
      `,params:[y.billId]});if(!i.success){u.value=i.error||"Failed to fetch cars data";return}b.value=i.data}catch(m){u.value=m.message||"An error occurred"}finally{N.value=!1}}},I=()=>{let m=0,i=0;return b.value.forEach(h=>{h.price_cell&&(m+=parseFloat(h.price_cell)),h.freight&&(i+=parseFloat(h.freight))}),{totalSellPrice:m.toFixed(2),totalFreight:i.toFixed(2),grandTotal:(m+i).toFixed(2)}},s=m=>m?new Date(m).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A",n=()=>{window.print()},t=()=>{$("close")};x(()=>[y.billId,y.visible],([m,i])=>{i&&m&&p()},{immediate:!0});const E=v(!1),C=v("invoice"),F=v("usd"),g=[{value:"proforma",label:"Proforma Invoice"},{value:"invoice",label:"Invoice"},{value:"contract",label:"Sell Contract"}],a=[{value:"usd",label:"USD"},{value:"dza",label:"DZA"}],_=()=>{E.value=!0},o=()=>{E.value=!1,window.print()};return(m,i)=>(d(),r(O,null,[S.visible?(d(),r("div",re,[l("div",de,[l("div",{class:"print-controls no-print"},[l("button",{onClick:n,class:"print-btn"},"Print"),l("button",{onClick:t,class:"close-btn"},"Close")]),N.value?(d(),r("div",ue,"Loading bill data...")):u.value?(d(),r("div",ce,e(u.value),1)):f.value?(d(),r("div",ve,[l("div",_e,[l("div",pe,[l("img",{src:c.value.logo,alt:"Company Logo",class:"company-logo"},null,8,be),l("div",fe,[l("h2",null,e(c.value.name),1),l("p",null,e(c.value.address),1),l("p",null,e(c.value.phone)+" | "+e(c.value.email),1)])]),l("div",me,[i[5]||(i[5]=l("h1",null,"SELL BILL",-1)),l("p",null,[i[3]||(i[3]=l("strong",null,"Bill #:",-1)),P(" "+e(f.value.id),1)]),l("p",null,[i[4]||(i[4]=l("strong",null,"Date:",-1)),P(" "+e(s(f.value.date_sell)),1)])])]),l("div",ge,[i[8]||(i[8]=l("h3",null,"Broker Information",-1)),l("p",null,[i[6]||(i[6]=l("strong",null,"Name:",-1)),P(" "+e(f.value.broker_name||"N/A"),1)]),f.value.broker_address?(d(),r("p",he,[i[7]||(i[7]=l("strong",null,"Address:",-1)),P(" "+e(f.value.broker_address),1)])):D("",!0)]),l("div",ye,[i[12]||(i[12]=l("h3",null,"Cars",-1)),l("table",Ne,[i[11]||(i[11]=l("thead",null,[l("tr",null,[l("th",null,"#"),l("th",null,"Car"),l("th",null,"Color"),l("th",null,"VIN"),l("th",null,"Client"),l("th",null,"Loading Port"),l("th",null,"Discharge Port"),l("th",null,"Sell Price"),l("th",null,"Freight")])],-1)),l("tbody",null,[(d(!0),r(O,null,L(b.value,(h,W)=>(d(),r("tr",{key:h.id},[l("td",null,e(W+1),1),l("td",null,e(h.car_name||"N/A"),1),l("td",null,e(h.color||"N/A"),1),l("td",null,e(h.vin||"N/A"),1),l("td",null,e(h.client_name||"N/A"),1),l("td",null,e(h.loading_port||"N/A"),1),l("td",null,e(h.discharge_port||"N/A"),1),l("td",null,"$"+e(h.price_cell||"0.00"),1),l("td",null,"$"+e(h.freight||"0.00"),1)]))),128))]),l("tfoot",null,[l("tr",null,[i[9]||(i[9]=l("td",{colspan:"7",class:"total-label"},"Totals:",-1)),l("td",null,"$"+e(I().totalSellPrice),1),l("td",null,"$"+e(I().totalFreight),1)]),l("tr",null,[i[10]||(i[10]=l("td",{colspan:"7",class:"grand-total-label"},"Grand Total:",-1)),l("td",Ce,"$"+e(I().grandTotal),1)])])])]),f.value.notes?(d(),r("div",$e,[i[13]||(i[13]=l("h3",null,"Notes",-1)),l("p",null,e(f.value.notes),1)])):D("",!0),i[14]||(i[14]=Y('<div class="bill-footer" data-v-ea653a55><div class="signatures" data-v-ea653a55><div class="signature-box" data-v-ea653a55><p data-v-ea653a55>Authorized Signature</p><div class="signature-line" data-v-ea653a55></div></div><div class="signature-box" data-v-ea653a55><p data-v-ea653a55>Client Signature</p><div class="signature-line" data-v-ea653a55></div></div></div><p class="thank-you" data-v-ea653a55>Thank you for your business!</p></div>',1))])):D("",!0)])])):D("",!0),E.value?(d(),r("div",ke,[l("div",Ee,[i[17]||(i[17]=l("h3",null,"Select Document Type",-1)),l("div",Se,[i[15]||(i[15]=l("label",null,"Document Type:",-1)),B(l("select",{"onUpdate:modelValue":i[0]||(i[0]=h=>C.value=h)},[(d(),r(O,null,L(g,h=>l("option",{key:h.value,value:h.value},e(h.label),9,Ie)),64))],512),[[V,C.value]])]),l("div",Fe,[i[16]||(i[16]=l("label",null,"Currency:",-1)),B(l("select",{"onUpdate:modelValue":i[1]||(i[1]=h=>F.value=h)},[(d(),r(O,null,L(a,h=>l("option",{key:h.value,value:h.value},e(h.label),9,Ae)),64))],512),[[V,F.value]])]),l("div",Be,[l("button",{onClick:o},"Print"),l("button",{onClick:i[2]||(i[2]=h=>E.value=!1)},"Cancel")])])])):D("",!0),l("button",{onClick:_,class:"print-button"}," Print Document "),l("div",{class:H(["print-content",C.value])},null,2)],64))}},Oe=R(De,[["__scopeId","data-v-ea653a55"]]),Le={class:"sell-bills-view"},Te={class:"header"},we={class:"header-actions"},Pe=["disabled"],Re={class:"content"},Ue={key:0,class:"dialog-overlay"},Ve={class:"dialog"},Je={key:1,class:"dialog-overlay"},qe={class:"dialog"},xe={__name:"SellBillsView",setup(S){const{callApi:A}=U(),y=v(!1),$=v(!1),k=v(null),N=v(null),u=v(null),f=v(null),b=v(null),c=v(null),p=z(()=>{var a;return((a=c.value)==null?void 0:a.role_id)===1});J(()=>{const a=localStorage.getItem("user");a&&(c.value=JSON.parse(a))});const I=a=>{k.value=a,f.value&&f.value.setSellBillId(a)},s=()=>{N.value={id_broker:null,date_sell:new Date().toISOString().split("T")[0],notes:""},y.value=!0},n=a=>{N.value={...a},$.value=!0},t=async a=>{if(!p.value){alert("Only admins can delete sell bills.");return}if(confirm("Are you sure you want to delete this sell bill?"))try{const _=await A({query:"DELETE FROM sell_bill WHERE id = ?",params:[a]});_.success?u.value&&u.value.fetchSellBills():(console.error("Failed to delete sell bill:",_.error),alert("Failed to delete sell bill: "+_.error))}catch(_){console.error("Error deleting sell bill:",_),alert("Error deleting sell bill: "+_.message)}},E=()=>{y.value=!1,$.value=!1,u.value&&u.value.fetchSellBills()},C=async()=>{u.value&&await u.value.fetchSellBills(),f.value&&await f.value.fetchUnassignedCars(),k.value&&b.value&&await b.value.fetchCarsByBillId(k.value)},F=v(!1),g=()=>{if(!k.value){alert("Please select a sell bill to print");return}F.value=!0};return(a,_)=>(d(),r("div",Le,[l("div",Te,[_[3]||(_[3]=l("h2",null,"Sell Bills Management",-1)),l("div",we,[l("button",{onClick:g,class:"print-btn",disabled:!k.value},"Print Bill",8,Pe),l("button",{onClick:s,class:"add-btn"},"Add Sell Bill")])]),l("div",Re,[w(tl,{ref_key:"sellBillsTableRef",ref:u,onEdit:n,onDelete:t,onSelect:I,onSelectBill:I,isAdmin:p.value},null,8,["isAdmin"]),w(Nl,{ref_key:"sellBillCarsTableRef",ref:b,sellBillId:k.value,onRefresh:C},null,8,["sellBillId"]),w(oe,{ref_key:"unassignedCarsTableRef",ref:f,onRefresh:C},null,512)]),y.value?(d(),r("div",Ue,[l("div",Ve,[w(M,{mode:"add",billData:N.value,onSave:E,onCancel:_[0]||(_[0]=o=>y.value=!1)},null,8,["billData"])])])):D("",!0),$.value?(d(),r("div",Je,[l("div",qe,[w(M,{mode:"edit",billData:N.value,onSave:E,onCancel:_[1]||(_[1]=o=>$.value=!1)},null,8,["billData"])])])):D("",!0),w(Oe,{billId:k.value,visible:F.value,onClose:_[2]||(_[2]=o=>F.value=!1)},null,8,["billId","visible"])]))}},He=R(xe,[["__scopeId","data-v-b95a6a5c"]]);export{He as default};
//# sourceMappingURL=SellBillsView.BlFgE38q.js.map

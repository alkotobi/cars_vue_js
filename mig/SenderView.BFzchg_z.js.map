{"version":3,"file":"SenderView.BFzchg_z.js","sources":["../src/views/SenderView.vue"],"sourcesContent":["<script setup>\nimport { ref, computed, onMounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useApi } from '../composables/useApi'\n\nconst router = useRouter()\nconst { callApi, error } = useApi()\nconst user = ref(null)\nconst transfers = ref([])\nconst showEditDialog = ref(false)\nconst showAddDialog = ref(false)\nconst selectedTransfer = ref(null)\nconst editForm = ref({\n  amount_sending_da: '',\n  rate: '',\n  notes: ''\n})\n\nconst newTransfer = ref({\n  amount_sending_da: '',\n  rate: '',\n  notes: ''\n})\n\nconst isAdmin = computed(() => user.value?.role_id === 1)\n\nconst fetchTransfers = async () => {\n  const result = await callApi({\n    query: `\n      SELECT t.* \n      FROM transfers t\n      WHERE t.id_user_do_transfer = ? OR t.id_user_receive_transfer = ?\n      ORDER BY t.date_do_transfer DESC\n    `,\n    params: [user.value.id, user.value.id]\n  })\n  if (result.success) {\n    transfers.value = result.data\n  }\n}\n\nconst calculateUSD = (amount, rate) => {\n  return (amount / rate).toFixed(2)\n}\n\nconst openEditDialog = (transfer) => {\n  selectedTransfer.value = transfer\n  editForm.value = {\n    amount_sending_da: transfer.amount_sending_da,\n    rate: transfer.rate,\n    notes: transfer.notes || ''\n  }\n  showEditDialog.value = true\n}\n\nconst updateTransfer = async () => {\n  if (!editForm.value.amount_sending_da || !editForm.value.rate) {\n    error.value = 'Please fill all required fields'\n    return\n  }\n\n  const amount_received_usd = (editForm.value.amount_sending_da / editForm.value.rate).toFixed(2)\n  \n  const result = await callApi({\n    query: `\n      UPDATE transfers \n      SET amount_sending_da = ?, \n          rate = ?,\n          amount_received_usd = ?,\n          notes = ?\n      WHERE id = ? ${!isAdmin.value ? 'AND date_receive IS NULL' : ''}\n    `,\n    params: [\n      editForm.value.amount_sending_da,\n      editForm.value.rate,\n      amount_received_usd,\n      editForm.value.notes || null,\n      selectedTransfer.value.id\n    ]\n  })\n\n  if (result.success) {\n    showEditDialog.value = false\n    selectedTransfer.value = null\n    fetchTransfers()\n  }\n}\n\nconst deleteTransfer = async (transfer) => {\n  if (!isAdmin.value) {\n    error.value = 'Only admin can delete transfers'\n    return\n  }\n\n  if (!confirm('Are you sure you want to delete this transfer?')) return\n\n  const result = await callApi({\n    query: 'DELETE FROM transfers WHERE id = ?',\n    params: [transfer.id]\n  })\n\n  if (result.success) {\n    fetchTransfers()\n  }\n}\n\nconst createTransfer = async () => {\n  if (!newTransfer.value.amount_sending_da || !newTransfer.value.rate) {\n    error.value = 'Please fill all required fields'\n    return\n  }\n\n  const amount_received_usd = (newTransfer.value.amount_sending_da / newTransfer.value.rate).toFixed(2)\n  \n  const result = await callApi({\n    query: `\n      INSERT INTO transfers (\n        id_user_do_transfer, date_do_transfer, amount_sending_da, \n        rate, amount_received_usd, notes\n      ) VALUES (?, NOW(), ?, ?, ?, ?)\n    `,\n    params: [\n      user.value.id,\n      newTransfer.value.amount_sending_da,\n      newTransfer.value.rate,\n      amount_received_usd,\n      newTransfer.value.notes || null\n    ]\n  })\n\n  if (result.success) {\n    showAddDialog.value = false\n    newTransfer.value = { amount_sending_da: '', rate: '', notes: '' }\n    fetchTransfers()\n  }\n}\n\nonMounted(() => {\n  const userStr = localStorage.getItem('user')\n  if (userStr) {\n    user.value = JSON.parse(userStr)\n    fetchTransfers()\n  }\n})\n</script>\n\n<template>\n  <div class=\"sender-view\">\n    <div class=\"header\">\n      <h1>My Transfers</h1>\n      <div class=\"header-buttons\">\n        <button @click=\"showAddDialog = true\" class=\"btn create-btn\">\n          New Transfer\n        </button>\n        <button @click=\"router.push('/transfers')\" class=\"back-btn\">← Return to Transfers</button>\n      </div>\n    </div>\n\n    <!-- Transfers Table -->\n    <div class=\"transfers-table\">\n      <table>\n        <thead>\n          <tr>\n            <th>Date Sent</th>\n            <th>Amount (DA)</th>\n            <th>Rate</th>\n            <th>USD Value</th>\n            <th>Notes</th>\n            <th>Status</th>\n            <th>Actions</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for=\"transfer in transfers\" :key=\"transfer.id\">\n            <td>{{ new Date(transfer.date_do_transfer).toLocaleString() }}</td>\n            <td>{{ transfer.amount_sending_da }}</td>\n            <td>{{ transfer.rate }}</td>\n            <td>${{ calculateUSD(transfer.amount_sending_da, transfer.rate) }}</td>\n            <td>{{ transfer.notes || '-' }}</td>\n            <td class=\"status-cell\">\n              <span v-if=\"transfer.date_receive\" class=\"status received\">✅</span>\n              <span v-else class=\"status pending\">⏳</span>\n            </td>\n            <td>\n              <button \n                v-if=\"isAdmin || !transfer.date_receive\"\n                @click=\"openEditDialog(transfer)\" \n                class=\"btn update-btn\"\n              >\n                Edit\n              </button>\n              <button \n                v-if=\"isAdmin\"\n                @click=\"deleteTransfer(transfer)\" \n                class=\"btn delete-btn\"\n              >\n                Delete\n              </button>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <!-- Edit Dialog -->\n    <div v-if=\"showEditDialog\" class=\"dialog-overlay\">\n      <div class=\"dialog\">\n        <h2>Edit Transfer</h2>\n        <div class=\"form-group\">\n          <label>Amount (DA):</label>\n          <input \n            type=\"number\" \n            v-model=\"editForm.amount_sending_da\"\n            class=\"input-field\"\n          />\n        </div>\n        <div class=\"form-group\">\n          <label>Rate:</label>\n          <input \n            type=\"number\" \n            v-model=\"editForm.rate\"\n            class=\"input-field\"\n          />\n        </div>\n        <div class=\"form-group\">\n          <label>Notes:</label>\n          <textarea \n            v-model=\"editForm.notes\" \n            class=\"input-field\"\n            placeholder=\"Optional notes\"\n          ></textarea>\n        </div>\n        <div class=\"dialog-actions\">\n          <button @click=\"updateTransfer\" class=\"btn update-btn\">Save</button>\n          <button @click=\"showEditDialog = false\" class=\"btn cancel-btn\">Cancel</button>\n        </div>\n      </div>\n    </div>\n    <!-- Add Dialog -->\n    <div v-if=\"showAddDialog\" class=\"dialog-overlay\">\n      <div class=\"dialog\">\n        <h2>New Transfer</h2>\n        <div class=\"form-group\">\n          <label>Amount (DA):</label>\n          <input \n            type=\"number\" \n            v-model=\"newTransfer.amount_sending_da\"\n            class=\"input-field\"\n            placeholder=\"Enter amount in DA\"\n          />\n        </div>\n        <div class=\"form-group\">\n          <label>Rate:</label>\n          <input \n            type=\"number\" \n            v-model=\"newTransfer.rate\"\n            class=\"input-field\"\n            placeholder=\"Enter exchange rate\"\n          />\n        </div>\n        <div class=\"form-group\">\n          <label>Notes:</label>\n          <textarea \n            v-model=\"newTransfer.notes\" \n            class=\"input-field\"\n            placeholder=\"Optional notes\"\n          ></textarea>\n        </div>\n        <div class=\"dialog-actions\">\n          <button @click=\"createTransfer\" class=\"btn create-btn\">Create</button>\n          <button @click=\"showAddDialog = false\" class=\"btn cancel-btn\">Cancel</button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.sender-view {\n  width: 80vw;\n \n}\n\n.header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 30px;\n}\n\n.back-btn {\n  padding: 8px 16px;\n  background-color: #4b5563;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n}\n\n.transfers-table {\n  overflow-x: auto;\n}\n\ntable {\n  width: 100%;\n  border-collapse: collapse;\n  margin-top: 20px;\n  table-layout: fixed;\n}\n\nth, td {\n  padding: 12px;\n  text-align: left;\n  border-bottom: 1px solid #ddd;\n  word-wrap: break-word;\n  overflow-wrap: break-word;\n}\n\n/* Column widths */\nth:nth-child(1) { width: 15%; } /* Date */\nth:nth-child(2) { width: 12%; } /* Amount DA */\nth:nth-child(3) { width: 10%; } /* Rate */\nth:nth-child(4) { width: 12%; } /* USD Value */\nth:nth-child(5) { width: 25%; } /* Notes - wider column */\nth:nth-child(6) { width: 12%; } /* Status */\nth:nth-child(7) { width: 14%; } /* Actions */\n\n/* Notes cell specific styling */\ntd:nth-child(5) {\n  white-space: pre-wrap;\n  min-width: 200px;\n}\n\nth {\n  background-color: #f8f9fa;\n  font-weight: 600;\n}\n\n.status-cell {\n  text-align: center;\n}\n\n.status {\n  font-size: 1.2em;\n}\n\n.received {\n  color: #4CAF50;\n}\n\n.pending {\n  color: #FFA500;\n}\n\n.edit-input {\n  width: 100px;\n  padding: 4px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n}\n\n.btn {\n  padding: 6px 12px;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  margin-right: 8px;\n}\n\n.update-btn {\n  background-color: #2196F3;\n  color: white;\n}\n\n.delete-btn {\n  background-color: #f44336;\n  color: white;\n}\n\n.btn:hover {\n  opacity: 0.9;\n}\n\n.dialog-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.dialog {\n  background-color: white;\n  padding: 20px;\n  border-radius: 8px;\n  min-width: 300px;\n}\n\n.form-group {\n  margin-bottom: 15px;\n}\n\n.form-group label {\n  display: block;\n  margin-bottom: 5px;\n  color: #4b5563;\n}\n\n.input-field {\n  width: 100%;\n  padding: 8px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n}\n\n.dialog-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 10px;\n  margin-top: 20px;\n}\n\n.cancel-btn {\n  background-color: #6b7280;\n  color: white;\n}\n.header-buttons {\n  display: flex;\n  gap: 10px;\n}\n\n.create-btn {\n  background-color: #4CAF50;\n  color: white;\n}\n\ntextarea.input-field {\n  min-height: 100px;\n  resize: vertical;\n}\n</style>"],"names":["router","useRouter","callApi","error","useApi","user","ref","transfers","showEditDialog","showAddDialog","selectedTransfer","editForm","newTransfer","isAdmin","computed","_a","fetchTransfers","result","calculateUSD","amount","rate","openEditDialog","transfer","updateTransfer","amount_received_usd","deleteTransfer","createTransfer","onMounted","userStr"],"mappings":"yrBAKA,MAAMA,EAASC,EAAS,EAClB,CAAE,QAAAC,EAAS,MAAAC,CAAK,EAAKC,EAAM,EAC3BC,EAAOC,EAAI,IAAI,EACfC,EAAYD,EAAI,CAAE,CAAA,EAClBE,EAAiBF,EAAI,EAAK,EAC1BG,EAAgBH,EAAI,EAAK,EACzBI,EAAmBJ,EAAI,IAAI,EAC3BK,EAAWL,EAAI,CACnB,kBAAmB,GACnB,KAAM,GACN,MAAO,EACT,CAAC,EAEKM,EAAcN,EAAI,CACtB,kBAAmB,GACnB,KAAM,GACN,MAAO,EACT,CAAC,EAEKO,EAAUC,EAAS,IAAA,OAAM,QAAAC,EAAAV,EAAK,QAAL,YAAAU,EAAY,WAAY,EAAC,EAElDC,EAAiB,SAAY,CACjC,MAAMC,EAAS,MAAMf,EAAQ,CAC3B,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA,MAMP,OAAQ,CAACG,EAAK,MAAM,GAAIA,EAAK,MAAM,EAAE,CACtC,CAAA,EACGY,EAAO,UACTV,EAAU,MAAQU,EAAO,KAE7B,EAEMC,EAAe,CAACC,EAAQC,KACpBD,EAASC,GAAM,QAAQ,CAAC,EAG5BC,EAAkBC,GAAa,CACnCZ,EAAiB,MAAQY,EACzBX,EAAS,MAAQ,CACf,kBAAmBW,EAAS,kBAC5B,KAAMA,EAAS,KACf,MAAOA,EAAS,OAAS,EAC7B,EACEd,EAAe,MAAQ,EACzB,EAEMe,EAAiB,SAAY,CACjC,GAAI,CAACZ,EAAS,MAAM,mBAAqB,CAACA,EAAS,MAAM,KAAM,CAC7DR,EAAM,MAAQ,kCACd,MACJ,CAEE,MAAMqB,GAAuBb,EAAS,MAAM,kBAAoBA,EAAS,MAAM,MAAM,QAAQ,CAAC,GAE/E,MAAMT,EAAQ,CAC3B,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAMWW,EAAQ,MAAqC,GAA7B,0BAA+B;AAAA,MAEjE,OAAQ,CACNF,EAAS,MAAM,kBACfA,EAAS,MAAM,KACfa,EACAb,EAAS,MAAM,OAAS,KACxBD,EAAiB,MAAM,EAC7B,CACG,CAAA,GAEU,UACTF,EAAe,MAAQ,GACvBE,EAAiB,MAAQ,KACzBM,EAAc,EAElB,EAEMS,EAAiB,MAAOH,GAAa,CACzC,GAAI,CAACT,EAAQ,MAAO,CAClBV,EAAM,MAAQ,kCACd,MACJ,CAEE,GAAI,CAAC,QAAQ,gDAAgD,EAAG,QAEjD,MAAMD,EAAQ,CAC3B,MAAO,qCACP,OAAQ,CAACoB,EAAS,EAAE,CACrB,CAAA,GAEU,SACTN,EAAc,CAElB,EAEMU,EAAiB,SAAY,CACjC,GAAI,CAACd,EAAY,MAAM,mBAAqB,CAACA,EAAY,MAAM,KAAM,CACnET,EAAM,MAAQ,kCACd,MACJ,CAEE,MAAMqB,GAAuBZ,EAAY,MAAM,kBAAoBA,EAAY,MAAM,MAAM,QAAQ,CAAC,GAErF,MAAMV,EAAQ,CAC3B,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA,MAMP,OAAQ,CACNG,EAAK,MAAM,GACXO,EAAY,MAAM,kBAClBA,EAAY,MAAM,KAClBY,EACAZ,EAAY,MAAM,OAAS,IACjC,CACG,CAAA,GAEU,UACTH,EAAc,MAAQ,GACtBG,EAAY,MAAQ,CAAE,kBAAmB,GAAI,KAAM,GAAI,MAAO,EAAE,EAChEI,EAAc,EAElB,EAEA,OAAAW,EAAU,IAAM,CACd,MAAMC,EAAU,aAAa,QAAQ,MAAM,EACvCA,IACFvB,EAAK,MAAQ,KAAK,MAAMuB,CAAO,EAC/BZ,EAAc,EAElB,CAAC"}
import{_ as T,u as f,r as i,o as R,c as r,a as e,b as S,F as k,d as w,w as o,v as u,g as v,p as C,t as a}from"./index.CbkLKmc7.js";const A={class:"transfers-list-view"},L={class:"transfers-table"},N={class:"action-buttons"},U=["onClick"],V=["onClick"],F={key:0,class:"dialog-overlay"},$={class:"dialog"},O={class:"form-group"},x={class:"form-group"},h={class:"form-group"},B={class:"form-group"},M={class:"form-group"},q={class:"dialog-actions"},I={__name:"TransfersListView",setup(H){const{callApi:_}=f(),m=i([]),d=i(!1),p=i(null),s=i({amount_sending_da:"",rate:"",notes:"",amount_received_usd:"",receiver_notes:""}),c=async()=>{const l=await _({query:`
      SELECT t.*, 
        u_sender.username as sender_name,
        u_receiver.username as receiver_name
      FROM transfers t
      LEFT JOIN users u_sender ON t.id_user_do_transfer = u_sender.id
      LEFT JOIN users u_receiver ON t.id_user_receive_transfer = u_receiver.id
      ORDER BY t.date_do_transfer DESC
    `,params:[]});l.success&&(m.value=l.data)},b=(l,t)=>(l/t).toFixed(2),g=l=>{p.value=l,s.value={amount_sending_da:l.amount_sending_da,rate:l.rate,notes:l.notes||"",amount_received_usd:l.amount_received_usd||"",receiver_notes:l.receiver_notes||""},d.value=!0},E=async()=>{(await _({query:`
      UPDATE transfers SET
        amount_sending_da = ?,
        rate = ?,
        notes = ?,
        amount_received_usd = ?,
        receiver_notes = ?
      WHERE id = ?
    `,params:[s.value.amount_sending_da,s.value.rate,s.value.notes,s.value.amount_received_usd,s.value.receiver_notes,p.value.id]})).success&&(d.value=!1,c())};R(()=>{c()});const D=async l=>{if(!confirm("Are you sure you want to delete this transfer permanently?"))return;(await _({query:"DELETE FROM transfers WHERE id = ?",params:[l.id]})).success&&c()};return(l,t)=>(v(),r("div",A,[t[14]||(t[14]=e("h1",null,"All Transfers List",-1)),e("button",{onClick:t[0]||(t[0]=n=>l.$router.push("/transfers")),class:"back-btn"},"â† Return to Transfers"),e("div",L,[e("table",null,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"Sender"),e("th",null,"Date Sent"),e("th",null,"Amount DA"),e("th",null,"Rate"),e("th",null,"USD Sent"),e("th",null,"Notes"),e("th",null,"Receiver"),e("th",null,"Date Received"),e("th",null,"Received USD"),e("th",null,"Receiver Notes"),e("th",null,"Actions")])],-1)),e("tbody",null,[(v(!0),r(k,null,w(m.value,n=>(v(),r("tr",{key:n.id,class:C({"not-received":!n.date_receive,"amount-mismatch":n.date_receive&&b(n.amount_sending_da,n.rate)!==n.amount_received_usd})},[e("td",null,a(n.sender_name),1),e("td",null,a(new Date(n.date_do_transfer).toLocaleString()),1),e("td",null,a(n.amount_sending_da),1),e("td",null,a(n.rate),1),e("td",null,"$"+a(b(n.amount_sending_da,n.rate)),1),e("td",null,a(n.notes||"-"),1),e("td",null,a(n.receiver_name||"-"),1),e("td",null,a(n.date_receive?new Date(n.date_receive).toLocaleString():"-"),1),e("td",null,a(n.amount_received_usd?`$${n.amount_received_usd}`:"-"),1),e("td",null,a(n.receiver_notes||"-"),1),e("td",null,[e("div",N,[e("button",{onClick:y=>g(n),class:"btn edit-btn"}," Edit ",8,U),e("button",{onClick:y=>D(n),class:"btn delete-btn"}," Delete ",8,V)])])],2))),128))])])]),d.value?(v(),r("div",F,[e("div",$,[t[13]||(t[13]=e("h2",null,"Edit Transfer",-1)),e("div",O,[t[8]||(t[8]=e("label",null,"Amount Sending (DA):",-1)),o(e("input",{type:"number","onUpdate:modelValue":t[1]||(t[1]=n=>s.value.amount_sending_da=n),step:"0.01"},null,512),[[u,s.value.amount_sending_da]])]),e("div",x,[t[9]||(t[9]=e("label",null,"Rate:",-1)),o(e("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=n=>s.value.rate=n),step:"0.0001"},null,512),[[u,s.value.rate]])]),e("div",h,[t[10]||(t[10]=e("label",null,"Notes:",-1)),o(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=n=>s.value.notes=n)},null,512),[[u,s.value.notes]])]),e("div",B,[t[11]||(t[11]=e("label",null,"Received USD:",-1)),o(e("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=n=>s.value.amount_received_usd=n),step:"0.01"},null,512),[[u,s.value.amount_received_usd]])]),e("div",M,[t[12]||(t[12]=e("label",null,"Receiver Notes:",-1)),o(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=n=>s.value.receiver_notes=n)},null,512),[[u,s.value.receiver_notes]])]),e("div",q,[e("button",{onClick:E,class:"btn save-btn"},"Save"),e("button",{onClick:t[6]||(t[6]=n=>d.value=!1),class:"btn cancel-btn"},"Cancel")])])])):S("",!0)]))}},W=T(I,[["__scopeId","data-v-aacca940"]]);export{W as default};
//# sourceMappingURL=TransfersListView.fqHrTNuT.js.map
